:: Widgets Avery Mansion [widget]

<<widget "avery_mansion_variables_debug">>
	Rent time: $renttime<br>
	/*Avery card gift: <<print $avery_card_gift>><br>*/
<<if $avery_mansion>>
	Mansion days absent: <<print $avery_mansion.days_absent>><br>
	Speech attitude Avery: $speech_attitude_avery<br>
	/*Bailey message: <<print $avery_mansion.bailey_message>><br>*/
	Bus: <<print $bus>><br>
	Fate: $avery_fate<br>
	Fire mansion time: $avery_mansion_fire_time<br>
	Fire skyscraper time: $avery_skyscraper_fire_time<br>
	Love: <<print C.npc.Avery.love>>
	Dom: <<print C.npc.Avery.dom>>
	Rage: <<print C.npc.Avery.rage>>
	<br>
	<<if $fake_artefact>>
		Fake artefact: <<print $fake_artefact>><br>
	<<else>>
		None<br>
	<</if>>
	Guest: <<print $avery_mansion.guest>><br>
	/*Date: <<print $averydate>><br>*/
	Avery passage: $avery_passage<br>
	Avery mansion pool: <<print $avery_mansion.pool>><br>
	Avery mansion kitchen: <<print $avery_mansion.kitchen>><br>
	Avery mansion lounge: <<print $avery_mansion.lounge>><br>
	Avery mansion display: <<print $avery_mansion.display>><br>
	Avery mansion bedroom: <<print $avery_mansion.bedroom>><br>
	Avery mansion bathroom: <<print $avery_mansion.bathroom>><br>
	Avery mansion dining: <<print $avery_mansion.dining>><br>
	Avery mansion garden: <<print $avery_mansion.garden>><br>


	Avery mansion jobs: <<print $avery_mansion.jobs>><br>
	Avery mansion schedule: <<print $avery_mansion.schedule>><br>
	Avery mansion state: <<print $avery_mansion.state>><br>
	Avery mansion days: <<print $avery_mansion.days>><br>
	Avery mansion walk cycle: <<print $avery_mansion.walk_cycle>><br>
	Avery mansion display antiques: <<print $avery_mansion.display_antiques>><br>
	Avery mansion food: <<print $avery_mansion.food.name>><br>
	Avery mansion food last: <<print $avery_mansion.food_last>><br>
	Avery mansion date ready: <<print $avery_mansion.date_ready>><br>

	Avery rage work: <<print $avery_mansion.rage.work>><br>
	Avery rage apologetic: <<print $avery_mansion.rage.apologetic>><br>
	Avery rage dinner missed: <<print $avery_mansion.rage.dinner_missed>><br>
	Avery rage dinner done: <<print $avery_mansion.rage.dinner_done>><br>
	Avery rage dinner wrong: <<print $avery_mansion.rage.dinner_wrong>><br>
	Avery rage timer: <<print $avery_mansion.rage.timer>><br>
	Rage assess: <<print $avery_mansion.rage.assess>><br>

	Avery mansion date seen: <<print $avery_mansion.date_seen>><br>
	Avery mansion party state: <<print $avery_mansion.party_state>><br>
	Avery mansion landry: <<print $avery_mansion.landry>><br>
	Avery mansion vault progress: <<print $avery_mansion.vault_progress>><br>
	<<if $avery_tower>>
		Avery mansion tower progress: <<print $avery_tower.progress>><br>
		Avery tower effects: <<print $avery_tower.effects>><br>
		Avery tower stage: <<print $avery_tower.stage>><br>
	<</if>>
	<<if $avery_antiques>>
		Avery antiques progress: <<print $avery_antiques.progress>><br>
		Avery antiques bolts: <<print $avery_antiques.bolts>><br>
		Avery antiques bolts progress: <<print $avery_antiques.bolt_progress>><br>
		Avery antiques exposed: <<print $avery_antiques.exposed>><br>
		Avery antiques stolen: <<print $avery_antiques.stolen>><br>
		Avery antiques noticed: <<print $avery_antiques.noticed>><br>
		Avery antiques confront: <<print $avery_antiques.confront>><br>
	<</if>>
	<<set _avery_mansion_chase_test to false>>
	<<if $avery_mansion.chase and _avery_mansion_chase_test>>
		Avery chase victory: <<print $avery_mansion.chase.victory>><br>
		Avery chase health: <<print $avery_mansion.chase.health>><br>
		Avery chase bus: <<print $avery_mansion.chase.bus>><br>
		Avery chase avery_bus: <<print $avery_mansion.chase.avery_bus>><br>
		Avery chase sound: <<print $avery_mansion.chase.sound>><br>
		Avery chase player_sound: <<print $avery_mansion.chase.player_sound>><br>
		Avery chase key: <<print $avery_mansion.chase.key>><br>
		/*
		Avery chase key_checked: <<print $avery_mansion.key_checked>>
		Avery chase gear: <<print $avery_mansion.gear>><br>
		 */
		Avery chase trap: <<print $avery_mansion.chase.trap>><br>
		Avery chase trap_done: <<print $avery_mansion.chase.trap_done>><br>
		Avery chase key_location: <<print $avery_mansion.chase.key_location>><br>
	<</if>>
	<<if $avery_party>>
		Avery party speech_guest: <<print $avery_party.speech_guest>><br>
		Avery party speech_avery: <<print $avery_party.speech_avery>><br>
		Avery party guests: <<print $avery_party.guests>><br>
		Avery party stage: <<print $avery_party.stage>><br>
		Avery party current_speech: <<print $avery_party.current_speech>><br>
		Avery party mood_guest: <<print $avery_party.mood_guest>><br>
		Avery party mood_avery: <<print $avery_party.mood_avery>><br>
	<</if>>
	<<if $avery_dungeon>>
		Avery dungeon tool: <<print $avery_dungeon.tool>><br>
		Avery dungeon timer: <<print $avery_dungeon.timer>><br>
	<</if>>
<</if>>
<</widget>>

<<widget "avery_mansion_init">>
<<set $avery_mansion to {}>>
<<set $avery_mansion.version to 2>>

<<set $avery_mansion.pool to 0>>
<<set $avery_mansion.kitchen to 0>>
<<set $avery_mansion.lounge to 0>>
<<set $avery_mansion.display to 0>>
<<set $avery_mansion.bedroom to 0>>
<<set $avery_mansion.bathroom to 0>>
<<set $avery_mansion.dining to 0>>
<<set $avery_mansion.garden to 0>>
<<set $avery_mansion.study to 0>>
<<set $avery_mansion.garage to 0>>

<<set $avery_mansion.jobs to []>>
<<set $avery_mansion.schedule to "home">>
<<set $avery_mansion.state to "normal">>
<<set $avery_mansion.days to 0>>
<<set $avery_mansion.days_absent to 0>>
<<set $avery_mansion.walk_cycle to 0>>
<<set $avery_mansion.display_antiques to 0>>
<<set $avery_mansion.food to clone(setup.plants.hamburger)>>
<<set $avery_mansion.food_last to "none">>
<<set $avery_mansion.date_ready to false>>

<<set $avery_mansion.rage to {}>>
<<set $avery_mansion.rage.work to false>>
<<set $avery_mansion.rage.apologetic to false>>
<<set $avery_mansion.rage.dinner_missed to 0>>
<<set $avery_mansion.rage.dinner_done to 0>>
<<set $avery_mansion.rage.dinner_wrong to false>>
<<set $avery_mansion.rage.assess to 0>>
<<set $avery_mansion.rage.timer to 0>>

<<set $avery_mansion.fox to {}>>
<<set $avery_mansion.fox.progress to 0>>
<<set $avery_mansion.fox.known to false>>
<<set $avery_mansion.fox.unlocked to false>>

<<set $avery_mansion.date_seen to false>>
<<if Time.weekDay is 1>>
	<<set $avery_mansion.party_state to "first sunday skip">>
<<else>>
	<<set $avery_mansion.party_state to "waiting">>
<</if>>
<<set $avery_mansion.guest to "Bailey">>
<<set $avery_mansion.landry to 0>>
<<set $avery_mansion.vault_progress to 0>>

<<set $avery_mansion.kitchen_stock to {
	normal: ["salt", "vegetable_oil", "bottle_of_milk", "flour", "chicken_egg", "beef", "pork", "truffle", "cream", "tomato", "red_wine", "white_wine", "rice", "chilli_pepper"],
	requested: []
}>>
<<set $avery_mansion.kitchen_made to 0>>
<<set $avery_mansion.recipe to []>>

<<set $daily.avery.housekeeping_events to {}>>

<<set $avery_tower to {}>>
<<set $avery_tower.progress to 0>>
<<set $avery_tower.effects to []>>
<<set $avery_tower.effects.pushUnique("theft")>>
<<set $avery_tower.stage to 0>>
<<set $avery_tower.intro to 0>>

<<avery_antiques_init>>
<<avery_mansion_start_clothes>>

<</widget>>

<<widget "avery_antiques_init">>
	<<set $avery_antiques to {}>>
	<<set $avery_antiques.progress to 0>>
	<<set $avery_antiques.bolts to 10>>
	<<set $avery_antiques.bolt_progress to 0>>
	<<set $avery_antiques.exposed to []>>
	<<set $avery_antiques.stolen to []>>
	<<set $avery_antiques.noticed to []>>
	<<set $avery_antiques.confront to []>>
<</widget>>

<<widget "avery_antiques_end">>
	<<unset $avery_antiques>>
	<<set $avery_mansion.antiques_stolen to true>>
<</widget>>

<<widget "avery_mansion_food_select">>
	<<avery_food_select>>
	<<if $avery_mansion.food.name is $avery_mansion.food_last>>
		<<if $avery_mansion.rage.dinner_wrong>>
			"On second thought, that was delicious," Avery says. <span class="gold">"I'd like <<recipe_name $avery_mansion.food.name "article">> again next time."</span>
		<<else>>
			"I think I fancy the routine. <span class="gold">I'd like <<recipe_name $avery_mansion.food.name "article">> again."</span>
		<</if>>
	<<elseif setup.plants[$avery_mansion.food.name].special.includes("seafood")>>
		"I fancy seafood next time," Avery says. <span class="gold">"I think <<recipe_name $avery_mansion.food.name "article">> will hit the spot."</span>
	<<elseif setup.plants[$avery_mansion.food.name].special.includes("sweet")>>
		"I fancy something sweet next time," Avery says. <span class="gold">"I think <<recipe_name $avery_mansion.food.name "article">> will hit the spot."</span>
	<<elseif setup.plants[$avery_mansion.food.name].special.includes("spicy")>>
		"I fancy something spicy next time," Avery says. <span class="gold">"I think <<recipe_name $avery_mansion.food.name "article">> will hit the spot."</span>
	<<else>>
		"I fancy something hearty next time," Avery says. <span class="gold">"I think <<recipe_name $avery_mansion.food.name "article">> will hit the spot."</span>
	<</if>>
	<br><br>
	<i>Avery will ask for more complex recipes at higher dominance.</i>
	<br><br>

	<<if $gift.name isnot $avery_requested_food>>
		<<for _i range setup.plants[$avery_requested_food].ingredients>>
			<<if $plants[_i].amount is 0 and !$avery_mansion.kitchen_stock.normal.concat($avery_mansion.kitchen_stock.requested).includes($plants[_i].name)>>
				<<set _missingIngredients to true>>
			<</if>>
		<</for>>
	<</if>>
	<<if _missingIngredients>>
		<<link [[Say you couldn't make <<recipe_name $avery_requested_food "article">> because you were missing ingredients|Avery Gifts Ingredients]]>><</link>>
		<br>
	<</if>>
	<<if $plants[$avery_mansion.food.name].recipe isnot true>>
		<<link [[Say you don't know the recipe|Avery Gifts Recipe]]>><<unset $avery_requested_food>><</link>>
		<br>
	<</if>>
	<<if $plants[$avery_mansion.food.name].recipe isnot true or _missingIngredients>>
		<<link [[Say nothing|Mansion Dining]]>><<endevent>><<unset $avery_requested_food>><</link>>
		<br>
	<<else>>
		<<link [[Next|Mansion Dining]]>><<endevent>><<unset $avery_requested_food>><</link>>
		<br>
	<</if>>

<</widget>>

<<widget "avery_mansion_tower">>
	<<if _args[0]>>
		<<set $avery_tower.progress += _args[0]>>
		<<set $avery_tower.progress to Math.clamp($avery_tower.progress, 0, 100)>>
	<</if>>
<</widget>>

<<widget "avery_mansion">>
<<if $avery_mansion.party_state is "started">>
	<<run throw new Error("avery_mansion_party_end was run when current guest was already marked as 'done'! Please report this error.")>>
<</if>>

<<if $avery_mansion.schedule is "away" and $avery_skyscraper_fire_time lte 0 and $avery_injury>>
	<<set $avery_mansion.schedule to "return">>
<<elseif $avery_mansion.schedule is "away" and $avery_mansion.away_timer lte 0 and !$avery_injury>>
	<<set $avery_mansion.schedule to "return">>
	<<set $avery_mansion.rage.apologetic to true>>
	<<set $avery_mansion.rage.work to true>>
<<elseif $avery_mansion.schedule is "away" and Time.weekday is 1 and Time.hour gte 18 and $avery_mansion.party_state is "waiting" and !$avery_injury>>
	<<set $avery_mansion.schedule to "return">>
	<<set $avery_mansion.rage.apologetic to true>>
	<<set $avery_mansion.rage.work to true>>
<<elseif $avery_mansion.schedule isnot "away">>
	<<switch Time.weekDay>>
		<<case 1>>/* Sunday */
			<<if Time.hour lte 4>>
				<<set $avery_mansion.schedule to "sleep">>
			<<elseif Time.hour lte 5>>
				<<set $avery_mansion.schedule to "bath">>
			<<elseif Time.hour lte 6>>
				<<set $avery_mansion.schedule to "breakfast">>
			<<elseif Time.hour lte 16>>
				<<set $avery_mansion.schedule to "work">>
			<<elseif Time.hour lte 17 and $avery_mansion.rage.work is true>>
				<<set $avery_mansion.schedule to "return">>
			<<elseif Time.hour lte 17 and $avery_mansion.party_state is "waiting">>
				<<set $avery_mansion.schedule to "party_prepare">>
			<<elseif $avery_mansion.party_state is "waiting">>
				<<set $avery_mansion.schedule to "party">>
			<<else>>
				<<set $avery_mansion.schedule to "drink">>
			<</if>>
		<<case 2>>/* Monday */
			<<if Time.hour lte 4>>
				<<set $avery_mansion.schedule to "sleep">>
			<<elseif Time.hour lte 5>>
				<<set $avery_mansion.schedule to "bath">>
			<<elseif Time.hour lte 6>>
				<<set $avery_mansion.schedule to "breakfast">>
			<<elseif Time.hour lte 20>>
				<<set $avery_mansion.schedule to "work">>
			<<elseif Time.hour lte 23 and $avery_mansion.rage.work is true>>
				<<set $avery_mansion.schedule to "return">>
			<<elseif Time.hour lte 23 and canGiftFood("Avery")>>
				<<set $avery_mansion.schedule to "dinner">>
			<<else>>
				<<set $avery_mansion.schedule to "study">>
			<</if>>
		<<case 3>>/* Tuesday */
			<<if Time.hour lte 4>>
				<<set $avery_mansion.schedule to "sleep">>
			<<elseif Time.hour lte 5>>
				<<set $avery_mansion.schedule to "bath">>
			<<elseif Time.hour lte 6>>
				<<set $avery_mansion.schedule to "breakfast">>
			<<elseif Time.hour lte 20>>
				<<set $avery_mansion.schedule to "work">>
			<<elseif Time.hour lte 23 and $avery_mansion.rage.work is true>>
				<<set $avery_mansion.schedule to "return">>
			<<elseif Time.hour lte 23 and canGiftFood("Avery")>>
				<<set $avery_mansion.schedule to "dinner">>
			<<else>>
				<<set $avery_mansion.schedule to "pool">>
			<</if>>
		<<case 4>>/* Wednesday */
			<<if Time.hour lte 4>>
				<<set $avery_mansion.schedule to "sleep">>
			<<elseif Time.hour lte 5>>
				<<set $avery_mansion.schedule to "bath">>
			<<elseif Time.hour lte 6>>
				<<set $avery_mansion.schedule to "breakfast">>
			<<elseif Time.hour lte 20>>
				<<set $avery_mansion.schedule to "work">>
			<<elseif Time.hour lte 23 and $avery_mansion.rage.work is true>>
				<<set $avery_mansion.schedule to "return">>
			<<elseif Time.hour lte 23 and canGiftFood("Avery")>>
				<<set $avery_mansion.schedule to "dinner">>
			<<else>>
				<<set $avery_mansion.schedule to "lounge">>
			<</if>>
		<<case 5>>/* Thursday */
			<<if Time.hour lte 4>>
				<<set $avery_mansion.schedule to "sleep">>
			<<elseif Time.hour lte 5>>
				<<set $avery_mansion.schedule to "bath">>
			<<elseif Time.hour lte 6>>
				<<set $avery_mansion.schedule to "breakfast">>
			<<elseif Time.hour lte 20>>
				<<set $avery_mansion.schedule to "work">>
			<<elseif Time.hour lte 23 and $avery_mansion.rage.work is true>>
				<<set $avery_mansion.schedule to "return">>
			<<elseif Time.hour lte 23 and canGiftFood("Avery")>>
				<<set $avery_mansion.schedule to "dinner">>
			<<else>>
				<<set $avery_mansion.schedule to "garden">>
			<</if>>
		<<case 6>>/* Friday */
			<<if Time.hour lte 4>>
				<<set $avery_mansion.schedule to "sleep">>
			<<elseif Time.hour lte 5>>
				<<set $avery_mansion.schedule to "bath">>
			<<elseif Time.hour lte 6>>
				<<set $avery_mansion.schedule to "breakfast">>
			<<elseif Time.hour lte 20>>
				<<set $avery_mansion.schedule to "work">>
			<<elseif Time.hour lte 23 and $avery_mansion.rage.work is true>>
				<<set $avery_mansion.schedule to "return">>
			<<elseif Time.hour lte 23 and canGiftFood("Avery")>>
				<<set $avery_mansion.schedule to "dinner">>
			<<else>>
				<<set $avery_mansion.schedule to "drink">>
			<</if>>
		<<case 7>>/* Saturday */
			<<if Time.hour lte 4>>
				<<set $avery_mansion.schedule to "sleep">>
			<<elseif Time.hour lte 5>>
				<<set $avery_mansion.schedule to "bath">>
			<<elseif Time.hour lte 6>>
				<<set $avery_mansion.schedule to "breakfast">>
			<<elseif Time.hour lte 9>>
				<<set $avery_mansion.schedule to "garden">>
			<<elseif Time.hour lte 12>>
				<<set $avery_mansion.schedule to "pool">>
			<<elseif Time.hour lte 15>>
				<<set $avery_mansion.schedule to "study">>
			<<elseif Time.hour lte 19>>
				<<set $avery_mansion.schedule to "lounge">>
			<<elseif Time.hour is 20>>
				<<set $avery_mansion.schedule to "date">>
			<<else>>
				<<set $avery_mansion.schedule to "drink">>
			<</if>>
	<</switch>>
	<<if $avery_mansion.schedule is "sleep">>
		<<if $avery_mansion.bedroom_state is "off-limits away">>
			<<set $avery_mansion.bedroom_state to "off-limits">>
		<</if>>
	<<else>>
		<<if $avery_mansion.bedroom_state is "off-limits" or $avery_mansion.bedroom_state is "locked">>
			<<set $avery_mansion.bedroom_state to "off-limits away">>
		<<elseif $avery_mansion.bedroom_state is "ignored insisted">>
			<<set $avery_mansion.bedroom_state to "ignored">>
		<<elseif $avery_mansion.bedroom_state is "insisted">>
			<<unset $avery_mansion.bedroom_state>>
		<</if>>
	<</if>>
<</if>>
<<if $avery_mansion.schedule isnot "away" and $avery_mansion.schedule isnot "date" and $avery_mansion.schedules isnot "sleep" and $avery_mansion.schedule isnot "work">>
	<<set _avery_available to true>>
<</if>>
<</widget>>

<<widget "avery_mansion_away">>
	<<set $avery_mansion.schedule to "away">>
	<<set $avery_mansion.timer to 6>>
<</widget>>

<<widget "avery_housework_change">>
	<<if _args[0] and _args[1] and $avery_mansion[_args[0]] isnot undefined>>
		<<set $avery_mansion[_args[0]] += _args[1]>>
		<<set $avery_mansion[_args[0]] = Math.clamp($avery_mansion[_args[0]], 0, 4)>>
	<</if>>
<</widget>>

<<widget "avery_mansion_end_links">>
<<if _args[0] is "housework">>
	<<avery_housework_check>>
	<<if _avery_housework_count gte 1>>
		<<icon "housekeeping.png">><<link [[Continue cleaning|Mansion Housework]]>><</link>>
		<br>
		<<refuseicon>><<link [[Stop|$avery_passage]]>><</link>>
	<<else>>
		<<if $avery_mansion.bedroom gte 1>>
			<span class="blue">The mansion is spick and span except for the<<if $avery_mansion.bedroom_state is "locked">> locked<</if>> bedroom<<if $avery_mansion.pool gte 1>> and the pool<</if>>.</span>
			<<if $avery_mansion.bedroom_state isnot "locked">>
				<br>
				<<socialiseicon "angry">><<link [[Ignore Avery's warning and clean the bedroom|Mansion Housework]]>><<set $avery_mansion.bedroom_state to "ignored">><</link>>
			<</if>>
		<<elseif $avery_mansion.pool gte 1>>
			<span class="blue">The mansion is spick and span except for the pool.</span>
		<<else>>
			<span class="green">The mansion is spick and span.</span>
		<</if>>
		<br><br>
		<<link [[Next|$avery_passage]]>><</link>>
	<</if>>
	<br>
<<else>>
	<<if $bus is "avery_dungeon">>
		<<link [[Next|Mansion Bedroom]]>><</link>>
	<<else>>
		<<link [[Next|$avery_passage]]>><</link>>
		<br>
	<</if>>
<</if>>
<</widget>>

<<widget "avery_housework_check">>
	<<if !$avery_mansion.jobs.includes("pool")>>
		<<set $avery_mansion.pool to 0>>
	<</if>>
	<<if !$avery_mansion.jobs.includes("kitchen")>>
		<<set $avery_mansion.kitchen to 0>>
	<</if>>
	<<if !$avery_mansion.jobs.includes("lounge")>>
		<<set $avery_mansion.lounge to 0>>
	<</if>>
	<<if !$avery_mansion.jobs.includes("display")>>
		<<set $avery_mansion.display to 0>>
	<</if>>
	<<if !$avery_mansion.jobs.includes("bedroom")>>
		<<set $avery_mansion.bedroom to 0>>
	<</if>>
	<<if !$avery_mansion.jobs.includes("bathroom")>>
		<<set $avery_mansion.bathroom to 0>>
	<</if>>
	<<if !$avery_mansion.jobs.includes("dining")>>
		<<set $avery_mansion.dining to 0>>
	<</if>>
	<<if !$avery_mansion.jobs.includes("garden")>>
		<<set $avery_mansion.garden to 0>>
	<</if>>
	<<set _avery_housework_count to $avery_mansion.kitchen + $avery_mansion.lounge + $avery_mansion.display + $avery_mansion.bathroom + $avery_mansion.dining + $avery_mansion.garden>>
	<<if !($avery_mansion.schedule is "pool" and $daily.avery.housekeeping_events.pool)>>
		<<set _avery_housework_count += $avery_mansion.pool>>
	<</if>>
	<<if $avery_mansion.bedroom gte 1 and $avery_mansion.bedroom_state isnot "locked" and $avery_mansion.bedroom_state isnot "off-limits">>
		<<set _avery_housework_bedroom to true>>
		<<set _avery_housework_count += $avery_mansion.bedroom>>
	<</if>>
<</widget>>

<<widget "avery_mansion_description">>
<<avery_housework_check>>
<<set _avery_housekeeping to Math.floor(10 - $housekeeping / 200)>>
<<set _avery_tending to Math.floor(10 - $tending / 200)>>
<<set _avery_mansion_time to 0 + $avery_mansion.pool * _avery_housekeeping + $avery_mansion.kitchen * _avery_housekeeping + $avery_mansion.lounge * _avery_housekeeping + $avery_mansion.display * _avery_housekeeping + $avery_mansion.bathroom * _avery_housekeeping + $avery_mansion.dining * _avery_housekeeping + $avery_mansion.garden * _avery_tending>>

<<if $avery_mansion.bedroom_state isnot "locked" and $avery_mansion.bedroom_state isnot "off-limits">>
	<<set _avery_mansion_time to _avery_mansion_time + $avery_mansion.bedroom * _avery_housekeeping>>
<</if>>

<<if _args[0] is "all" and $avery_mansion.jobs.includes("lounge")>>
	Lounge:
<</if>>
<<if _args[0] is "lounge" or _args[0] is "all" and $avery_mansion.jobs.includes("lounge")>>
	<<if $avery_mansion.lounge gte 4>>
		<span class="red">It's as if a bull rampaged through.</span>
	<<elseif $avery_mansion.lounge is 3>>
		<span class="pink">The television is smeared by a large stain.</span>
	<<elseif $avery_mansion.lounge is 2>>
		<span class="purple">Litter is strewn across the table.</span>
	<<elseif $avery_mansion.lounge is 1>>
		<span class="blue">The cushions are out of order, and the piano is dusty.</span>
	<<else>>
		<span class="green">It looks like a showroom.</span>
	<</if>>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("lounge")>>
	<br>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("kitchen")>>
	Kitchen:
<</if>>
<<if _args[0] is "kitchen" or _args[0] is "all" and $avery_mansion.jobs.includes("kitchen")>>
	<<if $avery_mansion.kitchen gte 4>>
		<span class="red">Something grows in the sink.</span>
	<<elseif $avery_mansion.kitchen is 3>>
		<span class="pink">The floor needs mopping.</span>
	<<elseif $avery_mansion.kitchen is 2>>
		<span class="purple">Pots, pans, and plates are stacked by the sink.</span>
	<<elseif $avery_mansion.kitchen is 1>>
		<span class="blue">The counter is covered in crumbs.</span>
	<<else>>
		<span class="green">You could eat off the counter.</span>
	<</if>>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("kitchen")>>
	<br>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("dining")>>
	Dining room:
<</if>>
<<if _args[0] is "dining" or _args[0] is "all" and $avery_mansion.jobs.includes("dining")>>
	<<if $avery_mansion.dining gte 4>>
		<span class="red">It looks like someone threw a party.</span>
	<<elseif $avery_mansion.dining gte 3>>
		<span class="pink">A bottle has rolled off the table, leaving a red trail.</span>
	<<elseif $avery_mansion.dining gte 2>>
		<span class="purple">Discarded food covers the table.</span>
	<<elseif $avery_mansion.dining gte 1>>
		<span class="blue">The cutlery is in disarray.</span>
	<<else>>
		<span class="green">All is arranged and in order.</span>
	<</if>>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("dining")>>
	<br>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("display")>>
	Display room:
<</if>>
<<if _args[0] is "display" or _args[0] is "all" and $avery_mansion.jobs.includes("display")>>
	<<if $avery_mansion.display gte 4>>
		<span class="red">Cobwebs hang between the displays.</span>
	<<elseif $avery_mansion.display is 3>>
		<span class="pink">The displays are coated in grime.</span>
	<<elseif $avery_mansion.display is 2>>
		<span class="purple">There are fingerprints on the displays.</span>
	<<elseif $avery_mansion.display is 1>>
		<span class="blue">The displays are dusty.</span>
	<<else>>
		<span class="green">The displays are pristine, like a museum.</span>
	<</if>>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("display")>>
	<br>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("bedroom")>>
	Bedroom:
<</if>>
<<if _args[0] is "bedroom" or _args[0] is "all" and $avery_mansion.jobs.includes("bedroom")>>
	<<if $avery_mansion.bedroom gte 4>>
		<span class="red">It looks like a crime scene.</span>
	<<elseif $avery_mansion.bedroom gte 3>>
		<span class="pink">There's an odd smell.</span>
	<<elseif $avery_mansion.bedroom gte 2>>
		<span class="purple">Clothes are scattered throughout.</span>
	<<elseif $avery_mansion.bedroom gte 1>>
		<span class="blue">The bed needs making.</span>
	<<else>>
		<span class="green">Everything is in its right place.</span>
	<</if>>
	<<if $avery_mansion.bedroom gte 1>>
		<<if $avery_mansion.bedroom_state is "off-limits">>
			<br>
			<span class="blue">Avery slumbers, and doesn't like you cleaning the bedroom while <<nnpc_he Avery>> sleeps.</span>
			<br>
			<<link [[Ignore <<nnpc_his Avery>> warning|$passage]]>><<set $avery_mansion.bedroom_state to "ignored">><</link>>
		<<elseif $avery_mansion.bedroom_state is "locked">>
			<br>
			<span class="bedroom">The bedroom door is locked.</span>
		<</if>>
	<</if>>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("bedroom")>>
	<br>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("bathroom")>>
	Bathroom:
<</if>>
<<if _args[0] is "bathroom" or _args[0] is "all" and $avery_mansion.jobs.includes("bathroom")>>
	<<if $avery_mansion.bathroom gte 4>>
		<span class="red">Algae grows around the taps.</span>
	<<elseif $avery_mansion.bathroom gte 3>>
		<span class="pink">The bath and basins are discoloured.</span>
	<<elseif $avery_mansion.bathroom gte 2>>
		<span class="purple">A spider crawls from the plug hole.</span>
	<<elseif $avery_mansion.bathroom gte 1>>
		<span class="blue">The bath and basins are wet.</span>
	<<else>>
		<span class="green">The bathroom looks brand new.</span>
	<</if>>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("bathroom")>>
	<br>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("garden")>>
	Garden:
<</if>>
<<if _args[0] is "garden" or _args[0] is "all" and $avery_mansion.jobs.includes("garden")>>
	<<if $avery_mansion.garden gte 4>>
		<span class="red">The plants look wild.</span>
	<<elseif $avery_mansion.garden is 3>>
		<span class="pink">Weeds strangle more delicate flowers.</span>
	<<elseif $avery_mansion.garden is 2>>
		<span class="purple">Weeds have taken root.</span>
	<<elseif $avery_mansion.garden is 1>>
		<span class="blue">The topiary could use a trim.</span>
	<<else>>
		<span class="green">The plants are prim and proper.</span>
	<</if>>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("garden")>>
	<br>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("pool")>>
	Pool:
<</if>>
<<if _args[0] is "pool" or _args[0] is "all" and $avery_mansion.jobs.includes("pool")>>
	<<if $avery_mansion.pool gte 4>>
		<span class="red">A sheen of algae covers the water.</span>
	<<elseif $avery_mansion.pool is 3>>
		<span class="pink">The water has an unhealthy tint.</span>
	<<elseif $avery_mansion.pool is 2>>
		<span class="purple">Dead bugs float on the surface.</span>
	<<elseif $avery_mansion.pool is 1>>
		<span class="blue">Leaves float on the surface.</span>
	<<else>>
		<span class="green">The water is crystal clear.</span>
	<</if>>
<</if>>
<<if _args[0] is "all" and $avery_mansion.jobs.includes("pool")>>
	<br>
<</if>>
<<if _args[0] isnot "all">>
	<br>
<</if>>
<br>
<</widget>>

<<widget "avery_mansion_links">>
	<<if $avery_mansion.jobs.length gte 1>>
		<<avery_housework_check>>
		<<if !_avery_housework_count>>
			<<if $avery_mansion.bedroom gte 1>>
				<span class="blue">The mansion is spick and span except for the<<if $avery_mansion.bedroom_state is "locked">> locked<</if>> bedroom<<if $avery_mansion.pool gte 1>> and the pool<</if>>.</span>
				<<if $bus isnot "avery_bedroom" and $avery_mansion.bedroom_state isnot "locked">>
					<br>
					<<link [[Ignore Avery's warning|$passage]]>><<set $avery_mansion.bedroom_state to "ignored">><</link>>
				<</if>>
			<<elseif $avery_mansion.pool gte 1>>
				<span class="blue">The mansion is spick and span except for the pool.</span>
			<<else>>
				<span class="green">The mansion is spick and span.</span>
			<</if>>
		<<else>>
			<<icon "housekeeping.png">><<link [[Assess the state of the house|Mansion Housework Assess]]>><<handheldon 1>><</link>>
		<</if>>
		<br><br>
	<</if>>

	Downstairs
	<br>

	<<if $bus isnot "avery_lounge">>
		<<icon "avery_lounge.png">><<link [[Lounge (0:01)|Mansion Lounge]]>><<handheldon 1>><<pass 1>><</link>>
		<br>
	<</if>>

	<<if $bus isnot "avery_kitchen">>
		<<icon "avery_kitchen.png">><<link [[Kitchen (0:01)|Mansion Kitchen]]>><<handheldon 1>><<pass 1>><</link>>
		<br>
	<</if>>

	<<if $bus isnot "avery_dining">>
		<<icon "avery_dining.png">><<link [[Dining room (0:01)|Mansion Dining]]>><<handheldon 1>><<pass 1>><</link>>
		<br>
	<</if>>

	<<if $bus isnot "avery_display">>
		<<icon "avery_display.png">><<link [[Display room (0:01)|Mansion Display]]>><<handheldon 1>><<pass 1>><</link>>
		<br>
	<</if>>

	<<if $bus isnot "avery_garage">>
		<<icon "avery_garage.png">><<link [[Garage (0:01)|Mansion Garage]]>><<handheldon 1>><<pass 1>><</link>>
		<br>
	<</if>>
	<br>

	Upstairs
	<br>

	<<if $bus isnot "avery_bedroom">>
		<<if $avery_mansion.bedroom_state is "locked">>
			<span class="blue">Avery has locked you out of the bedroom for the night.</span>
		<<else>>
			<<icon "avery_bedroom.png">><<link [[Bedroom (0:01)|Mansion Bedroom]]>><<handheldon 1>><<pass 1>><</link>>
		<</if>>
		<br>
	<</if>>

	<<if $bus isnot "avery_bathroom">>
		<<icon "avery_bathroom.png">><<link [[Bathroom (0:01)|Mansion Bathroom]]>><<handheldon 1>><<pass 1>><</link>>
		<br>
	<</if>>


	<<if $bus isnot "avery_study">>
		<<if $avery_mansion.study_unlocked is 1>>
			<<icon "avery_study.png">><<link [[Study (0:01)|Mansion Study]]>><<handheldon 1>><<pass 1>><</link>>
			<br>
		<<else>>
			<<icon "avery_study.png">><<link [[Study (0:01)|Mansion Study Locked]]>><<handheldon 1>><<pass 1>><</link>>
			<br>
		<</if>>
	<</if>>
	<br>

	Outdoors
	<br>

	<<if $bus isnot "avery_garden">>
		<<if $nextPassageCheck is "Mansion Garden">>
			<span class="nextLink"><<icon "avery_garden.gif">><<link [[Garden (0:01)|Mansion Garden]]>><<handheldon 1>><<pass 1>><</link>></span>
		<<else>>
			<<icon "avery_garden.gif">><<link [[Garden (0:01)|Mansion Garden]]>><<handheldon 1>><<pass 1>><</link>>
		<</if>>
		<br>
	<</if>>
	<<if $bus isnot "avery_pool">>
		<<icon "avery_pool.png">><<link [[Pool (0:01)|Mansion Pool]]>><<handheldon 1>><<pass 1>><</link>>
		<br>
	<</if>>
	<<if $possessed and $nextPassageCheck is "Danube Street">>
		<span class="nextLink"><<icon "front_gate.png">><<link [[Leave (0:02)|Danube Street]]>><<handheldon 1>><<pass 2>><<endevent>><</link>></span>
	<<elseif $exposedRaw gte 1>>
		<<set _ex to ($exposedRaw >= 2 ? (Time.dayState == "night" ? 4 : 5) : (Time.dayState == "night" ? 2 : 3))>>
		<<if hasSexStat("exhibitionism", _ex)>>
			<<if Time.dayState is "night">>
				<<icon "front_gate.png">><<link [[Sneak away from the mansion (0:10)|Mansion Leave]]>><<handheldon 1>><<pass 10>><<endevent>><</link>>
			<<else>>
				<<icon "front_gate.png">><<link [[Sneak away from the mansion (0:20)|Mansion Leave]]>><<handheldon 1>><<pass 20>><<endevent>><</link>>
			<</if>>
			<<if $daily.ex.mansion isnot 1>>
				<<switch _ex>>
					<<case 2>>
						<<exhibitionist2>>
					<<case 3>>
						<<exhibitionist3>>
					<<case 4>>
						<<exhibitionist4>>
					<<case 5>>
						<<exhibitionist5>>
				<</switch>>
			<</if>>
		<<else>>
			<span class="blue">You can't leave the mansion dressed like this!</span>
		<</if>>
	<<elseif $avery_mansion.landry is 0 and $auriga_artefact is "Avery" and !$avery_fate and !$fake_artefact>>
		<<icon "front_gate.png">><<link [[Leave (0:02)|Mansion Landry Interrupt]]>><<handheldon 1>><<pass 2>><<endevent>><</link>>
	<<elseif $avery_mansion.days gte 7 and $avery_tower.intro is 1 and $mickeyPub gte 2 and $auriga_artefact is "Avery" and $fake_artefact is "pc" and !$avery_fate and !$avery_mansion.mickey>>
		<<icon "front_gate.png">><<link [[Leave (0:02)|Mansion Mickey Interrupt]]>><<handheldon 1>><<pass 2>><<endevent>><</link>>
	<<elseif $avery_mansion.days gte 9 and $avery_tower.intro is 1 and $auriga_artefact is "Avery" and $fake_artefact is "pc" and !$avery_fate and !$avery_mansion.fox.known>>
		<<icon "front_gate.png">><<link [[Leave (0:02)|Mansion Brown Fox Interrupt]]>><<handheldon 1>><<pass 2>><<endevent>><</link>>
	<<elseif $avery_mansion.fox.known and $avery_mansion.fox.wounded and !$avery_mansion.fox.unlocked>>
		<<icon "front_gate.png">><<link [[Leave (0:02)|Mansion Brown Fox Wounded]]>><<handheldon 1>><<pass 2>><<endevent>><</link>>
	<<else>>
		<<icon "front_gate.png">><<link [[Leave (0:02)|Danube Street]]>><<handheldon 1>><<pass 2>><<endevent>><</link>>
	<</if>>
	<br>
<</widget>>

<<widget "avery_rage_assess">>
	<<avery_mansion_seen>>

	<<if $debug is 1>>
		<br>
		<i>Pool disorder:</i> <<print $avery_mansion.pool>>
		<br>
		<i>Kitchen disorder:</i> <<print $avery_mansion.kitchen>>
		<br>
		<i>Lounge disorder:</i> <<print $avery_mansion.lounge>>
		<br>
		<i>Display disorder:</i> <<print $avery_mansion.display>>
		<br>
		<i>Bedroom disorder:</i> <<print $avery_mansion.bedroom>>
		<br>
		<i>Bathroom disorder:</i> <<print $avery_mansion.bathroom>>
		<br>
		<i>Dining disorder:</i> <<print $avery_mansion.dining>>
		<br>
		<i>Garden disorder:</i> <<print $avery_mansion.garden>>
		<br>
		<i>Dinner missed:</i> <<print $avery_mansion.rage.dinner_missed>>
		<br>
		<i>Rage assess so far:</i> <<print $avery_mansion.rage.assess>>
		<br>
	<</if>>
	<<if $avery_mansion.kneel is "refuse" and $avery_mansion.jobs.includes("knees")>>
		<<set $avery_mansion.rage.assess += 1>>
		<<if $debug is 1>>
			<i>No kneeling</i><br>
		<</if>>
	<<elseif !$avery_mansion.bow and $avery_mansion.jobs.includes("bow")>>
		<<set $avery_mansion.rage.assess += 1>>
		<<if $debug is 1>>
			<i>No bow</i><br>
		<</if>>
	<</if>>
	<<if $avery_mansion.jobs.includes("meek") and !$speech_attitude_avery and $speech_attitude isnot "meek">>
		<<set $avery_mansion.rage.assess += 1>>
		<<if $debug is 1>>
			<i>Wrong demeanour</i><br>
		<</if>>
	<</if>>
	<<if $avery_mansion.jobs.includes("maid") and !$worn.upper.type.includes("maid") and !$worn.lower.type.includes("maid") and !$worn.head.type.includes("maid")>>
		<<set $avery_mansion.rage.assess += 1>>
		<<set _avery_mansion_maid_failed to true>>
		<<if $debug is 1>>
			<i>No maid clothes</i><br>
		<</if>>
	<</if>>
	<<if !$avery_mansion.jobs.includes("maid") and $avery_mansion.jobs.includes("formal") and !$worn.upper.type.includes("formal") and !$worn.lower.type.includes("formal")>>
		<<set $avery_mansion.rage.assess += 1>>
		<<set _avery_mansion_formal_failed to true>>
		<<if $debug is 1>>
			<i>No formal clothes</i><br>
		<</if>>
	<</if>>
	<<if $avery_mansion.jobs.includes("hairstyle") and $hairstyle isnot "neat">>
		<<set $avery_mansion.rage.assess += 1>>
		<<set $avery_mansion_hairstyle_failed to true>>
		<<if $debug is 1>>
			<i>Hair wrong style</i><br>
		<</if>>
	<</if>>
	<<if $avery_mansion.jobs.includes("hairlength") and $hairlength gte 400>>
		<<set $avery_mansion.rage.assess += 1>>
		<<set $avery_mansion_hairlength_failed to true>>
		<<if $debug is 1>>
			<i>Hair too short</i><br>
		<</if>>
	<</if>>
	<<if $debug is 1>>
		<i>Total rage assess:</i> <<print $avery_mansion.rage.assess>>
		<br>
	<</if>>
<</widget>>

<<widget "avery_antiques_notice">>
	<<if $avery_antiques>>
		<<if $avery_antiques.stolen.includes("dagger") and !$avery_antiques.noticed.includes("dagger")>>
			<<set $avery_antiques.stolen.delete("dagger")>>
			<<set $avery_antiques.noticed.pushUnique("dagger")>>
		<</if>>
		<<if $avery_antiques.stolen.includes("amulet") and !$avery_antiques.noticed.includes("amulet")>>
			<<set $avery_antiques.stolen.delete("amulet")>>
			<<set $avery_antiques.noticed.pushUnique("amulet")>>
		<</if>>
		<<if $avery_antiques.stolen.includes("mask") and !$avery_antiques.noticed.includes("mask")>>
			<<set $avery_antiques.stolen.delete("mask")>>
			<<set $avery_antiques.noticed.pushUnique("mask")>>
		<</if>>
	<</if>>
<</widget>>

<<widget "avery_housework_assess">>
	<<avery_rage_assess>>
	<<if $avery_mansion.kneel is "prostrate">>
		You fall to your knees before <<him>>, and press your forehead against the ground. <<He>> strides up to you, and rests <<his>> foot on your back.
	<<elseif $avery_mansion.kneel is "kneel">>
		You fall to your knees before <<him>>. <<He>> strides up to you.
	<<elseif $avery_mansion.bow>>
		You give <<him>> a deep
		<<if $player.gender_appearance is "f">>
			curtsy
		<<else>>
			bow
		<</if>>
		as <<he>> strides up to you.
	<<else>>
		You watch as <<he>> strides up to you.
	<</if>>

	<<if !$avery_mansion.rage.apologetic>>
		<<if $avery_mansion.rage.assess gte 18>>
			<span class="red">There's malice in <<his>> eyes.</span><<gggarage>><<npcincr Avery rage $avery_mansion.rage.assess>>
		<<elseif $avery_mansion.rage.assess gte 9>>
			<span class="pink">There's anger in <<his>> eyes.</span><<ggarage>><<npcincr Avery rage $avery_mansion.rage.assess>>
		<<elseif $avery_mansion.rage.assess gte 1>>
			<span class="purple"><<He>> looks frustrated.</span><<garage>><<npcincr Avery rage $avery_mansion.rage.assess>>
		<<else>>
			<<He>> looks tired, <span class="green">but calm.</span><<larage>><<npcincr Avery rage -1>>
		<</if>>
	<</if>>
	<br><br>

	<<if $avery_mansion.rage.apologetic is true>>
		<<set $avery_mansion.rage.apologetic to false>>
		<<He>> holds one hand behind <<his>> back, and flashes a nervous smile, before revealing a bundle of roses. "I'm sorry," <<he>> says, holding out the flowers. "I'm so fucking sorry. I just get so angry, but it's not your fault." <<He>> opens <<his>> mouth to continue, but looks away instead.<<lllarage>><<npcincr Avery rage -9>>
		<br><br>

		<<link [[Accept the flowers|Mansion Return Flowers Accept]]>><<npcincr Avery love 3>><</link>><<gglove>>
		<br>
		<<link [[Walk by without accepting them|Mansion Return Flowers Refuse]]>><<npcincr Avery love -3>><<npcincr Avery rage 1>><</link>><<garage>><<llove>>
		<br>
		<<link [["Smack them out of " + $NPCList[0].pronouns.his + " hand"|Mansion Return Flowers Smack]]>><<npcincr Avery dom -1>><<npcincr Avery love -1>><<npcincr Avery rage 3>><</link>><<ggarage>>
		<br>
	<<elseif $averyragerevealed gte 1 and C.npc.Avery.rage gte 20 and $avery_mansion.rage.assess gte 1 and $avery_mansion.rage.timer lte 0>>
		<<if $avery_mansion.rage.assess gte random(1, 12)>>
			<br><br>

			<<if _args[0] is "work">>
				"I work so fucking hard for you," <<he>> says. "And this is how you repay me." <span class="red"><<He>> grasps your arm.</span>
			<<else>>
				"Where the fuck have you been?" <<he>> asks. "Hiding from me, no doubt." <span class="red"><<He>> grasps your arm.</span>
			<</if>>
			<br><br>

			<<avery_mansion_rage_party "revealed chase">>
			<<avery_mansion_rage_housework>>
			<<avery_mansion_chase_init>>

			<span class="red"><<He>> wants to hurt you.</span>
			<br><br>

			<<link [[Apologise|Mansion Chase Apologise]]>><<trauma 6>><<npcincr Avery dom 5>><</link>><<gtrauma>><<ggdom>>
			<br>
			<<link [[Brace yourself|Mansion Chase Brace]]>><</link>>
			<br>
			<<link [[Run|Mansion Chase Run]]>><</link>>
			<br>
		<<else>>
			<<His>> smile is forced.
			<br><br>

			<<if _args[0] is "work">>
				"Work was terrible," <<he>> says. "As usual."
			<<else>>
				"There you are," <<he>> says. "I've missed you."
			<</if>>
			<br><br>

			<<avery_mansion_rage_party "revealed">>
			<<avery_mansion_dom_events>>
		<</if>>
	<<else>>
		<<if !$averyragerevealed and C.npc.Avery.rage gte random(20, 100) and $avery_mansion.rage.assess gte 1>>
			<<set $averyragerevealed to 1>>
			<<if _args[0] is "work">>
				"So that's how it is?" <<he>> asks, <<his>> voice shaking with fury. "I work my arse off all day, only to come home to this." <span class="red"><<He>> grasps your arm.</span>
			<<else>>
				"Where the fuck have you been?" <<he>> asks, <<his>> voice shaking with fury. "I've been looking all over for you." <span class="red"><<He>> grasps your arm.</span>
			<</if>>
			<br><br>

			<<avery_mansion_rage_party "chase">>
			<<avery_mansion_rage_housework>>
			<<avery_mansion_chase_init>>

			<span class="red"><<He>> wants to hurt you.</span>
			<br><br>
			<<link [[Apologise|Mansion Chase Apologise]]>><<trauma 6>><<npcincr Avery dom 5>><</link>><<gtrauma>><<ggdom>>
			<br>
			<<link [[Brace yourself|Mansion Chase Brace]]>><</link>>
			<br>
			<<link [[Run|Mansion Chase Run]]>><</link>>
			<br>
		<<else>>
			"Long day," <<he>> says, managing a weak smile.

			<<avery_mansion_rage_party "normal">>
			<<avery_mansion_dom_events>>
		<</if>>
	<</if>>
	<br><br>
<</widget>>

<<widget "avery_mansion_rage_housework">>
	<<set $avery_mansion.rage.timer to 30>>
	<<He>> launches into a tirade, aimed at you, at <<his>> work colleagues, <<his>> enemies, <<his>> friends, <<his>> parents. <<He>> rages at everything, but some lines come up again and again.
	<span class="red">
	<<if $avery_mansion.pool gte 1>>
		<br>
		"The pool's a fucking swamp."
	<</if>>
	<<if $avery_mansion.kitchen gte 1>>
		<br>
		"The kitchen looks like a rat's picnic."
	<</if>>
	<<if $avery_mansion.lounge gte 1>>
		<br>
		"The lounge looks like a rape scene."
	<</if>>
	<<if $avery_mansion.display gte 1>>
		<br>
		"The display room looks like a fucking tomb."
	<</if>>
	<<if $avery_mansion.bedroom gte 1>>
		<br>
		"The bedroom looks like a murder scene."
	<</if>>
	<<if $avery_mansion.bathroom gte 1>>
		<br>
		"I wouldn't wash a dog in that bathroom."
	<</if>>
	<<if $avery_mansion.dining gte 1>>
		<br>
		"The dining room smells like shit."
	<</if>>
	<<if $avery_mansion.garden gte 1>>
		<br>
		"The garden looks like the fucking temple grounds."
	<</if>>

	<<if $avery_mansion.rage.dinner_wrong is true and $avery_mansion.rage.dinner_missed gte 1>>
		<<set $avery_mansion.rage.dinner_missed to 0>>
		<br>
		"You serve me the wrong food. When you can even be bothered to make anything."
	<<elseif $avery_mansion.rage.dinner_wrong is true>>
		<br>
		"You serve me the wrong food."
	<<elseif $avery_mansion.rage.dinner_missed gte 1>>
		<<set $avery_mansion.rage.dinner_missed to 0>>
		<br>
		"You let me go hungry."
	<</if>>
	<<if $avery_mansion.rage.ingredients>>
		<<unset $avery_mansion.rage.ingredients>>
		<br>
		"I go out of my way to buy you ingredients and you don't even remember they're there."
	<</if>>
	<<if _avery_mansion_maid_failed>>
		<br>
		"You're dressed like you own the place."
	<<elseif _avery_mansion_formal_failed>>
		<br>
		"You look like a tramp."
	<</if>>

	<<if $avery_mansion.jobs.includes("knees") and !$avery_mansion.kneel>>
		<br>
		"Why are you stood as if you're my equal?"
	<<elseif $avery_mansion.jobs.includes("bow") and !$avery_mansion.bow>>
		<br>
		"You didn't fucking <<= $player.gender_appearance is "f" ? "curtsy" : "bow">>."
	<</if>>

	<<if _avery_mansion_hairstyle_failed>>
		<br>
		<<if _avery_mansion_hairlength_failed>>
			"Your hair is a disaster."
		<<else>>
			"Your hair is a mess."
		<</if>>
	<<elseif _avery_mansion_hairlength_failed>>
		<br>
		"You should cut your fucking hair."
	<</if>>
	</span>
	<<gpain>><<gtrauma>><<gstress>><<pain 4>><<trauma 6>><<stress 6>>
	<br><br>

	<<run V.avery_mansion.rage.assess = V.avery_mansion.pool + V.avery_mansion.kitchen + V.avery_mansion.lounge + V.avery_mansion.display + V.avery_mansion.bedroom + V.avery_mansion.bathroom + V.avery_mansion.dining + V.avery_mansion.garden + V.avery_mansion.rage.dinner_missed;>>
<</widget>>

<<widget "avery_mansion_dom_events">>
<<rng 7>>
<<if $avery_tower.progress gte 25 and $avery_tower.stage is 0>>
	"We're going on a little trip," <<he>> says. "Just to my building project. I'd like to show you the progress."
	<br><br>
	<<if $exposed gte 2>>
		<<link [[Go with Avery|Skyscraper Foundation Naked]]>><<set $avery_tower.stage to 1>><</link>>
		<br>
	<<elseif $exposed gte 1>>
		<<link [[Go with Avery|Skyscraper Foundation Undies]]>><<set $avery_tower.stage to 1>><</link>>
		<br>
	<<else>>
		<<link [[Go with Avery|Skyscraper Foundation]]>><<set $avery_tower.stage to 1>><</link>>
		<br>
	<</if>>
	<<link [[Refuse|Skyscraper Foundation Refuse]]>><<set $avery_tower.stage to 1>><</link>>
	<br>
<<elseif $avery_tower.progress gte 60 and $avery_tower.stage is 1>>
	"My skyscraper is almost finished," <<he>> says. "Come. Let me show you."
	<br><br>
	<<if $exposed gte 2>>
		<<link [[Go with Avery|Skyscraper Structure Naked]]>><<set $avery_tower.stage to 2>><</link>>
		<br>
	<<elseif $exposed gte 1>>
		<<link [[Go with Avery|Skyscraper Structure Undies]]>><<set $avery_tower.stage to 2>><</link>>
		<br>
	<<else>>
		<<link [[Go with Avery|Skyscraper Structure]]>><<set $avery_tower.stage to 2>><</link>>
		<br>
	<</if>>
	<<link [[Refuse|Skyscraper Structure Refuse]]>><<set $avery_tower.stage to 2>><</link>>
	<br>
<<elseif C.npc.Avery.dom gte 80 and !$avery_mansion.jobs.includes("meek")>>
	<<set $avery_mansion.jobs.push("meek")>>
	<<set $speech_attitude_avery to true>>
	<<if $speech_attitude is "meek">>
		"You address me with the appropriate demeanour. Keep it up."
		<br><br>

		<span class="gold">Avery wants you to act meek with <<nnpc_him "Avery">> from now on. A new attitude is unlocked.</span>
		<br><br>

		<<endevent>>
		<<avery_mansion_end_links>>
	<<else>>
		"I'd like you to address me with the proper demeanour from now on. An appropriate meekness. I trust that won't be a problem."
		<br><br>

		<span class="gold">Avery wants you to act meek toward <<nnpc_him "Avery">> from now on. A new attitude is unlocked.</span>
		<br><br>

		<<link [[Agree|Mansion Return Meek]]>><<set $speech_attitude_avery to true>><</link>>
		<br>
		<<link [[Refuse|Mansion Return Meek Refuse]]>><<set $speech_attitude_avery to false>><</link>>
		<br>
	<</if>>
<<elseif C.npc.Avery.dom gte 75 and !$avery_mansion.jobs.includes("dungeon")>>
	<<set $avery_mansion.jobs.pushUnique("dungeon")>>
	"Come. I've something to show you. There's a room you haven't seen yet."
	<br><br>

	<<link [[Next|Mansion Return Dungeon]]>><</link>>
	<br>
<<elseif C.npc.Avery.dom gte 70 and !$avery_mansion.jobs.includes("display")>>
	<<set $avery_mansion.jobs.push("display")>>
	"I'd like you to keep the display room dusted," Avery says. "Be careful. The objects there are more valuable than you."
	<br><br>

	<span class="gold">Avery wants you to keep the display room clean from now on.</span>
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>
<<elseif C.npc.Avery.dom gte 65 and !$avery_mansion.jobs.includes("knees")>>
	<<set $avery_mansion.jobs.push("knees")>>
	"Kneel."
	<br><br>
	<<link [[Kneel|Mansion Return Kneel]]>><<npcincr Avery dom 1>><<set $avery_mansion.kneel to "kneel">><</link>><<gdom>>
	<br>
	<<link [[Refuse|Mansion Return Kneel Refuse]]>><<npcincr Avery rage 1>><<set $avery_mansion.kneel to "refuse">><</link>><<garage>>
	<br>
<<elseif C.npc.Avery.dom gte 60 and !$avery_mansion.jobs.includes("garden")>>
	<<set $avery_mansion.jobs.push("garden")>>
	"I never thought I'd trust you with this, but I want you to keep the garden tidy. Prune the bushes and pull the weeds I can't be bothered with."
	<br><br>

	<span class="gold">Avery wants you to maintain the garden from now on. The tending skill will help.</span>
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>
<<elseif C.npc.Avery.dom gte 55 and !$avery_mansion.jobs.includes("bathroom")>>
	<<set $avery_mansion.jobs.push("bathroom")>>
	"I want you to start cleaning the bathroom. Make sure it's spotless."
	<br><br>

	<span class="gold">Avery wants you to clean the bathroom from now on.</span>
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>
<<elseif C.npc.Avery.dom gte 50 and !$avery_mansion.jobs.includes("hairstyle")>>
	<<set $avery_mansion.jobs.push("hairstyle")>>
	<<if $hairtype is "neat">>
		"I love your hairstyle. Be sure to keep it that way in the future."
	<<else>>
		"Your hair needs work. Make it neater for the future."
	<</if>>
	<br><br>

	<span class="gold">Avery wants you to wear the "neat" hairstyle from now on.</span>
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>
<<elseif C.npc.Avery.dom gte 45 and !$avery_mansion.jobs.includes("pool")>>
	<<set $avery_mansion.jobs.push("pool")>>
	"The pool needs frequent cleaning. That's your job from now on. Don't disappoint me."
	<br><br>

	<span class="gold">Avery wants you to clean the pool from now on.</span>
	<br><br>
	<<endevent>>
	<<avery_mansion_end_links>>
<<elseif C.npc.Avery.dom gte 40 and !$avery_mansion.jobs.includes("maid") and $avery_mansion.jobs.includes("formal")>>
	<<set $avery_mansion.jobs.push("maid")>>
	"Servant's garb would look good on you. Would make me feel like the house was suitably taken care of while I'm away. Be a dear and dress appropriately in the future."
	<br><br>

	<span class="gold">Avery wants you to greet <<nnpc_him "Avery">> dressed in clothes with the "maid" trait from now on.</span>
	<br><br>
	<<endevent>>
	<<avery_mansion_end_links>>

<<elseif C.npc.Avery.dom gte 35 and !$avery_mansion.jobs.includes("kitchen")>>
	<<set $avery_mansion.jobs.push("kitchen")>>
	"The kitchen can become such a mess. Make sure it's clean from now on. I couldn't bear the embarrassment of having rats."
	<br><br>

	<span class="gold">Avery wants you to clean the kitchen from now on.</span>
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>
<<elseif C.npc.Avery.dom gte 30 and !$avery_mansion.jobs.includes("hairlength")>>
	<<set $avery_mansion.jobs.push("hairlength")>>
	<<if $hairlength gte 400>>
		"Your hair is a bit long. Could you give it a trim for me? So that it comes down to the top of your chest at the longest."
	<<else>>
		"Your hair is a lovely length. I'd like you to keep it that way. Don't let it grow further than the top of your chest at the longest."
	<</if>>
	<br><br>

	<span class="gold">Avery wants you to keep your hair trimmed from now on.</span>
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>

<<elseif C.npc.Avery.dom gte 25 and !$avery_mansion.jobs.includes("dining")>>
	<<set $avery_mansion.jobs.push("dining")>>
	"The dining room gets so cluttered. Especially after guests. Be a good <<girl>> and make sure it's clean for me."
	<br><br>

	<span class="gold">Avery wants you to keep the dining room clean from now on.</span>
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>
<<elseif C.npc.Avery.dom gte 20 and !$avery_mansion.jobs.includes("formal")>>
	<<set $avery_mansion.jobs.push("formal")>>
	"It would be nice to see you dressed in finer attire when I get home. Make me feel like it's all worthwhile. Something formal. If it's no trouble."
	<br><br>

	<span class="gold">Avery wants you to greet <<him>> in formal attire in the future.</span>
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>

<<elseif C.npc.Avery.dom gte 15 and !$avery_mansion.jobs.includes("bedroom")>>
	<<set $avery_mansion.jobs.push("bedroom")>>
	"Could you make the bed while I'm at work in the future? Clean up the bedroom in general. It's always been a chore to me."
	<br><br>

	<span class="gold">Avery wants you to keep the bedroom clean from now on.</span>
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>

<<elseif C.npc.Avery.dom gte 10 and !$avery_mansion.jobs.includes("bow")>>
	<<set $avery_mansion.jobs.push("bow")>>
	<<set $avery_mansion.bow to true>>
	"Could you give me a polite
	<<if $player.gender_appearance is "f">>
		curtsy
	<<else>>
		bow
	<</if>>
	when I get home in the future? It would make me feel welcome."
	<br><br>

	<<link [[Agree|Mansion Return Bow Agree]]>><<npcincr Avery love 1>><<set $avery_mansion.bow to true>><</link>><<glove>>
	<br>
	<<if $player.gender_appearance is "f">>
		<<link [[Demonstrate a curtsy|Mansion Return Bow Demonstrate]]>><<set $avery_mansion.bow to true>><<npcincr Avery love 1>><<npcincr Avery dom 1>><</link>>
		<br>
	<<else>>
		<<link [[Demonstrate a bow|Mansion Return Bow Demonstrate]]>><<set $avery_mansion.bow to true>><<npcincr Avery love 1>><<npcincr Avery dom 1>><</link>>
		<br>
	<</if>>
	<<link [[Refuse|Mansion Return Bow Refuse]]>><<set $avery_mansion.bow to false>><<npcincr Avery rage 1>><</link>><<garage>>
	<br>

<<elseif C.npc.Avery.dom gte 5 and !$avery_mansion.jobs.includes("lounge")>>
	<<set $avery_mansion.jobs.push("lounge")>>
	"Could you keep the lounge tidy for me while I'm at work? Just make sure the cushions and such are in order. One less thing for me to worry about."
	<br><br>

	<span class="gold">Avery wants you to keep the lounge clean from now on.</span> The housekeeping skill will help.
	<br><br>

	<<endevent>>
	<<avery_mansion_end_links>>
<<else>>
	<<if $avery_mansion.jobs.includes("dungeon") and random(1, 7) is 7 and Time.weekDay isnot 1>>
		"Come with me. I need to discipline you."
		<br><br>

		<<link [[Go with Avery to the dungeon|Mansion Dungeon Intro]]>><<npcincr Avery dom 1>><</link>><<gdom>>
		<br>
		<<link [[Refuse|Mansion Dungeon Intro Refuse]]>><<npcincr Avery rage 1>><</link>><<garage>>
		<br>
	<<elseif $rng is 1>>
		"Make me a drink."
		<br><br>
		<<link [[Make Avery a drink|Mansion Return Drink Accept]]>><<npcincr Avery dom 1>><</link>><<gdom>>
		<br>
		<<link [[Refuse politely|Mansion Return Drink Polite]]>><<npcincr Avery rage 1>><</link>><<garage>>
		<br>
		<<link [[Refuse bluntly|Mansion Return Drink Blunt]]>><<npcincr Avery rage 1>><</link>><<garage>>
		<br>
		<<if $avery_mansion.jobs.includes("dungeon")>>
			<<link [["Suggest " + $NPCList[0].pronouns.he + " take you to the dungeon instead"|Mansion Dungeon Intro Ask]]>><<npcincr Avery dom 1>><</link>>
			<br>
		<</if>>
	<<elseif $rng is 2>>
		<<if $spa_job gte 1>>
			"I could use a massage. I hear you have skilled hands."
		<<else>>
			"I could use a massage."
		<</if>>
		<br><br>
		<<if $bus is "mansion_bathroom">>
			<<link [[Give Avery a massage (0:30)|Mansion Return Massage Accept]]>><<pass 30>><<npcincr Avery dom -1>><</link>><<gdom>>
			<br>
		<<else>>
			<<link [[Go with Avery to the bathroom (0:30)|Mansion Return Massage Accept]]>><<pass 30>><<npcincr Avery dom 1>><</link>><<gdom>>
			<br>
		<</if>>
		<<link [[Refuse politely|Mansion Return Massage Polite]]>><<npcincr Avery rage 1>><</link>><<garage>>
		<br>
		<<link [[Refuse bluntly|Mansion Return Massage Blunt]]>><<npcincr Avery rage 1>><</link>><<garage>>
		<br>
		<<if $avery_mansion.jobs.includes("dungeon")>>
			<<link [["Suggest " + $NPCList[0].pronouns.he + " take you to the dungeon instead"|Mansion Dungeon Intro Ask]]>><<npcincr Avery dom 1>><</link>>
			<br>
		<</if>>
	<<elseif $rng is 3>>
		/* Resets walk_cycle to 0 if Avery's dominance is insufficient, resetting the loop early. */
		<<if $avery_mansion.walk_cycle is 3>>
			<<if C.npc.Avery.dom lt 50>>
				<<set $avery_mansion.walk_cycle to 0>>
			<</if>>
		<<elseif $avery_mansion.walk_cycle gte 2>>
			<<if C.npc.Avery.dom lt 35>>
				<<set $avery_mansion.walk_cycle to 0>>
			<</if>>
		<<elseif $avery_mansion.walk_cycle gte 1>>
			<<if C.npc.Avery.dom lt 20>>
				<<set $avery_mansion.walk_cycle to 0>>
			<</if>>
		<</if>>

		<<if $avery_mansion.walk_cycle is 3>>
			<<set $avery_mansion.walk_cycle to 0>>
			"I fancy a walk," <<he>> says, pulling a <span class="pink">collar and leash</span> taut. There's a metal nametag on the front, but deep scratches have left it illegible.
			<br><br>
			<<if $exposed gte 2>>
				"Get on your knees. There's a good dog."
				<br><br>
			<<else>>
				"Take off your clothes, and get on your knees. There's a good dog."
				<br><br>
			<</if>>
			<<if $exhibitionism gte 75>>
				<<link [[Be walked by Avery (0:30)|Mansion Return Walk Dog]]>><<set $phase to 1>><<npcincr Avery dom 3>><</link>><<exhibitionist5>><<ggdom>>
				<br>
				<<link [[Say you're too shy (lie)|Mansion Return Walk Dog Shy]]>><</link>>
				<br>
			<<else>>
				<<link [[Say you're too shy (truth)|Mansion Return Walk Dog Shy]]>><</link>>
				<br>
			<</if>>
		<<elseif $avery_mansion.walk_cycle is 2>>
			<<set $avery_mansion.walk_cycle to 3>>
			"I fancy a walk. They've kept me at a desk all day." <<His>> eyes run up and down your body, lust unconcealed.
			<br><br>
			<<if $exposed gte 2>>
				"You read my mind." <<He>> holds out <<his>> arm. "I'll keep you safe."
				<br><br>

				<<He>> wants you to go out like this.
				<br><br>
			<<else>>
				"Take off your clothes. We'll give the neighbours a treat, shall we?"
				<br><br>
			<</if>>
			<<if $exhibitionism gte 75>>
				<<link [[Strip and walk with Avery (0:30)|Mansion Return Walk Naked Strip]]>><<set $phase to 1>><</link>><<exhibitionist5>>
				<br>
				<<link [[Say you're too shy (lie)|Mansion Return Walk Naked Strip Shy]]>><</link>>
				<br>
			<<else>>
				<<link [[Say you're too shy (truth)|Mansion Return Walk Naked Strip Shy]]>><</link>>
				<br>
			<</if>>
		<<elseif $avery_mansion.walk_cycle is 1>>
			<<set $avery_mansion.walk_cycle to 2>>
			"I fancy a walk. They've kept me at a desk all day." <<He>> regards you, and taps <<his>> chin.
			<br><br>
			<<if $exposed gte 2>>
				"You're already dressed the part. Or undressed."
				<br><br>
				<span class="lewd"><<He>> wants you to go out like this!</span>
				<br><br>
				<<if $exhibitionism gte 75>>
					<<link [[Walk with Avery (0:30)|Mansion Return Walk Naked]]>><<set $phase to 1>><</link>><<exhibitionist5>>
					<br>
					<<link [[Say you're too shy (lie)|Mansion Return Walk Naked Shy]]>><</link>>
					<br>
				<<else>>
					<<link [[Say you're too shy (truth)|Mansion Return Walk Naked Shy]]>><</link>>
					<br>
				<</if>>
			<<elseif $exposed gte 1>>
				"You're dressed the part."
				<br><br>
				<<if $exhibitionism gte 35>>
					<<link [[Walk with Avery (0:30)|Mansion Return Walk Undies]]>><<set $phase to 1>><</link>><<exhibitionist3>>
					<br>
					<<link [[Say you're too shy (lie)|Mansion Return Walk Undies Shy]]>><</link>>
					<br>
				<<else>>
					<<link [[Say you're too shy (truth)|Mansion Return Walk Undies Shy]]>><</link>>
					<br>
				<</if>>
			<<else>>
				"Let's spice things up. Show you off. Strip to your underwear first."
				<br><br>

				<<if ($worn.under_lower.name isnot "naked" and ($worn.under_upper.name isnot "naked" or $player.gender_appearance is "m"))>>
					<<if $exhibitionism gte 35>>
						<<link [[Strip and go for a walk (0:30)|Mansion Return Walk Undies Strip]]>><<set $phase to 1>><</link>><<exhibitionist3>>
						<br>
						<<link [[Say you're too shy (lie)|Mansion Return Walk Undies Strip Shy]]>><</link>>
						<br>
					<<else>>
						<<link [[Say you're too shy (truth)|Mansion Return Walk Undies Strip Shy]]>><</link>>
						<br>
					<</if>>
				<<else>>
					<span class="lewd">Undressing will leave you more exposed than <<he>> realises.</span>
					<br><br>
					<<if $exhibitionism gte 75>>
						<<link [[Strip and go for a walk (0:30)|Mansion Return Walk Undies Strip]]>><<set $phase to 1>><</link>><<exhibitionist5>>
						<br>
						<<link [[Say you're too shy (lie)|Mansion Return Walk Undies Strip Shy]]>><</link>>
						<br>
					<<else>>
						<<link [[Say you're too shy (truth)|Mansion Return Walk Undies Strip Shy]]>><</link>>
						<br>
					<</if>>
				<</if>>
			<</if>>
		<<elseif $avery_mansion.walk_cycle is 0>>
			<<set $avery_mansion.walk_cycle to 1>>
			"I fancy a walk. They've kept me at a desk all day."
			<<if $exposed gte 1>>
				<<He>> looks at your <<lewdness>>, <span class="lewd">dons a salacious</span> smile, and holds out <<his>> arm.
			<<else>>
				<<He>> holds out <<his>> arm.
			<</if>>
			<br><br>
			<<if $exposed gte 2>>
				"You're dressed the part. Or undressed, rather."
				<br><br>
				<span class="lewd"><<He>> wants you to go out like this!</span>
				<br><br>
				<<if $exhibitionism gte 75>>
					<<link [[Walk with Avery (0:30)|Mansion Return Walk Naked]]>><<set $phase to 1>><</link>><<exhibitionist5>>
					<br>
					<<link [[Say you're too shy (lie)|Mansion Return Walk Naked Shy]]>><</link>>
					<br>
				<<else>>
					<<link [[Say you're too shy (truth)|Mansion Return Walk Naked Shy]]>><</link>>
					<br>
				<</if>>
			<<elseif $exposed gte 1>>
				"You're dressed the part."
				<br><br>
				<span class="lewd"><<He>> wants you to go out like this!</span>
				<br><br>
				<<if $exhibitionism gte 35>>
					<<link [[Walk with Avery (0:30)|Mansion Return Walk Undies]]>><<set $phase to 1>><</link>><<exhibitionist3>>
					<br>
					<<link [[Say you're too shy (lie)|Mansion Return Walk Undies Shy]]>><</link>>
					<br>
				<<else>>
					<<link [[Say you're too shy (truth)|Mansion Return Walk Undies Shy]]>><</link>>
					<br>
				<</if>>
			<<else>>
				<<link [[Walk with Avery (0:30)|Mansion Return Walk]]>><</link>>
				<br>
			<</if>>
			<<link [[Refuse|Mansion Return Walk Refuse]]>><<npcincr Avery rage 1>><<npcincr Avery love -1>><</link>><<garage>><<llove>>
			<br>
			<<if $avery_mansion.jobs.includes("dungeon")>>
				<<link [["Suggest " + $NPCList[0].pronouns.he + " take you to the dungeon instead"|Mansion Dungeon Intro Ask]]>><<npcincr Avery dom 1>><</link>>
				<br>
			<</if>>
			<br>
		<</if>>
	<<elseif $rng is 4>>
		"There's something on the news I need to watch," Avery says. "I'd like your company."
		<br><br>
		<<link [[Sit with Avery (0:30)|Mansion Return Sit]]>><<pass 30>><<npcincr Avery love 1>><</link>><<glove>>
		<br>
		<<link [[Make excuses|Mansion Return Sit Excuse]]>><<npcincr Avery rage 1>><<npcincr Avery love -1>><</link>><<garage>><<llove>>
		<br>
		<<if $avery_mansion.jobs.includes("dungeon")>>
			<<link [["Suggest " + $NPCList[0].pronouns.he + " take you to the dungeon instead"|Mansion Dungeon Intro Ask]]>><<npcincr Avery dom 1>><</link>>
			<br>
		<</if>>
	<<elseif $rng is 5>>
		"A dip in the hot tub would suit me well," <<he>> smiles. "How about it?"
		<br><br>

		<<link [[Bathe with Avery (0:30)|Mansion Return Bathe]]>><<pass 10>><<npcincr Avery love 1>><</link>><<glove>>
		<br>
		<<link [[Refuse|Mansion Return Bathe Refuse]]>><<npcincr Avery love -1>><<npcincr Avery rage 1>><</link>><<garage>><<llove>>
		<br>
		<<if $avery_mansion.jobs.includes("dungeon")>>
			<<link [["Suggest " + $NPCList[0].pronouns.he + " take you to the dungeon instead"|Mansion Dungeon Intro Ask]]>><<npcincr Avery dom 1>><</link>>
			<br>
		<</if>>
	<<elseif $rng is 6>>
		"I fancy giving the car a spin," <<he>> says. "The sports car. Care to accompany me?"
		<br><br>

		<<link [[Ride with Avery (0:30)|Mansion Return Ride]]>><<pass 10>><</link>>
		<br>
		<<link [[Refuse|Mansion Return Ride Refuse]]>><</link>>
		<br>
		<<if $avery_mansion.jobs.includes("dungeon")>>
			<<link [["Suggest " + $NPCList[0].pronouns.he + " take you to the dungeon instead"|Mansion Dungeon Intro Ask]]>><<npcincr Avery dom 1>><</link>>
			<br>
		<</if>>
	<<elseif $rng is 7>>
		"Give me a moment to change," <<he>> says. "Then we'll have a game or two of badminton."
		<br><br>

		<<link [[Play badminton (0:30)|Mansion Return Badminton]]>><<pass 10>><</link>>
		<br>
		<<link [[Refuse|Mansion Return Badminton Refuse]]>><<npcincr Avery rage 1>><</link>><<garage>>
		<br>
		<<if $avery_mansion.jobs.includes("dungeon")>>
			<<link [["Suggest " + $NPCList[0].pronouns.he + " take you to the dungeon instead"|Mansion Dungeon Intro Ask]]>><<npcincr Avery dom 1>><</link>>
			<br>
		<</if>>
	<</if>>
<</if>>
<</widget>>

<<widget "this_sunday">>
	<<if Time.weekDay is 1>>
		<<set $_text to "next Sunday">>
	<<elseif Time.weekDay is 7>>
		<<set $_text to "tomorrow">>
	<<else>>
		<<set $_text to "this Sunday">>
	<</if>>
	<<print $_text>>
<</widget>>

<<widget "this_saturday">>
	<<if Time.weekDay is 7>>
		<<set $_text to "tonight">>
	<<elseif Time.weekDay is 6>>
		<<set $_text to "tomorrow">>
	<<else>>
		<<set $_text to "this Saturday">>
	<</if>>
	<<print $_text>>
<</widget>>

<<widget "avery_mansion_victory">>
	<<switch $bus>>
		<<case "lounge">>
			Avery trips and falls over the table in the centre of the room.
			<<avery_housework_change "lounge" 1>>
		<<case "study">>
			Avery collides with a bookcase, and is almost buried by an avalanche of books.
		<<case "bedroom">>
			Avery stumbles onto the balcony, and only manages to keep from falling by tearing the curtains off their hinges.
			<<avery_housework_change "bedroom" 1>>
		<<case "bathroom">>
			Avery falls into the bath, almost breaking the taps on <<his>> descent.
			<<avery_housework_change "bathroom" 1>>
		<<case "hallway">>
			Avery thuds against the wall, knocking a painting loose.
		<<case "dungeon">>
			Avery trips on a loose stone, almost falling into <<his>> own torture apparatus.
		<<case "garden">>
			Avery falls into a bush, ruining the topiary.
			<<avery_housework_change "garden" 1>>
		<<case "pool">>
			Avery trips and splashes into the pool. It churns as <<he>> flails, as if bubbling with <<his>> rage.
			<<avery_housework_change "pool" 1>>
		<<case "garage">>
			Avery trips, but manages to avoid using <<his>> car for support, and falls to the ground instead.
		<<case "kitchen">>
			Avery slams into a cupboard. Plates shatter as they fall, colliding with <<him>> and the counter.
			<<avery_housework_change "kitchen" 1>>
		<<case "dining">>
			Avery falls onto the table, scattering the cutlery in all directions.
			<<avery_housework_change "dining" 1>>
		<<case "display">>
			Avery trips, grasping a priceless antique for purchase to save <<himself>> from falling.
			<<avery_housework_change "display" 1>>
		<<default>>
	<</switch>>
<</widget>>

<<widget "avery_mansion_chase_init">>
	<<set $avery_mansion.chase to {}>>
	<<set $avery_mansion.chase.victory to 0>>
	<<set $avery_mansion.chase.health to 3>>
	<<switch $bus>>
		<<case "avery_lounge">>
			<<set $avery_mansion.chase.bus to "hallway_1_e">>
			<<set $avery_mansion.chase.avery_bus to "lounge">>
		<<case "avery_dining">>
			<<set $avery_mansion.chase.bus to "hallway_1_w">>
			<<set $avery_mansion.chase.avery_bus to "dining">>
		<<case "avery_kitchen">>
			<<set $avery_mansion.chase.bus to "hallway_1_w">>
			<<set $avery_mansion.chase.avery_bus to "kitchen">>
		<<case "avery_display">>
			<<set $avery_mansion.chase.bus to "hallway_1_e">>
			<<set $avery_mansion.chase.avery_bus to "display">>
		<<case "avery_garage">>
			<<set $avery_mansion.chase.bus to "garden">>
			<<set $avery_mansion.chase.avery_bus to "garage">>
		<<case "avery_bedroom">>
			<<set $avery_mansion.chase.bus to "hallway_2_w">>
			<<set $avery_mansion.chase.avery_bus to "bedroom">>
		<<case "avery_bathroom">>
			<<set $avery_mansion.chase.bus to "bedroom">>
			<<set $avery_mansion.chase.avery_bus to "bathroom">>
		<<case "avery_study">>
			<<set $avery_mansion.chase.bus to "hallway_3">>
			<<set $avery_mansion.chase.avery_bus to "study">>
		<<case "avery_garden">>
			<<set $avery_mansion.chase.bus to "hallway_1">>
			<<set $avery_mansion.chase.avery_bus to "garden">>
		<<case "avery_pool">>
			<<set $avery_mansion.chase.bus to "hallway_1_w">>
			<<set $avery_mansion.chase.avery_bus to "pool">>
		<<case "avery_dungeon">>
			<<set $avery_mansion.chase.bus to "hallway_1_w">>
			<<set $avery_mansion.chase.avery_bus to "dungeon">>
		<<default>>
			<<set $avery_mansion.chase.bus to "hallway_1">>
			<<set $avery_mansion.chase.avery_bus to "lounge">>
	<</switch>>
	<<set $avery_mansion.chase.sound to "none">>
	<<set $avery_mansion.chase.player_sound to "none">>
	<<set $avery_mansion.chase.key to false>>
	<<set $avery_mansion.chase.key_checked to []>>
	<<set $avery_mansion.chase.gear to []>>
	<<set $avery_mansion.chase.trap to []>>
	<<set $avery_mansion.chase.trap_done to []>>
	<<rng 5>>
	<<switch $rng>>
		<<case 1>>
			<<set $avery_mansion.chase.key_location to "bedroom">>
		<<case 2>>
			<<set $avery_mansion.chase.key_location to "bathroom">>
		<<case 3>>
			<<set $avery_mansion.chase.key_location to "study">>
		<<case 4>>
			<<set $avery_mansion.chase.key_location to "lounge">>
		<<default>>
			<<set $avery_mansion.chase.key_location to "garage">>
	<</switch>>
<</widget>>

<<widget "avery_mansion_chase_end">>
	<<set $avery_mansion.chase to {}>>
<</widget>>

<<widget "avery_mansion_chase_trap">>
	<<set $avery_mansion.chase.trap.push(_args[0])>>
	<<set $avery_mansion.chase.trap_done.push(_args[0])>>
<</widget>>

<<widget "avery_mansion_chase">>
	<span class="red">Avery is hunting you.</span>
	<br><br>

	<<set $_averysound to "">>
	<<switch $avery_mansion.chase.bus>>
		<<case "lounge">>
			<<if $avery_mansion.chase.avery_bus is "display">>
				<<set $_averysound to "You hear avery in the display room, knocking pedestals aside in <<his>> haste.">>
				<<avery_housework_change "display" 1>>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1_w">>
				<<set $_averysound to "You hear Avery smack the wall in the hallway outside, followed by one of the paintings hitting the floor.">>
			<</if>>
		<<case "dining">>
			<<if $avery_mansion.chase.avery_bus is "kitchen">>
				<<set $_averysound to "You hear Avery in the kitchen, slamming cupboards shut after checking for you.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1_e">>
				<<set $_averysound to "You hear Avery lurking in the hallway outside, searching for you.">>
			<</if>>
		<<case "kitchen">>
			<<if $avery_mansion.chase.avery_bus is "dining">>
				<<set $_averysound to "You hear a chair skid across the dining room table.">>
				<<avery_housework_change dining 1>>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1_e">>
				<<set $_averysound to "You hear Avery in the hallway outside, scraping <<his>> fingernails against the wall as <<he>> walks.">>
			<<elseif $avery_mansion.chase.avery_bus is "garage">>
				<<set $_averysound to "You make out Avery walking through the garage.">>
			<</if>>
		<<case "display">>
			<<if $avery_mansion.chase.avery_bus is "lounge">>
				<<set $_averysound to "You hear Avery kick a cushion across the lounge.">>
				<<avery_housework_change lounge 1>>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1_w">>
				<<set $_averysound to "You hear Avery in the hallway outside, tapping the wall as <<he>> walks.">>
			<</if>>
		<<case "garage">>
			<<if $avery_mansion.chase.avery_bus is "kitchen">>
				<<set $_averysound to "You hear a drawer slam in the kitchen.">>
			<<elseif $avery_mansion.chase.avery_bus is "garden">>
				<<set $_averysound to "You spy Avery in the garden through a small window, pulling the heads off roses, thorns drawing blood.">>
			<</if>>
		<<case "garden">>
			<<if $avery_mansion.chase.avery_bus is "hallway_1">>
				<<set $_averysound to "You hear Avery in the atrium, <<his>> shoes tapping on the hard floor.">>
			<<elseif $avery_mansion.chase.avery_bus is "garage">>
				<<set $_averysound to "You spy Avery in the garage, taking <<his>> anger out on everything but the cars.">>
			<<elseif $avery_mansion.chase.avery_bus is "pool">>
				<<set $_averysound to "You hear something heavy splash into the pool.">>
			<</if>>
		<<case "pool">>
			<<if $avery_mansion.chase.avery_bus is "garden">>
				<<set $_averysound to "The heads of decapitated roses fly into view. Avery is in the garden.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1_w">>
				<<set $_averysound to "You spy Avery in the mansion, back turned to you, just inside the back door.">>
			<</if>>
		<<case "bedroom">>
			<<if $avery_mansion.chase.avery_bus is "bathroom">>
				<<set $_averysound to "You hear Avery in the bathroom, turning on the taps.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_2_w">>
				<<set $_averysound to "You hear Avery in the hallway outside, checking the spare rooms, slamming each door.">>
			<</if>>
		<<case "bathroom">>
			<<if $avery_mansion.chase.avery_bus is "bedroom">>
				<<set $_averysound to "You hear Avery in the bedroom, searching for you in the wardrobe.">>
			<</if>>
		<<case "study">>
			<<if $avery_mansion.chase.avery_bus is "hallway_3">>
				<<set $_averysound to "You hear Avery in the hallway outside, trapping you.">>
			<</if>>
		<<case "hallway_1">>
			<<if $avery_mansion.chase.avery_bus is "garden">>
				<<set $_averysound to "You hear Avery in the garden, stomping straight through a bush.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_2">>
				<<set $_averysound to "You hear Avery upstairs.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1_w">>
				<<set $_averysound to "You hear Avery in the hallway between here and the lounge.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1_e">>
				<<set $_averysound to "You hear Avery in the hallway between here and the dining room.">>
			<</if>>
		<<case "hallway_1_w">>
			<<if $avery_mansion.chase.avery_bus is "lounge">>
				<<set $_averysound to "You hear Avery move the sofa in the lounge, perhaps checking for you behind it.">>
				<<avery_housework_change "lounge" 1>>
			<<elseif $avery_mansion.chase.avery_bus is "display">>
				<<set $_averysound to "You hear Avery in the display room, showing the antiques no respect.">>
				<<avery_housework_change "display" 1>>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1">>
				<<set $_averysound to "You hear Avery kick the staircase in the atrium.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1_e">>
				<<set $_averysound to "You hear Avery further up the hallway.">>
			<</if>>
		<<case "hallway_1_e">>
			<<if $avery_mansion.chase.avery_bus is "dining">>
				<<set $_averysound to "You hear Avery in the dining room, throwing chairs aside.">>
				<<avery_housework_change "dining" 1>>
			<<elseif $avery_mansion.chase.avery_bus is "kitchen">>
				<<set $_averysound to "You hear Avery in the kitchen, throwing cutlery at the wall.">>
				<<avery_housework_change "kitchen" 1>>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1">>
				<<set $_averysound to "You hear Avery in the atrium, <<his>> footfalls so hard you're surprised <<he>> doesn't shatter the floor.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_1_w">>
				<<set $_averysound to "You hear Avery further up the hallway.">>
			<</if>>
		<<case "hallway_2">>
			<<if $avery_mansion.chase.avery_bus is "hallway_1">>
				<<set $_averysound to "You hear Avery's footsteps echo from the atrium downstairs.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_2_w">>
				<<set $_averysound to "You hear Avery in the hallway between here and the bedroom.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_2_e">>
				<<set $_averysound to "You hear Avery in the hallway between here and the study.">>
			<</if>>
		<<case "hallway_2_w">>
			<<if $avery_mansion.chase.avery_bus is "hallway_2">>
				<<set $_averysound to "You hear the landing creak nearby.">>
			<<elseif $avery_mansion.chase.avery_bus is "bedroom">>
				<<set $_averysound to "You hear Avery open the balcony doors in the bedroom.">>
			<</if>>
		<<case "hallway_2_e">>
			<<if $avery_mansion.chase.avery_bus is "hallway_2">>
				<<set $_averysound to "You hear the landing floor creak.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_3">>
				<<set $_averysound to "You hear footsteps above you.">>
			<</if>>
		<<case "hallway_3">>
			<<if $avery_mansion.chase.avery_bus is "study">>
				<<set $_averysound to "You hear thumping from the study.">>
			<<elseif $avery_mansion.chase.avery_bus is "hallway_2_w">>
				<<set $_averysound to "You hear Avery tear a panel from the wall downstairs.">>
			<</if>>
	<</switch>>
	<<if $avery_mansion.chase.sound isnot "none">>
		<<avery_mansion_chase_sound $avery_mansion.chase.sound>>
	<</if>>
	<<avery_mansion_player_sound $avery_mansion.chase.bus>>

	<<if $_averysound isnot "">>
		<span class="pink"><<= $_averysound>></span>
		<br><br>
	<<elseif _averyHear>>
		<br><br>
	<</if>>
<</widget>>

<<widget "avery_mansion_chase_location">>
<<set $avery_mansion.chase.sound to "none">>
<<if $avery_mansion.chase.trap.includes($avery_mansion.chase.avery_bus)>>
	<<set $avery_mansion.chase.trap.delete($avery_mansion.chase.avery_bus)>>
	<<set $avery_mansion.chase.sound to $avery_mansion.chase.avery_bus>>
<</if>>
<<if $avery_mansion.chase.sound is "garage" or $avery_mansion.chase.sound is "pool" or $avery_mansion.chase.sound is "hallway_2">>

<<elseif _args[0] is "sound_stairs_1">>
	<<if $avery_mansion.chase.avery_bus is "bedroom" or
	$avery_mansion.chase.avery_bus is "bathroom" or
	$avery_mansion.chase.avery_bus is "study" or
	$avery_mansion.chase.avery_bus is "hallway_2_w" or
	$avery_mansion.chase.avery_bus is "hallway_2_e" or
	$avery_mansion.chase.avery_bus is "hallway_2" or
	$avery_mansion.chase.avery_bus is "hallway_3">>
		<<set $avery_mansion.chase.avery_bus to "hallway_2">>
	<<else>>
		<<set $avery_mansion.chase.avery_bus to "hallway_1">>
	<</if>>
<<elseif _args[0] is "sound_stairs_2">>
	<<if $avery_mansion.chase.avery_bus is "study">>
		<<set $avery_mansion.chase.avery_bus to "hallway_3">>
	<<else>>
		<<set $avery_mansion.chase.avery_bus to "hallway_2_e">>
	<</if>>
<<elseif _args[0]>>
	<<set $avery_mansion.chase.avery_bus to _args[0]>>
<<elseif $avery_mansion.chase.player_sound isnot "none">>
	<<set $avery_mansion.chase.avery_bus to $avery_mansion.chase.player_sound>>
<<else>>
	<<switch $avery_mansion.chase.avery_bus>>
		<<case "lounge">>
			<<rng 2>>
			<<if $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "display">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "display">>
					<<avery_housework_change "display" 1>>
				<</if>>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1_w">>
			<</if>>
		<<case "dining">>
			<<rng 2>>
			<<if $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "kitchen">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "kitchen">>
					<<avery_housework_change "kitchen" 1>>
				<</if>>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1_e">>
			<</if>>
		<<case "kitchen">>
			<<rng 3>>
			<<if $rng is 3>>
				<<set $avery_mansion.chase.avery_bus to "dining">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "dining">>
					<<avery_housework_change "dining" 1>>
				<</if>>
			<<elseif $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "garage">>
				<<if $avery_mansion.chase.trap.includes("garage")>>
					<<set $avery_mansion.chase.sound to "garage">>
				<</if>>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1_e">>
			<</if>>
		<<case "display">>
			<<rng 2>>
			<<if $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "lounge">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "lounge">>
					<<avery_housework_change "lounge" 1>>
				<</if>>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1_w">>
			<</if>>
		<<case "garage">>
			<<rng 2>>
			<<if $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "kitchen">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "kitchen">>
					<<avery_housework_change "kitchen" 1>>
				<</if>>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "garden">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "garden">>
					<<avery_housework_change "garden" 1>>
				<</if>>
			<</if>>
		<<case "garden">>
			<<rng 3>>
			<<if $rng is 3>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1">>
				<<set $avery_mansion.chase.sound to "front_door">>
			<<elseif $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "garage">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "garage">>
					<<avery_housework_change "garage" 1>>
				<</if>>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "pool">>
				<<if $avery_mansion.chase.trap.includes("pool")>>
					<<set $avery_mansion.chase.sound to "pool">>
				<<elseif random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "pool">>
					<<avery_housework_change "pool" 1>>
				<</if>>
			<</if>>
		<<case "pool">>
			<<rng 2>>
			<<if $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1_w">>
				<<set $avery_mansion.chase.sound to "back_door">>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "garden">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "garden">>
					<<avery_housework_change "garden" 1>>
				<</if>>
			<</if>>
		<<case "bedroom">>
			<<rng 2>>
			<<if $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "hallway_2_w">>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "bathroom">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "bathroom">>
					<<avery_housework_change "bathroom" 1>>
				<</if>>
			<</if>>
		<<case "bathroom">>
			<<set $avery_mansion.chase.avery_bus to "bedroom">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "bedroom">>
					<<avery_housework_change "bedroom" 1>>
				<</if>>
		<<case "study">>
			<<set $avery_mansion.chase.avery_bus to "hallway_3">>
		<<case "dungeon">>
			<<set $avery_mansion.chase.avery_bus to "study">>
		<<case "hallway_1">>
			<<rng 4>>
			<<if $rng is 4>>
				<<if $avery_mansion.chase.trap.includes("hallway_2")>>
					<<set $avery_mansion.chase.sound to "hallway_2">>
					<<set $avery_mansion.chase.avery_bus to "hallway_1">>
				<<else>>
					<<set $avery_mansion.chase.avery_bus to "hallway_2">>
					<<set $avery_mansion.chase.sound to "main_stair">>
				<</if>>
			<<elseif $rng is 3>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1_w">>
			<<elseif $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1_e">>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "garden">>
				<<set $avery_mansion.chase.sound to "front_door">>
			<</if>>
		<<case "hallway_1_e">>
			<<rng 4>>
			<<if $rng is 4>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1_w">>
			<<elseif $rng is 3>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1">>
			<<elseif $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "dining">>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "kitchen">>
			<</if>>
		<<case "hallway_1_w">>
			<<rng 5>>
			<<if $rng is 5>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1_e">>
			<<elseif $rng is 4>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1">>
			<<elseif $rng is 3>>
				<<set $avery_mansion.chase.avery_bus to "lounge">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "lounge">>
					<<avery_housework_change "lounge" 1>>
				<</if>>
			<<elseif $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "display">>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "pool">>
				<<if $avery_mansion.chase.trap.includes("pool")>>
					<<set $avery_mansion.chase.sound to "pool">>
				<<else>>
					<<set $avery_mansion.chase.sound to "back_door">>
				<</if>>
			<</if>>
		<<case "hallway_2">>
			<<rng 3>>
			<<if $rng is 3>>
				<<set $avery_mansion.chase.avery_bus to "hallway_2_w">>
			<<elseif $rng is 2>>
				<<set $avery_mansion.chase.avery_bus to "hallway_2_e">>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "hallway_1">>
				<<set $avery_mansion.chase.sound to "main_stair">>
			<</if>>
		<<case "hallway_2_w">>
			<<rng 2>>
			<<if $rng is 2>>
				<<if $avery_mansion.chase.trap.includes("hallway_2")>>
					<<set $avery_mansion.chase.sound to "hallway_2">>
					<<set $avery_mansion.chase.avery_bus to "hallway_1">>
				<<else>>
					<<set $avery_mansion.chase.avery_bus to "hallway_2">>
				<</if>>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "bedroom">>
			<</if>>
		<<case "hallway_2_e">>
			<<rng 2>>
			<<if $rng is 2>>
				<<if $avery_mansion.chase.trap.includes("hallway_2")>>
					<<set $avery_mansion.chase.sound to "hallway_2">>
					<<set $avery_mansion.chase.avery_bus to "hallway_1">>
				<<else>>
					<<set $avery_mansion.chase.avery_bus to "hallway_2">>
				<</if>>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "hallway_3">>
				<<set $avery_mansion.chase.sound to "study_stair">>
			<</if>>
		<<case "hallway_3">>
			<<rng 3>>
			<<if $rng is 3>>
				<<set $avery_mansion.chase.avery_bus to "study">>
				<<if random(1, 3) is 3>>
					<<set $avery_mansion.chase.sound to "study">>
					<<avery_housework_change "study" 1>>
				<</if>>
			<<else>>
				<<set $avery_mansion.chase.avery_bus to "hallway_2_e">>
				<<set $avery_mansion.chase.sound to "study_stair">>
			<</if>>
	<</switch>>
<</if>>
<<if $avery_mansion.chase.avery_bus is $avery_mansion.chase.player_sound>>
	<<set $avery_mansion.chase.player_sound to "none">>
<</if>>
<</widget>>

<<widget "avery_mansion_chase_sound">>
	<<if _args[0] is "garage" and $avery_mansion.chase.trap.includes("garage")>>
		Avery roars in anguish. <<He>> found your handiwork in the garage.<<gfrustration>><<set $avery_mansion.chase.health -= 1>>
		<<set $avery_mansion.chase.trap.delete("garage")>>
	<<elseif _args[0] is "pool" and $avery_mansion.chase.trap.includes("pool")>>
		Avery cries out. It's soon followed by a loud splash. <<He>> slipped on your oil, and fell into the pool.<<gfrustration>><<set $avery_mansion.chase.health -= 1>>
		<<set $avery_mansion.chase.trap.delete("pool")>>
	<<elseif _args[0] is "hallway_2">>
		<<if $avery_mansion.chase.trap.includes("hallway_2")>>
			Avery shouts in surprise. It's followed by a succession of thuds as <<he>> tumbles down the main stair. Your marbles did the trick.<<gfrustration>><<set $avery_mansion.chase.health -= 1>>
			<<set $avery_mansion.chase.trap.delete("hallway_2")>>
		<</if>>
	<<elseif _args[0] is "main_stair">>
		You hear the main staircase creak under Avery's feet.
	<<elseif _args[0] is "study_stair">>
		You hear the old staircase to the third floor creak under Avery's feet.
	<<elseif _args[0] is "front_door">>
		You hear the front door slam.
	<<elseif _args[0] is "back_door">>
		You hear the back door slam.
	<<else>>
		<<rng 10>>
		<<switch $rng>>
			<<case 10>>
				"Just wait until I find you,"
			<<case 9>>
				"I'll make you fucking respect me,"
			<<case 8>>
				"I bet you sleep with everyone in town. Everyone's laughing behind my back,"
			<<case 7>>
				"I'll treat you like the whore you are,"
			<<case 6>>
				"I'll remind you who you belong to,"
			<<case 5>>
				"Come out you worthless slut,"
			<<case 4>>
				"You think you're clever, hiding from me?"
			<<case 3>>
				"I'm gonna show you. I'll show everyone,"
			<<case 2>>
				"I've trodden in shit worth more than you,"
			<<default>>
				"Just you fucking wait,"
		<</switch>>
		<<he>> shouts from the <span class="blue"><<print _args[0]>><<if _args[0] is "dining" or _args[0] is "display">> room<</if>>.</span>
		<<switch _args[0]>>
			<<case "lounge">>
				<<if random(0, 1)>>
					You hear a drinking glass shatter.
				<<else>>
					You hear a series of dissonant piano notes, followed by a slam.
				<</if>>
			<<case "dining">>
				You hear wood crack.
			<<case "display">>
				You hear glass shatter.
			<<case "kitchen">>
				You hear plates shatter.
			<<case "garden">>
				You hear a pot smash.
			<<case "pool">>
				You hear something splash into the pool.
			<<case "bedroom">>
				You hear the bed scrape across the floor.
			<<case "bathroom">>
				You hear a tile shatter.
			<<case "study">>
				You hear the thud of books thrown across the room.
		<</switch>>
	<</if>>
	<br><br>
<</widget>>

<<widget "avery_mansion_chase_links">> /* Puts PC in current room */
	<<switch $avery_mansion.chase.bus>>
		<<case "lounge">>
			<<icon "avery_lounge.png">><<link [[Next|Mansion Chase Lounge]]>><</link>>
			<br>
		<<case "dining">>
			<<icon "avery_dining.png">><<link [[Next|Mansion Chase Dining]]>><</link>>
			<br>
		<<case "kitchen">>
			<<icon "avery_kitchen.png">><<link [[Next|Mansion Chase Kitchen]]>><</link>>
			<br>
		<<case "display">>
			<<icon "avery_display.png">><<link [[Next|Mansion Chase Display]]>><</link>>
			<br>
		<<case "garage">>
			<<icon "avery_garage.png">><<link [[Next|Mansion Chase Garage]]>><</link>>
			<br>
		<<case "garden">>
			<<icon "avery_garden.gif">><<link [[Next|Mansion Chase Garden]]>><</link>>
			<br>
		<<case "pool">>
			<<icon "avery_pool.png">><<link [[Next|Mansion Chase Pool]]>><</link>>
			<br>
		<<case "bedroom">>
			<<icon "avery_bedroom.png">><<link [[Next|Mansion Chase Bedroom]]>><</link>>
			<br>
		<<case "bathroom">>
			<<icon "avery_bathroom.png">><<link [[Next|Mansion Chase Bathroom]]>><</link>>
			<br>
		<<case "study">>
			<<icon "avery_study.png">><<link [[Next|Mansion Chase Study]]>><</link>>
			<br>
		<<case "hallway_1">>
			<<icon "avery_atrium.png">><<link [[Next|Mansion Chase Hallway 1]]>><</link>>
			<br>
		<<case "hallway_1_w">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 1 W]]>><</link>>
			<br>
		<<case "hallway_1_e">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 1 E]]>><</link>>
			<br>
		<<case "hallway_2">>
			<<icon "avery_atrium.png">><<link [[Next|Mansion Chase Hallway 2]]>><</link>>
			<br>
		<<case "hallway_2_w">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 2 W]]>><</link>>
			<br>
		<<case "hallway_2_e">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 2 E]]>><</link>>
			<br>
		<<case "hallway_3">>
			<<icon "avery_study_hallway.png">><<link [[Next|Mansion Chase Hallway 3]]>><</link>>
			<br>
		<<default>>
			<<icon "avery_lounge.png">><<link [[Next|Mansion Chase Lounge]]>><</link>>
			<br>
	<</switch>>
<</widget>>

<<widget "avery_mansion_chase_run">> /* Moves PC to adjacent room */
	<<switch $avery_mansion.chase.bus>>
		<<case "lounge">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 1 W]]>><</link>>
			<br>
		<<case "dining">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 2 W]]>><</link>>
			<br>
		<<case "kitchen">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 2 W]]>><</link>>
			<br>
		<<case "display">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 1 W]]>><</link>>
			<br>
		<<case "garage">>
			<<icon "avery_kitchen.png">><<link [[Next|Mansion Chase Kitchen]]>><</link>>
			<br>
		<<case "garden">>
			<<icon "avery_atrium.png">><<link [[Next|Mansion Chase Hallway 1]]>><</link>>
			<br>
		<<case "pool">>
			<<icon "avery_pool.png">><<link [[Next|Mansion Chase Hallway 1 W]]>><</link>>
			<br>
		<<case "bedroom">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 2 W]]>><</link>>
			<br>
		<<case "bathroom">>
			<<icon "avery_bedroom.png">><<link [[Next|Mansion Chase Bedroom]]>><</link>>
			<br>
		<<case "study">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 3]]>><</link>>
			<br>
		<<case "hallway_1">>
			<<icon "avery_garden.gif">><<link [[Next|Mansion Chase Garden]]>><</link>>
			<br>
		<<case "hallway_1_w">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 1 E]]>><</link>>
			<br>
		<<case "hallway_1_e">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 1 W]]>><</link>>
			<br>
		<<case "hallway_2">>
			<<icon "avery_hallway.png">><<link [[Run towards the study|Mansion Chase Hallway 2 E]]>><</link>>
			<br>
			<<icon "avery_hallway.png">><<link [[Run towards the bedroom|Mansion Chase Hallway 2 W]]>><</link>>
			<br>
		<<case "hallway_2_w">>
			<<icon "avery_atrium.png">><<link [[Next|Mansion Chase Hallway 2]]>><</link>>
			<br>
		<<case "hallway_2_e">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 2]]>><</link>>
			<br>
		<<case "hallway_3">>
			<<icon "avery_hallway.png">><<link [[Next|Mansion Chase Hallway 2 E]]>><</link>>
			<br>
		<<default>>
			<<icon "avery_lounge.png">><<link [[Next|Mansion Chase Lounge]]>><</link>>
			<br>
	<</switch>>
<</widget>>

<<widget "avery_mansion_chase_tips">>
	<i>Avery will hunt you through the mansion. <<He>> will move to an adjacent room each time you take an action.
	<br>
	You'll hear <<him>> if <<hes>> in an adjacent room, but <<he>>'ll also hear you! Hiding will probably save you, but better not to risk it in the first place.
	<br>
	Don't let <<him>> catch you. Find a way to escape, or a way to turn things in your favour.</i>
<</widget>>

<<widget "avery_mansion_chase_caught">>
	<<rng 10>>
	<<switch $rng>>
		<<case 10>>
			"I could leave you in a ditch," <<he>> says. "No one would care."
		<<case 9>>
			"You thought you could fucking hide from me?" <<he>> says. "You're even more stupid than I thought."
		<<case 8>>
			"I've given you so much," <<he>> says. "And this is how you repay me."
		<<case 7>>
			"You're mine to do with as I please," <<he>> says. "Time to show you."
		<<case 6>>
			"Do you want me to leave you in the gutter with the rest of Bailey's trash?" <<he>> asks. "Is that what you want?"
		<<case 5>>
			"You think you're special?" <<he>> says. "I've chewed up and spat out better <<girl>>s than you."
		<<case 4>>
			"Maybe I'll sell you," <<he>> says. "If anyone will buy a used up toy like you."
		<<case 3>>
			"You think you mean anything to me?" <<he>> says. "You're just another worm."
		<<case 2>>
			"I could have anyone I want," <<he>> says. "You ungrateful slut."
		<<default>>
			"I could replace you," <<he>> says. "Plenty of worthless orphans would give anything to be mine."
	<</switch>>
	<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
	<br><br>
	<<link [[Apologise|Mansion Chase Apologise]]>><</link>>
	<br>
	<<link [[Brace yourself|Mansion Chase Brace]]>><</link>>
	<br>
<</widget>>

<<widget "avery_mansion_player_sound">>
<<if _args[0] is "lounge">>
	<<if $avery_mansion.chase.avery_bus is "display" or $avery_mansion.chase.avery_bus is "hallway_1_w">>
		<<set $avery_mansion.chase.player_sound to "lounge">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "kitchen">>
	<<if $avery_mansion.chase.avery_bus is "dining" or $avery_mansion.chase.avery_bus is "hallway_1_e">>
		<<set $avery_mansion.chase.player_sound to "kitchen">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "dining">>
	<<if $avery_mansion.chase.avery_bus is "kitchen" or $avery_mansion.chase.avery_bus is "hallway_1_e">>
		<<set $avery_mansion.chase.player_sound to "dining">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "display">>
	<<if $avery_mansion.chase.avery_bus is "lounge" or $avery_mansion.chase.avery_bus is "hallway_1_w">>
		<<set $avery_mansion.chase.player_sound to "display">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "garage">>
	<<if $avery_mansion.chase.avery_bus is "kitchen" or $avery_mansion.chase.avery_bus is "garden">>
		<<set $avery_mansion.chase.player_sound to "garage">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "garden">>
	<<if $avery_mansion.chase.avery_bus is "garage" or $avery_mansion.chase.avery_bus is "hallway_1" or $avery_mansion.chase.avery_bus is "pool">>
		<<set $avery_mansion.chase.player_sound to "garden">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "pool">>
	<<if $avery_mansion.chase.avery_bus is "garden" or $avery_mansion.chase.avery_bus is "hallway_1_w">>
		<<set $avery_mansion.chase.player_sound to "pool">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "bedroom">>
	<<if $avery_mansion.chase.avery_bus is "bathroom" or $avery_mansion.chase.avery_bus is "hallway_2_w">>
		<<set $avery_mansion.chase.player_sound to "bedroom">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "bathroom">>
	<<if $avery_mansion.chase.avery_bus is "bedroom">>
		<<set $avery_mansion.chase.player_sound to "bathroom">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "study">>
	<<if $avery_mansion.chase.avery_bus is "hallway_3">>
		<<set $avery_mansion.chase.player_sound to "study">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "hallway_1">>
	<<if $avery_mansion.chase.avery_bus is "hallway_1_e" or $avery_mansion.chase.avery_bus is "hallway_1_w" or $avery_mansion.chase.avery_bus is "garden">>
		<<set $avery_mansion.chase.player_sound to "hallway_1">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "hallway_1_w">>
	<<if $avery_mansion.chase.avery_bus is "display" or $avery_mansion.chase.avery_bus is "lounge" or $avery_mansion.chase.avery_bus is "garden" or $avery_mansion.chase.avery_bus is "hallway_1_e" or $avery_mansion.chase.avery_bus is "hallway_1">>
		<<set $avery_mansion.chase.player_sound to "hallway_1_w">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "hallway_1_e">>
	<<if $avery_mansion.chase.avery_bus is "dining" or $avery_mansion.chase.avery_bus is "kitchen" or $avery_mansion.chase.avery_bus is "hallway_1_w" or $avery_mansion.chase.avery_bus is "hallway_1">>
		<<set $avery_mansion.chase.player_sound to "hallway_1_e">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "hallway_2">>
	<<if $avery_mansion.chase.avery_bus is "hallway_1" or $avery_mansion.chase.avery_bus is "hallway_2_w" or $avery_mansion.chase.avery_bus is "hallway_2_e">>
		<<set $avery_mansion.chase.player_sound to "hallway_2">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "hallway_2_w">>
	<<if $avery_mansion.chase.avery_bus is "bedroom" or $avery_mansion.chase.avery_bus is "hallway_2">>
		<<set $avery_mansion.chase.player_sound to "hallway_2_w">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "hallway_2_e">>
	<<if $avery_mansion.chase.avery_bus is "hallway_2" or $avery_mansion.chase.avery_bus is "hallway_3">>
		<<set $avery_mansion.chase.player_sound to "hallway_2_e">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<<elseif _args[0] is "hallway_3">>
	<<if $avery_mansion.chase.avery_bus is "study" or $avery_mansion.chase.avery_bus is "hallway_2_e">>
		<<set $avery_mansion.chase.player_sound to "hallway_3">>
		<span class="red">Avery can hear you.</span>
	<</if>>
<</if>>
<<if $avery_mansion.chase.player_sound isnot "none">>
	<<set _averyHear to true>>
<</if>>
<</widget>>

<<widget "avery_mansion_trap_victory">>
	You hear the rumble of an engine, the rattle of the front gates, and the screech of Avery's tires as <<he>> drives away.
	<br><br>

	<span class="green">You're safe, for now.</span>
	<br><br>
	<<set $avery_mansion.away_timer to 7>>
	<<set $avery_mansion.schedule to "away">>
	<<endevent>>
	<<avery_mansion_chase_end>>
	<<avery_mansion_end_links>>
<</widget>>

<<widget "avery_mansion_study_unlock">>
	<<set $avery_mansion.study_unlocked to 1>>
	<<if C.npc.Avery.rage gte 20 and $averyragerevealed gte 1>>
		"Fine. But leave everything exactly as you find it."
	<<else>>
		"Alright. Be careful with the books. Some are quite valuable."
	<</if>>

	<<if $avery_mansion.schedule is "study">>

	<<elseif $avery_mansion.schedule is "bath">>
		Avery rises to <<his>> feet, steps from the bath, and grabs a towel on the way to the door.
	<<elseif $avery_mansion.schedule is "pool">>
		Avery pulls <<himself>> from the pool, and grabs a towel on the way inside.
	<<elseif $avery_mansion.schedule is "garden">>
		Avery walks away from the topiary, towards the entrance proper.
	<<elseif $avery_mansion.schedule is "lounge">>
		Avery rises to <<his>> feet, and walks towards the stairs.
	<<elseif $avery_mansion.schedule is "drink">>
		Avery rises to <<his>> feet, then leans forward to place <<his>> drink on the table.
	<<else>>

	<</if>>
	<br><br>
	<<if $avery_mansion.schedule isnot "study">>
		You follow Avery through the mansion, and up the flight of steps leading to the study. <<He>> pushes the key into the lock. It clicks open.
		<br><br>
	<</if>>

	<<endevent>>
	<<link [[Next|Mansion Study]]>><</link>>
	<br>

<</widget>>

<<widget "avery_mansion_vault_progress">>
	Progress:
	<<if $avery_mansion.vault_progress gte 90>>
		<span class="green"><<print $avery_mansion.vault_progress>>%</span>
	<<elseif $avery_mansion.vault_progress gte 75>>
		<span class="teal"><<print $avery_mansion.vault_progress>>%</span>
	<<elseif $avery_mansion.vault_progress gte 60>>
		<span class="lblue"><<print $avery_mansion.vault_progress>>%</span>
	<<elseif $avery_mansion.vault_progress gte 45>>
		<span class="blue"><<print $avery_mansion.vault_progress>>%</span>
	<<elseif $avery_mansion.vault_progress gte 30>>
		<span class="purple"><<print $avery_mansion.vault_progress>>%</span>
	<<elseif $avery_mansion.vault_progress gte 15>>
		<span class="pink"><<print $avery_mansion.vault_progress>>%</span>
	<<else>>
		<span class="red"><<print $avery_mansion.vault_progress>>%</span>
	<</if>>
<</widget>>

<<widget "gaverytiredness">>
	<<if $statdisable is "f">> |
		<span class="green">+ Avery's fatigue</span>
	<</if>>
<</widget>>

<<widget "gtowerprogress">>
	<<if $statdisable is "f">> |
		<span class="green">+ Building progress</span>
	<</if>>
<</widget>>

<<widget "ltowerprogress">>
	<<if $statdisable is "f">> |
		<span class="red">- Building progress</span>
	<</if>>
<</widget>>

<<widget "avery_mansion_party_start_links">>
	<<avery_mansion_party_init>>
	<<if $avery_mansion.guest is "Bailey">>
		<<npc "Bailey" 2>><<generate3>><<generate4>><<generate5>><<summon_brown_fox 6>>
		You walk with Avery towards the atrium. The front doors are open. Several cars are already parked, and more are arriving. A security guard checks each arrival for an invitation, then waves them through. Other staff stand ready to escort them inside, or provide assistance.
		<br><br>
		A familiar face is the first to cross the threshold. <span class="pink">Bailey.</span>
		<br><br>

		How should you conduct yourself?
		<br><br>

		<<link [[Sophisticated|Mansion Party Bailey]]>><<set $avery_party.conduct to "sophisticated">><</link>>
		<br>
		<<link [[Cute|Mansion Party Bailey]]>><<set $avery_party.conduct to "cute">><</link>>
		<br>
		<<link [[Aloof|Mansion Party Bailey]]>><<set $avery_party.conduct to "aloof">><</link>>
		<br>
	<<elseif $avery_mansion.guest is "Quinn">>
		<<if ($avery_tower.progress gte 40 or $world_corruption_hard gte 3) and !$avery_mansion.jordan_intro>>
			<<if !C.npc.Jordan.init>>
				<<set $avery_party.jordan_init to true>>
			<</if>>
			<<if $avery_party.task and $avery_mansion.fox.task is "Quinn">>
				<<set $avery_party.task to false>>
			<</if>>
			<<npc "Jordan" 2>>
			<<if $per_npc.bishop_right_hand>>
				<<loadNPC 2 "bishop_right_hand">><<loadNPC 3 "bishop_left_hand">>
			<<else>>
				<<generateConfessor 3>><<set _generate_partner to 1>><<generateConfessor 4>>
				<<saveNPC 2 "bishop_right_hand">><<saveNPC 3 "bishop_left_hand">>
			<</if>>
			<<generate5>><<generate6>>
			Avery leads you to the atrium, where a servant rushes up to <<him>>, clothes disheveled.
			<br><br>
			"Some <<monks_and_nuns>> have come from the temple," <<person5>><<he>> says. "They insist they have an invitation."
			<br>
			"I sent no such invitation," Avery says. "Where's the mayor?"
			<br>
			"That's the other thing. The mayor arrived, saw the <<monks_and_nuns>>, and drove away. Sorry <<person1>><<sir>>."
			<br><br>
			Avery clenches <<his>> fist. The servant scurries away.
			<br><br>

			<<link [[Next|Mansion Party Jordan]]>><<set $avery_mansion.guest to "Jordan">><</link>>
			<br>
		<<else>>
			<<npc "Quinn" 2>><<generatev3>><<generatev4>><<generate5>><<generate6>>
			Avery leads you to the atrium. The front doors burst open, and Quinn strides through, a smiling <<person3>><<person>> and <<person4>><<person>> hanging off <<person2>><<his>> arms.
			<br><br>

			"Avery!" Quinn says, reaching out to shake hands. "Thank you for inviting me. Where's the wine? Ah!" <<He>> takes a glass offered by one of Avery's servants. "Is the pool available?"
			<br><br>
			"Of course," Avery says. "Make yourself at home."
			<br><br>
			Quinn starts removing <<person2>><<his>> jacket, and walks in the direction of the swimming pool. <<His>> companions disrobe before even leaving the atrium, revealing swimming suits.
			<br><br>

			<<link [[Next|Mansion Party Quinn]]>><</link>>
			<br>
		<</if>>
	<<elseif $avery_mansion.guest is "Jordan">>
		<<npc "Jordan" 2>>
		<<if $per_npc.bishop_right_hand>>
			<<loadNPC 2 "bishop_right_hand">><<loadNPC 3 "bishop_left_hand">>
		<<else>>
			<<generateConfessor 3>><<set _generate_partner to 1>><<generateConfessor 4>>
			<<saveNPC 2 "bishop_right_hand">><<saveNPC 3 "bishop_left_hand">>
		<</if>>
		<<generate5>><<generate6>>
		Avery leads you to the atrium. Servants rush by, on their way out, making way for the temple initiates.
		<br><br>
		You wait at the base of the stairs, facing the front doors. You hear voices approaching, singing a hymn. A vein throbs in Avery's temple.
		<br><br>
		<<link [[Next|Mansion Party Jordan]]>><</link>>
		<br>
	<<elseif $avery_mansion.guest is "Remy">>
		<<npc "Remy" 2>><<generate3>><<generate4>><<generate5>><<generatev6>>
		<<set $remySeen.pushUnique("avery_mansion")>>
		Avery leads you to the atrium. The servants have arranged themselves in a line on each side, creating a pathway to the centre of the room. The doors stand open, and you hear the first guests arrive.
		<br><br>
		"Be on your best behaviour," Avery says. "Remy is from a good family.
		<<if $averyragerevealed gte 1>>
			You can pretend your roots aren't so sordid for one evening."
		<<else>>
			Best not mention your low roots."
		<</if>>
		<br><br>
		The tension in the room rises as Remy appears before the door. <<person2>><<He>> steps through, and approaches Avery.
		<br><br>

		"Welcome Remy," Avery says. "Thank you for joining us. It's a pleasure to have you."
		<br>
		"The pleasure is mine," Remy says. Then <<he>> regards you.
		<br><br>

		<<link [[Greet|Mansion Party Remy Greet]]>><</link>>
		<br>
		<<link [[Raise your hand|Mansion Party Remy Hand]]>><</link>>
		<br>
		<<link [[Remain silent|Mansion Party Remy Silent]]>><</link>>
		<br>
	<<elseif $avery_mansion.guest is "Briar">>
		<<if C.npc.Briar.init is 1>>
			<<npc "Briar" 2>><<generate3>><<generate4>><<generate5>><<generate6>>
			Avery leads you to the atrium. "Keep in mind that Briar is a common sort," <<person1>><<he>> says. "Don't let any bad habits surface. Keep up your decorum."
			<br><br>
			Two servants push open the doors. Briar is the first to enter. <<person2>><<He>> swans down the middle of the room, and
			<<if $pronoun is "f">>curtsies<<else>>bows<</if>> before Avery.
			<br><br>
			"Welcome to my mansion," Avery says. "Please, make yourself at home."
			<br>
			"Oh I will." Briar smiles at you. "Always a pleasure."
		<<else>>
			<<npc "Briar" 2>><<generate3>><<generate4>><<generate5>><<generate6>>
			Avery leads you to the atrium. "Keep in mind that Briar is a common sort," <<person1>><<he>> says. "Don't let any bad habits surface. Keep up your decorum."
			<br><br>
			Two servants push open the doors. Briar is the first to enter. <<person2>><<He>> swans down the middle of the room, and
			<<if $pronoun is "f">>curtsies<<else>>bows<</if>> before Avery.
			<br><br>
			"Welcome to my mansion," Avery says. "Please, make yourself at home."
			<br>
			"Oh I will." Briar smiles at you. "You must be the one I've heard so much about. Part of me thinks it a shame you've risen to these heights, without falling into my lap first."
		<</if>>
		<br><br>
		Briar leaves for the lounge as the next guest arrives.
		<br><br>
		<<link [[Next|Mansion Party Briar]]>><</link>>
		<br>
	<<elseif $avery_mansion.guest is "Harper">>
		<<npc "Harper" 2>><<generate3>><<generateyv4>><<generateyv5>><<generateyv6>>
		Avery leads you to the atrium. "The Doctor has low roots," Avery says. "But <<nnpc_hes "Harper">> risen far. Show proper respect."
		<br><br>
		The atrium doors open, and the first guests arrive. The Doctor isn't among them, but you hang off Avery's arm while <<he>> greets the arrivals.
		<br><br>
		The last enters, and Avery looks anxious for a few moments, until a final car arrives at the gates.
		<br><br>

		<<link [[Next|Mansion Party Harper]]>><</link>>
		<br>
	<</if>>
<</widget>>

<<widget "avery_mansion_party_init">>
	<<set $avery_party to {}>>
	<<set $avery_party.speech_guest to []>>
	<<set $avery_party.speech_avery to []>>
	<<set $avery_party.guests to []>>
	<<set $avery_party.stage to 0>>
	<<set $avery_party.current_speech to "intro">>
	<<set $avery_party.mood_guest to 0>>
	<<set $avery_party.mood_avery to 0>>
	<<set $avery_mansion.party_state to "started">>
	<<famesocial 15>>

	/* The party intro scenes always involve Avery bringing the player to the atrium */
	<<set $outside to 0>>

	<<if $avery_mansion.fox.task is $avery_mansion.guest and !$avery_mansion.fox.task_complete and !$avery_fate>>
		<<set $avery_party.task to true>>
	<</if>>
<</widget>>

<<widget "avery_mansion_party_end">>
	<<unset $avery_party>>
	<<set $avery_mansion.party_state to "finished">>
	<<if !$avery_mansion.party_guests_seen>>
		<<set $avery_mansion.party_guests_seen to []>>
	<</if>>

	<<run const rotation = {
		Bailey: "Quinn",
		Quinn: "Remy",
		Remy: "Briar",
		Briar: "Harper",
		Harper: V.avery_mansion.jordan_intro ? "Jordan" : "Quinn",
		Jordan: "Quinn",
	};
	V.avery_mansion.guest = rotation[V.avery_mansion.guest];>>

	<<set $avery_mansion.party_guests_seen.pushUnique($avery_mansion.guest)>>
<</widget>>

<<widget "avery_mansion_party_speech">>
	<<if _args[0] and _args[1]>>
		<<if _args[0] is "Avery">>
			<<set $avery_party.speech_avery.push(_args[1])>>
		<<else>>
			<<set $avery_party.speech_guest.push(_args[1])>>
		<</if>>
		<<set $avery_party.current_speech to _args[1]>>
	<</if>>
<</widget>>

<<widget "avery_mansion_party_mood">>
	<<if _args[0] and _args[1]>>
		<<if _args[0] is "Avery">>
			<<set $avery_party.mood_avery += _args[1]>>
		<<else>>
			<<set $avery_party.mood_guest += _args[1]>>
		<</if>>
	<</if>>
<</widget>>

<<widget "avery_mansion_tower_negative_effects">>
	<<if _args[0] is "Jordan">>
		<<if !$avery_tower.effects.includes("temple")>>
			<<set $avery_tower.effects.pushUnique("temple")>>
			<span class="gold"><<Monks_and_Nuns>> from the temple will obstruct the construction of Avery's project.</span>
		<<else>>
			<span class="gold"><<Monks_and_Nuns>> from the temple will continue to obstruct the construction of Avery's project.</span>
		<</if>>
	<<elseif _args[0] is "Quinn">>
		<<if $avery_tower.effects.includes("mayor")>>
			<<set $avery_tower.effects.delete("mayor")>>
			<span class="gold">Quinn will no longer help Avery cut through red tape for the sake of <<nnpc_his "Avery">> building project.</span>
		<</if>>
	<<elseif _args[0] is "Remy">>
		<<if $avery_tower.effects.includes("Remy")>>
			<<set $avery_tower.effects.delete("Remy")>>
			<span class="gold">Remy will no longer provide financial aid to Avery's building project.</span>
		<</if>>
	<<elseif _args[0] is "Briar">>
		<<if !$avery_tower.effects.includes("theft")>>
			<<set $avery_tower.effects.pushUnique("theft")>>
			<span class="gold">Briar will no longer protect Avery's project from the criminal underworld.</span>
		<<else>>
			<span class="gold">The town's underworld will continue to sabotage Avery's project for profit.</span>
		<</if>>
	<<elseif _args[0] is "Harper">>
		<<if $avery_tower.effects.includes("Harper")>>
			<<set $avery_tower.effects.delete("Harper")>>
			<span class="gold">Harper will no longer provide assistance to Avery's building project.</span>
		<</if>>
	<</if>>
<</widget>>

<<widget "avery_mansion_party_guests_links">>
<<if $avery_party.stage gte 3>>
	You hear the dinner bell ring throughout the mansion. The guests meander towards the dining room.
	<br><br>
	<<link [[Next|Mansion Party Remy 2]]>><</link>>
	<br>
<<else>>
	Which guests will you speak with?
	<br><br>
	<<if !$avery_party.guests.includes("lounge")>>
		<<link [[The guests in the lounge|Mansion Party Remy Lounge]]>><<dry>><<pass 20>><<set $avery_party.stage += 1>><<set $avery_party.guests.push("lounge")>><</link>>
		<br>
	<</if>>
	<<if !$avery_party.guests.includes("display")>>
		<<link [[The guests in the display room|Mansion Party Remy Display]]>><<dry>><<pass 20>><<set $avery_party.stage += 1>><<set $avery_party.guests.push("display")>><</link>>
		<br>
	<</if>>
	<<if !$avery_party.guests.includes("garden")>>
		<<link [[The guests in the garden|Mansion Party Remy Garden]]>><<dry>><<pass 20>><<set $avery_party.stage += 1>><<set $avery_party.guests.push("garden")>><</link>>
		<br>
	<</if>>
	<<if !$avery_party.guests.includes("pool")>>
		<<link [[The guests around the pool|Mansion Party Remy Pool]]>><<dry>><<pass 20>><<set $avery_party.stage += 1>><<set $avery_party.guests.push("pool")>><</link>>
		<br>
	<</if>>
	<<if !$avery_party.guests.includes("atrium")>>
		<<link [[The guests in the atrium|Mansion Party Remy Atrium]]>><<dry>><<pass 20>><<set $avery_party.stage += 1>><<set $avery_party.guests.push("atrium")>><</link>>
		<br>
	<</if>>
	<<if !$avery_party.guests.includes("fox") and $avery_party.fox_here and $avery_party.stage is 2 and $avery_party.fox_suspicious>>
		<<if $avery_party.fox_spotted>>
			<<link [[Search for the brown fox|Mansion Party Remy Brown Fox]]>><<dry>><<pass 20>><<set $avery_party.stage += 1>><<set $avery_party.guests.push("fox")>><</link>>
		<<elseif $avery_party.fox_thief>>
			<<link [[Search for the thief|Mansion Party Remy Brown Fox]]>><<dry>><<pass 20>><<set $avery_party.stage += 1>><<set $avery_party.guests.push("fox")>><</link>>
		<<else>>
			<<link [[Search for the uninvited guest|Mansion Party Remy Brown Fox]]>><<dry>><<pass 20>><<set $avery_party.stage += 1>><<set $avery_party.guests.push("fox")>><</link>>
		<</if>>
		<br>
	<</if>>
<</if>>
<</widget>>

<<widget "avery_mansion_dungeon_links">>
	<<if $avery_mansion.vault_known and $auriga_artefact is "Avery">>
		<<icon "avery_vault.png">><<link [[Open the vault|Mansion Dungeon Vault Code]]>><</link>>
		<br>
	<<elseif $avery_mansion.vault_progress is 0 and $auriga_artefact is "Avery">>
		<<icon "avery_vault.png">><<link [[Approach the vault|Mansion Dungeon Vault Approach]]>><<set $avery_mansion.vault_progress += 1>><</link>>
		<br>
	<<elseif $avery_mansion.vault_progress lt 100 and $auriga_artefact is "Avery">>
		<<icon "avery_vault.png">><<link [[Try to open the vault (0:30)|Mansion Dungeon Vault Brute]]>><<set $avery_mansion.vault_progress += 4>><<if $avery_dungeon>><<set $avery_dungeon.timer -= 30>><</if>><<pass 30>><</link>><<avery_mansion_vault_progress>>
		<br>
	<<elseif $avery_mansion.vault_progress gte 100 and $auriga_artefact is "Avery">>
		<<icon "avery_vault.png">><<link [[Open the vault|Mansion Dungeon Vault]]>><</link>>
		<br>
	<</if>>
<</widget>>

<<widget "avery_mansion_dungeon_init">>
	<<set $avery_dungeon to {}>>
	<<set $avery_dungeon.tool to "tickler">>
	<<set $avery_dungeon.timer to 120>>
	<<handheldundress "avery_dungeon_handheld">>
<</widget>>

<<widget "avery_mansion_dungeon_end">>
	<<unset $avery_dungeon>>
	<<storeon "avery_dungeon_handheld">>
<</widget>>

<<widget "avery_mansion_contents">>/* Contents of main "room" passages in Avery's mansion. The room description is separated from the main body so the conditional outcomes between them don't have to be copy pasted in every room. */
	<<if $bus is "avery_pool">>
		You are beside Avery's pool.

		<<avery_mansion_description pool>>
	<</if>>

	<<if $bus is "avery_kitchen">>
		You are in Avery's kitchen.
		<<if $avery_mansion.kitchen_made gte 3>>
			<<avery_housework_change "kitchen" 1>>
			<<set $avery_mansion.kitchen_made -= 3>>
		<</if>>

		<<avery_mansion_description kitchen>>
	<</if>>

	<<if $bus is "avery_lounge">>
		You are in Avery's lounge.

		<<avery_mansion_description lounge>>
	<</if>>

	<<if $bus is "avery_display">>
		You are in Avery's display room.

		<<avery_mansion_description display>>
	<</if>>

	<<if $bus is "avery_bedroom">>
		You are in Avery's bedroom.

		<<if $avery_mansion.schedule is "sleep">>
			<<nnpc_He "Avery">> snores beneath the covers.
		<</if>>

		<<avery_mansion_description bedroom>>
	<</if>>

	<<if $bus is "avery_bathroom">>
		You are in Avery's bathroom.

		<<avery_mansion_description bathroom>>
	<</if>>

	<<if $bus is "avery_dining">>
		You are in Avery's dining room.

		<<avery_mansion_description dining>>
	<</if>>

	<<if $bus is "avery_garden">>
		You are in Avery's garden.

		<<avery_mansion_description garden>>
	<</if>>

	<<if $bus is "avery_garage">>
		You are in Avery's garage.
		<<if $avery_mansion.date_ready is true and Time.hour lte 21 and $averydatedone isnot 1>>
			<<nnpc_He "Avery">> leans on one of <<nnpc_his "Avery">> cars, and looks up as you enter.
		<<elseif $avery_mansion.schedule is "work">>
			Avery's everyday car is missing. <<nnpc_He "Avery">> should be at work.
		<<elseif $avery_mansion.schedule is "away">>
			Avery's sports car is missing.
		<</if>>
		<br><br>
	<</if>>

	<<if $bus is "avery_study">>
		You are in Avery's study.
		<br><br>
	<</if>>
	<<avery_mansion_interrupt>>
	<<if C.npc.Avery.state isnot "dismissed">>
		<<if _avery_interrupt is "injury">>
			<<npc Avery>><<person1>>
			You hear the front gates rattle open, and an unfamiliar car drive through. It stops outside the mansion. A door opens, closes, then the car drives away.
			<br><br>

			You hear another car door open, and close, in the garage. You investigate, and find Avery sat behind the wheel of <<his>> sports car. One arm is encased in a white cast, held aloft by a sling around <<his>> neck. The other clutches a bottle of cheap bourbon. <<He>> takes a swig.
			<br><br>

			<<link [[Approach|Mansion Return Broken Approach]]>><<set $avery_injury to false>><<set $avery_mansion.injury_timer to 90>><</link>>
			<br>
			<<link [[Just Watch (0:10)|Mansion Return Broken Watch]]>><<set $avery_injury to false>><<set $avery_mansion.injury_timer to 90>><<pass 10>><</link>>
			<br>
		<<elseif _avery_interrupt is "party_missed">>
			<<set $avery_mansion.rage.work to false>>
			<<npc "Avery">><<person1>>
			Avery fixes you with a glare.

			<<avery_housework_assess>>
		<<elseif _avery_interrupt is "work">>
			You hear the front gates rattle open, followed by a car driving through. It enters the garage, and a car door slams. Avery is home from work.
			<br><br>
			<<if $avery_mansion.schedule is "bath">>
				<<set $avery_mansion.rage.work to false>>
				<<npc "Avery">><<person1>>
				<<He>> enters.

				<<avery_housework_assess bath>>
			<<elseif $avery_mansion.schedule is "sleep">>
				<<set $avery_mansion.rage.work to false>>
				<<npc "Avery">><<person1>>
				<<He>> enters.

				<<avery_housework_assess sleep>>
			<<else>>
				<<set $avery_mansion.rage.work to false>>
				<<npc "Avery">><<person1>>
				<<He>> enters.

				<<avery_housework_assess work>>
			<</if>>
		<<elseif _avery_interrupt is "date_approach">>
			<<set $avery_mansion.date_seen to true>>
			<<npc "Avery">><<person1>>
			<<avery_date_approach "mansion">>

			<<link [[Yes|Mansion Date Yes]]>><<npcincr Avery love 1>><</link>><<glove>>
			<br>
			<<link [[No|Mansion Date No]]>><<npcincr Avery love -1>><<npcincr Avery rage 1>><</link>><<llove>><<garage>>
			<br>
		<<elseif _avery_interrupt is "date_ready">>
			<<set $avery_mansion.date_ready to true>>
			<<npc "Avery">><<person1>>

			Avery smiles at you, wearing <<his>> best. "I'm ready when you are," <<he>> says. "For the date. I'll be waiting in the garage."
			<br><br>

			<<link [[Next|$passage]]>><<endevent>><</link>>

		<<elseif _avery_interrupt is "party_prepare">>

			<<avery_mansion_contents_party_prepare>>
		<<elseif _avery_interrupt is "party">>

			<<avery_mansion_contents_party>>
		<<elseif _avery_interrupt is "skyscraper_approach">>
			<<set $avery_tower.stage to 3>>
			<<npc Avery>><<person1>>
			"I've just had the call," Avery says. <<He>>'s smiling. <span class="gold">"My skyscraper is finished at last."</span>
			<br><br>
			<<skyscraper_time>>
			<<if _skyscraper_time is "now">>
				"The blood moon is high, and the time is nigh," <<he>> rhymes.
				<<if $worn.upper.type.includes("formal") and $worn.lower.type.includes("formal")>>
					<<He>> examines your outfit, and smiles. "Good," <<he>> says, linking <<his>> arm with yours. "Come. Remy and Harper will be meeting us here. We journey to the skyscraper together."
					<br><br>
					<<link [[Go with Avery|Mansion Skyscraper Formal]]>><</link>>
					<br>
					<<link [[Visit the wardrobe first|Mansion Skyscraper Dress]]>><<pass 5>><</link>>
					<br>
				<<else>>
					<<He>> examines your outfit. "Remy and Harper will soon be here. We journey to the skyscraper together." <<He>> grasps your hand. "Come on. I'll dress you myself."
					<br><br>
					<<link [[Go with Avery (0:05)|Mansion Skyscraper Dress]]>><<pass 5>><</link>>
					<br>
					<<link [[Refuse|Mansion Skyscraper Dress Refuse]]>><</link>>
					<br>
				<</if>>
			<<else>>
				<<if Time.monthDay is Time.lastDayOfMonth>>
					"<span class="gold">The opening ceremony is tonight.</span> When the moon is blood red.
				<<elseif Time.monthDay is Time.lastDayOfMonth - 1>>
					"<span class="gold">The opening ceremony will be tomorrow.</span> When the moon is blood red.
				<<else>>
					"<span class="gold">The opening ceremony will be on the last day of the month.</span> When the moon is blood red.
				<</if>>
				They're inducting me into their circle, and it's vital you attend. There can be no ceremony without you."
				<br><br>
				Avery walks away, more animated than you've yet seen <<him>>. "Meet me here when the time comes. We'll arrive there in style."
				<br><br>
				<<endevent>>
				<<avery_mansion_links>>
			<</if>>
		<<elseif _avery_interrupt is "skyscraper_ready">>
			<<npc "Avery">><<person1>>
			<<if $worn.upper.type.includes("formal") and $worn.lower.type.includes("formal")>>
				Avery examines your outfit, and smiles. "Good," <<he>> says, linking <<his>> arm with yours. "Come. Remy and Harper will be meeting us here. We journey to the skyscraper together."
				<br><br>
				<<link [[Go with Avery|Mansion Skyscraper Formal]]>><</link>>
				<br>
				<<link [[Visit the wardrobe first|Mansion Skyscraper Dress]]>><<pass 5>><</link>>
				<br>
			<<else>>
				Avery examines your outfit. "The guests are arriving." <<He>> grasps your hand. "Come on. I'll dress you myself."
				<br><br>
				<<link [[Go with Avery (0:05)|Mansion Skyscraper Dress]]>><<pass 5>><</link>>
				<br>
				<<link [[Refuse|Mansion Skyscraper Dress Refuse]]>><</link>>
				<br>
			<</if>>
		<<elseif _avery_interrupt is "robin">>
			<<npc "Robin">><<person1>>
			A buzz rings through the mansion. Someone's at the front gate.
			<br><br>
			<<if $avery_mansion.schedule isnot "work" and $avery_mansion.schedule isnot "sleep" and $avery_mansion.schedule isnot "away">>
				"Could you get that?" Avery calls. "I'm not expecting anyone important."
				<br><br>
			<</if>>
			<<if $exposed gte 1>>
				<<towelup>>
				You put on some towels and head for the front gate.
				<br><br>
			<<else>>
				You head for the front gate.
				<br><br>
			<</if>>
			<<link [[Next|Mansion Robin]]>><<set $avery_mansion_robin to 2>><</link>>
			<br>
		<<else>>


			<<if $bus is "avery_pool">>
				<<if $avery_mansion.schedule is "pool">>
					<<npc Avery>><<person1>>
					<<if C.npc.Avery.rage gte 80>>
						Avery tears through the water, soaking the walkway with violent strokes.
					<<elseif C.npc.Avery.rage gte 60>>
						Avery cuts through the water, emerging only to take quick breaths.
					<<elseif C.npc.Avery.rage gte 40>>
						Avery swims up and down the pool without stopping.
					<<elseif C.npc.Avery.rage gte 20>>
						Avery swims up and down the pool, kicking against the water.
					<<else>>
						Avery swims up and down the pool, limbs falling without a splash.
					<</if>>
					<<endevent>>
					<br><br>
					<<socialiseicon>><<link [[Talk to Avery|Mansion Talk]]>><</link>>
					<br>
				<</if>>

				<<if $avery_mansion.schedule is "pool">>
					<<swimicon "dive">><<link [[Dive|Mansion Pool Dive Avery]]>><</link>>
					<br>
				<<else>>
					<<swimicon "dive">><<link [[Dive|Mansion Pool Dive]]>><</link>>
					<br>
				<</if>>
				<br>
			<</if>>

			<<if $bus is "avery_kitchen">>
				<<if $avery_mansion.kitchen gte 4>>
					<span class="red">You can't cook like this!</span> You'll need to clean the kitchen before you can make anything.
					<br><br>
				<<else>>
					<<ingredientsSupplied $avery_mansion.kitchen_stock.normal.concat($avery_mansion.kitchen_stock.requested)>>

					<<kitchenDisplay>>
				<</if>>
			<</if>>

			<<if $bus is "avery_lounge">>
				<<if $avery_mansion.schedule is "lounge">>
					<<npc "Avery">><<person1>>
					<<if C.npc.Avery.rage gte 80>>
						Avery paces up and down the room. The news plays on the television, but <<hes>> not listening to it.
					<<elseif C.npc.Avery.rage gte 60>>
						Avery stands in front of the television, watching the news.
					<<elseif C.npc.Avery.rage gte 40>>
						Avery sits on the sofa, leaning forward, watching the news.
					<<elseif C.npc.Avery.rage gte 20>>
						Avery sits on the sofa, watching the news.
					<<else>>
						Avery reclines on the sofa, watching football on television.
					<</if>>
					<<endevent>>
					<br><br>
					<<socialiseicon>><<link [[Talk to Avery|Mansion Talk]]>><</link>>
					<br><br>
				<<elseif $avery_mansion.schedule is "drink">>
					<<npc "Avery">><<person1>>
					<<if C.npc.Avery.rage gte 80>>
						Avery sits at the table, gaze lost in <<his>> drink. Empty glasses are scattered in front of <<him>>.
					<<elseif C.npc.Avery.rage gte 60>>
						Avery sits at the table, brooding into an alcoholic drink.
					<<elseif C.npc.Avery.rage gte 40>>
						Avery sits at the table, sipping an alcoholic drink.
					<<elseif C.npc.Avery.rage gte 20>>
						Avery sits on the sofa, nursing an alcoholic drink.
					<<else>>
						Avery sips an alcoholic drink while smiling at one of <<his>> expensive landscapes.
					<</if>>
					<<endevent>>
					<br><br>
					<<socialiseicon>><<link [[Talk to Avery|Mansion Talk]]>><</link>>
					<br><br>
				<</if>>
				<<if !($avery_mansion.schedule is "lounge" and $daily.pianoPlayBlocked)>>
					<<set $_pianobr to true>>
					<<icon "piano.png">><<link [[Play the piano (0:20)|Mansion Lounge Piano]]>><<pass 20>><</link>>
					<br>
				<</if>>
				<<if $avery_mansion.fox.task is "heist" and ($avery_mansion.schedule is "away" or $avery_mansion.schedule is "sleep" or $avery_mansion.schedule is "work") and !$avery_fate and $auriga_artefact is "Avery">>
					<<set $_pianobr to true>>
					<<icon "piano.png">><<link [[Play the brown fox's signal on the piano|Mansion Fox Heist]]>><<endevent>><<pass 10>><<set $phase to 1>><</link>>
					<br>
				<</if>>
				<<if $_pianobr>>
					<br>
				<</if>>
			<</if>>

			<<if $bus is "avery_display">>
				<<if $avery_antiques>>
					<<if $avery_mansion.schedule is "away" or $avery_mansion.schedule is "sleep" or $avery_mansion.schedule is "work">>
						<<if $avery_antiques.exposed.length gte 1>>
							<<set _extralinebreak to true>>
							<<crimeicon "mark">><<link [[Consider stealing Avery's antiques|Mansion Display Consider]]>><</link>>
							<br>
						<</if>>
						<<if $avery_antiques.bolts gte 1>>
							<<set _extralinebreak to true>>
							<<lockicon "pick">><<link [[Loosen the bolts protecting the valuable antiques (1:00)|Mansion Display Loosen]]>><<set $avery_antiques.bolt_progress += 1>><<pass 60>><</link>>
							<br>
						<</if>>
					<<elseif $avery_antiques.exposed.length gte 1 or $avery_antiques.bolts gte 1>>
						<<set _extralinebreak to true>>
						<span class="blue">You can't fiddle with Avery's displays while <<nnpc_he Avery>>'s around.</span>
						<br>
					<</if>>
				<</if>>
			<</if>>

			<<if $bus is "avery_bedroom">>
				<<if $unbind is 1>>
					<<unset $unbind>>
					<<if $possessed>>
						You stare down at your bindings. You pull, and they fall apart, unable to hold against you.
						<br><br>
					<<else>>
						<span class="green">You rub your bindings against the corner of a table.</span> It takes some effort, but eventually the material yields, freeing your limbs.
						<br><br>
					<</if>>
					<<unbind>>
				<</if>>
				<<if $leftarm is "bound" or $rightarm is "bound" or $feetuse is "bound" or $worn.feet.name is "ankle cuffs">>
					<<undobindingsicon>><<link [[Undo your bindings (0:10)|Mansion Bedroom]]>><<set $unbind to 1>><<pass 10>><<unbind>><</link>>
					<br><br>
				<</if>>
				<<if $worn.face.cursed is 1>>
					<<link [[Remove your $worn.face.name (0:10)|Mansion Bedroom]]>><<pass 10>><<set $worn.face.type.push("broken")>><<faceruined>><</link>>
					<br><br>
				<</if>>

				<<if $nextPassageCheck is "Mansion Bed">>
					<span class="nextLink"><<furnitureicon _bed.iconFile>><<link [[Avery.|Mansion Bed]]>><</link>></span>
					<br>
					<<listsleepoutfits>>
				<<else>>
					<<icon "avery_bedroom.png">><<link [[Strip and get in bed|Mansion Bed]]>><<undressSleep "Mansion Bed">><</link>>
					<br>
					<<listsleepoutfits "Mansion Bed">>
				<</if>>
				<<roomoptions>>
				<br>
				<<wardrobeicon>><<link [[Wardrobe|Mansion Wardrobe]]>><</link>>
				<br>
				<<if playerHasSexToys()>>
					<<sextoysicon>><<link [[Sex toys|Sextoys Inventory]]>><<set $sextoyInvReturnLink to $passage>><</link>>
					<br>
				<</if>>
				<<if $nextPassageCheck is "Mansion Mirror">>
					<span class="nextLink"><<mirroricon "home">><<link [[Mirror|Mansion Mirror]]>><<preMirror>><<endevent>><</link>></span>
				<<else>>
					<<mirroricon "home">><<link [[Mirror|Mansion Mirror]]>><<preMirror>><</link>>
				<</if>>
				<br><br>

				<<if $avery_mansion.folder gte 12 and !$daily.mansion_folder and $avery_mansion.schedule isnot "away" and $avery_mansion.schedule isnot "sleep" and $avery_mansion.schedule isnot "work">>
					<<set _extralinebreak to true>>
					<<icon "manilaenvelope.png">><<link [[Read the folder from the orphanage (1:00)|Mansion Folder Avery]]>><<trauma 6>><<stress 6>><</link>><<gstress>><<ltrauma>>
					<br>
				<<elseif $avery_mansion.folder gte 1 and !$daily.mansion_folder>>
					<<set _extralinebreak to true>>
					<<icon "manilaenvelope.png">><<link [[Read the folder from the orphanage (1:00)|Mansion Folder]]>><<set $avery_mansion.folder++>><<set $daily.mansion_folder to true>><<pass 60>><<trauma -6>><<stress 6>><</link>><<gstress>><<ltrauma>>
					<br>
				<</if>>
				<<if $avery_mansion.schedule is "sleep">>
					<<if _extralinebreak>><br><</if>>
					<<set _extralinebreak to true>>
					<<npc "Avery">><<person1>>
					<<if C.npc.Avery.rage gte 80>>
						Avery thrashes in <<his>> sleep.
					<<elseif C.npc.Avery.rage gte 60>>
						Avery tosses and turns.
					<<elseif C.npc.Avery.rage gte 40>>
						Avery mutters in <<his>> sleep.
					<<elseif C.npc.Avery.rage gte 20>>
						Avery sleeps with one hand clutching <<his>> pillow.
					<<else>>
						Avery slumbers, <<his>> chest rising and falling beneath the covers.
					<</if>>
					<<endevent>>
					<br>
					<<if $nextPassageCheck is "Mansion Talk">>
						<span class="nextLink"><<socialiseicon>><<link [[Avery.|Mansion Talk]]>><</link>></span>
						<br>
					<</if>>
				<</if>>
			<</if>>

			<<if $bus is "avery_bathroom">>
				<<if $avery_mansion.schedule is "bath">>
					<<npc "Avery">><<person1>>
					<<if C.npc.Avery.rage gte 80>>
						Avery lies in the bath, letting the cold tap run.
					<<elseif C.npc.Avery.rage gte 60>>
						Avery fiddles with the bath taps, unable to get the temperature right.
					<<elseif C.npc.Avery.rage gte 40>>
						Avery dips <<his>> head beneath the surface of the bath.
					<<elseif C.npc.Avery.rage gte 20>>
						Avery washes <<himself>> in the bath.
					<<else>>
						Avery relaxes in the bath.
					<</if>>
					<<endevent>>
					<br><br>
					<<socialiseicon>><<link [[Talk to Avery|Mansion Talk]]>><</link>>
					<br>
					<<bathroomicon "bath">><<link [[Bathe with Avery (0:20)|Mansion Bathe Avery]]>><<clothesstrip>><<pass 20>><</link>>
					<br>
					<<bathroomicon "toothbrush">><<link [[Brush teeth (0:05)|Bathroom Brush]]>><<pass 5>><<set $bathroomExit to "Mansion Bathroom">><</link>>
					<br>
					<<pregnancyTest "Mansion Bathroom">>
				<<else>>
					<<bathroomicon "bath">><<link [[Bathe (0:20)|Mansion Bathe]]>><<clothesstrip>><<pass 20>><</link>>
					<br>
					<<bathroomicon "toothbrush">><<link [[Brush teeth (0:05)|Bathroom Brush]]>><<pass 5>><<set $bathroomExit to "Mansion Bathroom">><</link>>
					<br>
					<<pregnancyTest "Mansion Bathroom">>
				<</if>>
				<br>
			<</if>>

			<<if $bus is "avery_dining">>
				<<if $avery_mansion.schedule is "breakfast">>
					<<npc "Avery">><<person1>>
					<<if C.npc.Avery.rage gte 80>>
						Avery fumes at something on <<his>> phone, <<his>> breakfast forgotten.
					<<elseif C.npc.Avery.rage gte 60>>
						Avery scrolls through <<his>> phone, stopping now and then to take a bite of <<his>> breakfast.
					<<elseif C.npc.Avery.rage gte 40>>
						Avery reads the news on <<his>> phone with one hand while eating breakfast with the other.
					<<elseif C.npc.Avery.rage gte 20>>
						Avery eats breakfast, but seems too distracted to enjoy it.
					<<else>>
						Avery eats breakfast, savouring each bite.
					<</if>>
					<<endevent>>
					<br><br>
					<<socialiseicon>><<link [[Talk to Avery|Mansion Talk]]>><</link>>
					<br><br>
				<<elseif $avery_mansion.schedule is "party_prepare">>
					<<npc "Avery">><<person1>>
					<<if Time.weekDay is 1>>
						<<if C.npc.Avery.rage gte 80>>
							The servants scuttle to and fro beneath Avery's terrible gaze.
						<<elseif C.npc.Avery.rage gte 60>>
							Servants prepare the table, fearful of Avery's wrath.
						<<elseif C.npc.Avery.rage gte 40>>
							Avery barks commands at the servants as they prepare the table for guests.
						<<elseif C.npc.Avery.rage gte 20>>
							Avery commands the servants as they prepare the table for guests.
						<<else>>
							Avery directs the servants as they prepare the table for guests.
						<</if>>
						<<endevent>>
						<br><br>
					<</if>>
				<<elseif $avery_mansion.schedule is "dinner">>
					<<npc "Avery">><<person1>>
					<<if canGiftFood("Avery") and Time.weekDay isnot 1>>
						<<if C.npc.Avery.rage gte 80>>
							Avery sits at the table, watching you.
						<<elseif C.npc.Avery.rage gte 60>>
							Avery sits at the table, drumming it with <<his>> fingers, awaiting dinner.
						<<elseif C.npc.Avery.rage gte 40>>
							Avery sits at the table, thumbing through <<his>> phone, awaiting dinner.
						<<elseif C.npc.Avery.rage gte 20>>
							Avery sits at the table, reading <<his>> phone, awaiting dinner.
						<<else>>
							Avery sits at the table, awaiting dinner.
						<</if>>
						<<endevent>>
						<br><br>
						<<if canGiftFood("Avery")>>
							<<skinicon "waiter">><<link [[Serve Avery Dinner|Avery Gifts Dinner List]]>><</link>>
							<br><br>
						<</if>>
					<</if>>
				<</if>>
			<</if>>

			<<if $bus is "avery_garage">>
				<<if $avery_mansion.date_ready is true and Time.hour lte 21 and $averydatedone isnot 1>>
					<<icon "averys_car.png">><<link [[Date (1:20)|Avery Date]]>><<endevent>><</link>>
					<br><br>
				<</if>>
			<</if>>

			<<if $bus is "avery_garden">>
				<<if $avery_mansion.schedule is "garden">>
					<<npc "Avery">><<person1>>
					<<if C.npc.Avery.rage gte 80>>
						Avery assaults the topiary, slicing through branches with no finesse.
					<<elseif C.npc.Avery.rage gte 60>>
						Avery attacks the topiary, cutting through branches with relish.
					<<elseif C.npc.Avery.rage gte 40>>
						Avery rips the leaves off bushes with <<his>> fingers.
					<<elseif C.npc.Avery.rage gte 20>>
						Avery trims the topiary with a mechanical focus.
					<<else>>
						Avery trims the topiary with care.
					<</if>>
					<<endevent>>
					<br><br>
					<<socialiseicon>><<link [[Talk to Avery|Mansion Talk]]>><</link>>
					<br><br>
				<<elseif $avery_mansion.fox.task is "heist" and ($avery_mansion.schedule is "away" or $avery_mansion.schedule is "sleep" or $avery_mansion.schedule is "work") and !$avery_fate and $auriga_artefact is "Avery">>
					<<birdicon "sing">><<link [[Whistle the signal to the brown fox|Mansion Fox Heist]]>><<endevent>><<pass 10>><</link>>
					<br><br>
				<</if>>
			<</if>>

			<<if $avery_mansion.schedule isnot "away" and $avery_mansion.schedule isnot "work">>
				<<set $_avery_present to true>>
			<</if>>
			<<if $bus is "avery_study">>
				<<if $avery_mansion.schedule is "study" and !$avery_mansion.study_unlocked>>
					<<npc "Avery">><<person1>>
					The door opens, and Avery enters the study. <<He>> doesn't notice you in the shadows. You slip outside.
					<br><br>
					<<endevent>>
				<<elseif $avery_mansion.study_unlocked is 1 and Time.hour is 23 and $_avery_present>>
					<<npc "Avery">><<person1>>
					The door opens, and Avery enters the study. "I'm locking the study for the night," <<he>> says. "You can keep reading in the morning."
					<br><br>
					Once you're outside, <<he>> locks the door with a click, and walks away.
					<br><br>
					<<endevent>>
					<<set $avery_mansion.study_unlocked to 0>>
				<<else>>
					<<if $avery_mansion.schedule is "study">>
						<<set _extralinebreak to true>>
						<<npc "Avery">><<person1>>
						<<if C.npc.Avery.rage gte 80>>
							Avery paces along the length of the room.
						<<elseif C.npc.Avery.rage gte 60>>
							Avery stands at a bookshelf, searching for something.
						<<elseif C.npc.Avery.rage gte 40>>
							Avery reads at <<his>> desk, but keeps changing the book.
						<<elseif C.npc.Avery.rage gte 20>>
							Avery sits at <<his>> desk, flipping through a book.
						<<else>>
							Avery reclines by <<his>> desk, deep in a book.
						<</if>>
						<<endevent>>
						<br><br>
						<<socialiseicon>><<link [[Talk to Avery|Mansion Talk]]>><</link>>
						<br>
					<</if>>
					<<if $avery_mansion.recipe.length gte 1>>
						<<set _extralinebreak to true>>
						<<for _i range $avery_mansion.recipe>>
							<<capture _i>>
								<<tendingicon `setup.plants[_i].icon.replace(/\.[^/.]+$/, "")`>><<link [[Learn recipe for <<recipe_name _i>> (2:00)|Mansion Study Learn]]>><<set $phase to _i>><<pass 120>><</link>>
							<</capture>>
							<br>
						<</for>>
					<</if>>
					<<if $avery_mansion.schedule isnot "study" or $avery_mansion.schedule is "away">>
						<<if $avery_mansion.study_secret is 1>>
							<<set _extralinebreak to true>>
							<<icon "avery_dungeon.png">><<link [[Search for the dungeon|Mansion Dungeon Find]]>><<set $avery_mansion.study_secret to 2>><</link>>
							<br>
						<<elseif $avery_mansion.study_secret gte 2>>
							<<set _extralinebreak to true>>
							<<icon "avery_dungeon.png">><<link [[Enter the dungeon|Mansion Dungeon Enter]]>><</link>>
							<br>
						<</if>>
					<</if>>
				<</if>>
			<</if>>

			<<if _extralinebreak>>
				<br>
			<</if>>

			<<avery_mansion_links>>

			<<if $bus is "avery_bedroom">>
				<br><br>
				<<link [[Gameplay Settings|Settings]]>><<set $settingsExitPassage to "Mansion Bedroom">><</link>>
				<br>
				<<attitudesControlCheck>>
				<<if $attitudesControl.showGoldLink is true>>
					<span class="goldLink"><<link [[Attitudes]]>><<set $attitudesExitPassage to $passage>><</link>> </span><span class="red">!!</span>
				<<else>>
					<<link [[Attitudes]]>><<set $attitudesExitPassage to $passage>><</link>>
				<</if>>
				<br><br>
			<</if>>
		<</if>>
	<<else>>
		<<avery_mansion_links>>
	<</if>>
<</widget>>

<<widget "avery_mansion_contents_party">>
	<<npc "Avery">><<person1>>
	<<if $worn.upper.type.includes("formal") and $worn.lower.type.includes("formal")>>
		Avery examines your outfit, and smiles. "Good," <<he>> says, linking <<his>> arm with yours. "Come. We've guests to greet."
		<br><br>

		<<avery_mansion_party_start_links>>
	<<else>>
		Avery examines your outfit. "The guests are arriving." <<He>> grasps your hand. "Come on. I'll dress you myself."
		<br><br>
		<<link [[Go with Avery (0:05)|Mansion Party Dress]]>><<pass 5>><</link>>
		<br>
		<<link [[Refuse|Mansion Party Dress Refuse]]>><</link>>
		<br>
	<</if>>
<</widget>>

<<widget "avery_mansion_contents_party_prepare">>
	<<npc "Avery">><<person1>>
	"There you are," Avery says. "The guests will be arriving soon." <<He>> examines your outfit.
	<<if $worn.upper.type.includes("formal") and $worn.lower.type.includes("formal")>>
		<<if Time.hour is 17>>
			<<pass `60-Time.minute`>>
		<</if>>

		"Very good." <<He>> links <<his>> arm with yours. "Shall we?"
		<br><br>

		<<avery_mansion_party_start_links>>
	<<else>>
		<<set $avery_mansion.outfit_warning to 1>>
		"Go wear something appropriate. Something <span class="gold">formal.</span>" <<He>> pushes a comb through <<his>> hair. "We must make the right impression."
		<br><br>
		<<endevent>>
		<<avery_mansion_end_links>>
	<</if>>
<</widget>>

<<widget "avery_mansion_interrupt">>
	<<if $avery_mansion.schedule isnot "away" and $avery_mansion.schedule isnot "work" and $avery_mansion.schedule isnot "sleep">>
		<<set $_avery_present to true>>
	<</if>>
	<<if $possessed>>
		<<set _avery_interrupt to false>>
	<<elseif $_avery_present is true and $avery_injury>>
		<<set _avery_interrupt to "injury">>
	<<elseif $_avery_present is true and $avery_mansion.schedule is "return">>
		<<set _avery_interrupt to "work">>
	<<elseif $_avery_present is true and $avery_mansion.party_state is "missed">>
		<<set _avery_interrupt to "party_missed">>
	<<elseif $_avery_present is true and $avery_mansion.schedule is "party_prepare" and !$avery_mansion.outfit_warning>>
		<<set _avery_interrupt to "party_prepare">>
	<<elseif $_avery_present is true and $avery_mansion.schedule is "party">>
		<<set _avery_interrupt to "party">>
	<<elseif $_avery_present is true and $avery_mansion.date_seen is false and (Time.weekDay isnot 7 or Time.weekDay is 7 and Time.hour lte 19)>>
		<<set _avery_interrupt to "date_approach">>
	<<elseif $_avery_present is true and $averydate is 1 and Time.hour is 20 and $averydatedone isnot 1 and $avery_mansion.date_ready isnot true and Time.weekDay is 7>>
		<<set _avery_interrupt to "date_ready">>
	<<elseif $_avery_present is true and $avery_mansion.schedule is "return">>
		<<set _avery_interrupt to "work">>
	<<elseif $_avery_present is true and $avery_tower.stage is 2 and $avery_tower.progress gte 100 and $avery_mansion.schedule isnot "away">>
		<<set _avery_interrupt to "skyscraper_approach">>
	<<elseif $_avery_present is true and $avery_tower.stage is 3 and Time.isBloodMoon() and !$avery_fate>>
		<<set _avery_interrupt to "skyscraper_ready">>
	<<elseif $avery_tower.stage gte 1 and getRobinLocation() is "orphanage" and $avery_mansion and $avery_mansion_robin is 1 and Time.hour gte 6 and Time.hour lte 21 and !$fromRobinRoom and $avery_fate isnot "fallen" and $avery_fate isnot "kicked">>
		<<set _avery_interrupt to "robin">>
	<<elseif $avery_mansion.schedule is "sleep" and !$avery_mansion.fox.end and Time.dayState is "night" and ($avery_fate is "ascended" or $avery_fate is "saved")>>
		<<set _avery_interrupt to "fox">>
	<</if>>
	<<handheldon 1>>
<</widget>>

<<widget "avery_mansion_start_clothes">>
	<<set $wardrobe_location to "avery_mansion">>

	<<uppersend 9 $wardrobe_location>>
	<<uppersend 12 $wardrobe_location>>
	<<uppersend 101 $wardrobe_location>>
	<<uppersend 15 $wardrobe_location>>
	<<uppersend 64 $wardrobe_location>>
	<<uppersend 37 $wardrobe_location>>
	<<uppersend 133 $wardrobe_location>>

	<<lowersend 16 $wardrobe_location>>
	<<lowersend 118 $wardrobe_location>>
	<<lowersend 6 $wardrobe_location>>

	<<underuppersend 7 $wardrobe_location>>
	<<underuppersend 33 $wardrobe_location>>

	<<underlowersend 2 $wardrobe_location>>
	<<underlowersend 19 $wardrobe_location>>

	<<headsend 19 $wardrobe_location>>

	<<necksend 9 $wardrobe_location>>
	<<necksend 13 $wardrobe_location>>

	<<handheldsend 366 $wardrobe_location>>
	<<handheldsend 7 $wardrobe_location>>
	<<handheldsend 12 $wardrobe_location>>

	<<legssend 37 $wardrobe_location>>

	<<feetsend 1 $wardrobe_location>>
	<<feetsend 2 $wardrobe_location>>
	<<feetsend 12 $wardrobe_location>>
	<<feetsend 16 $wardrobe_location>>
	<<feetsend 5 $wardrobe_location>>
<</widget>>

<<widget "skyscraper_time">>
	<<if Time.monthDay is Time.lastDayOfMonth>>
		<<if Time.hour gte 21>>
			<<set _skyscraper_time to "now">>
		<<else>>
			<<set _skyscraper_time to "tonight">>
		<</if>>
	<<elseif Time.monthDay is Time.lastDayOfMonth - 1>>
		<<set _skyscraper_time to "tomorrow">>
	<<else>>
		<<set _skyscraper_time to "blood">>
	<</if>>
<</widget>>

<<widget "avery_mansion_seen">>
	<<set $avery_mansion.days_absent to 0>>
<</widget>>

<<widget "avery_mansion_clean">>
	<<avery_mansion>>
	<<switch _args[0]>>
		<<case "lounge">>
			<<avery_mansion_clean_lounge>>
		<<case "kitchen">>
			<<avery_mansion_clean_kitchen>>
		<<case "dining">>
			<<avery_mansion_clean_dining>>
		<<case "display">>
			<<avery_mansion_clean_display>>
		<<case "bedroom">>
			<<avery_mansion_clean_bedroom>>
		<<case "bathroom">>
			<<avery_mansion_clean_bathroom>>
		<<case "garden">>
			<<avery_mansion_clean_garden>>
		<<case "pool">>
			<<avery_mansion_clean_pool>>
	<</switch>>
<</widget>>

<<widget "avery_mansion_clean_lounge">>
	<<if $avery_mansion.lounge gte 4>>
		You right the upturned furniture in the lounge, and affix the curtains above the windows.
	<<elseif $avery_mansion.lounge is 3>>
		You clean the television in the lounge with a cloth.
	<<elseif $avery_mansion.lounge is 2>>
		You sweep the litter on the table in the lounge into a bin bag, then clean the table of crumbs with a dustpan and brush.
	<<elseif $avery_mansion.lounge is 1>>
		You arrange the cushions in the lounge into a more pleasing form.
	<</if>>
	<<avery_housework_change "lounge" -1>>
	<<pass _housekeeping_time>>

	<<if $avery_mansion.schedule is "lounge" and !$daily.avery.housekeeping_events.lounge>>
		<<set _event_triggered to true>>
		<<set $daily.avery.housekeeping_events.lounge to true>>
		<<npc "Avery">><<person1>>
		<br><br>

		Avery watches you while you work, going so far as to turn off the television. <<He>> props <<his>> elbow on the arm of the chair, and rests <<his>> head in <<his>> hand as <<he>> observes you.
		<br><br>

		<<link [[Tease|Mansion Housework Tease]]>><<exhibitionist1>><</link>>
		<br>
		<<link [[Ignore|Mansion Housework Ignore]]>><</link>>
		<br>
		<<link [[Be rude|Mansion Housework Rude]]>><<def 1>><<npcincr Avery love -1>><<npcincr Avery rage 1>><</link>><<llove>><<garage>>
	<<elseif $avery_mansion.schedule is "drink" and !$daily.avery.housekeeping_events.drink>>
		<<set _event_triggered to true>>
		<<set $daily.avery.housekeeping_events.drink to true>>
		<<npc "Avery">><<person1>>
		<br><br>

		"Sit," Avery says while you clean the lounge. <<He>> puts a second glass on the table, fills it with an expensive spirit, and pushes it your way.
		<br><br>

		<<if playerIsPregnant() and playerAwareTheyArePregnant()>>
			<span class="blue">You can't bring yourself to drink while you know you're with child.</span>
		<<else>>
			<<link [[Drink (0:05)|Mansion Housework Drink]]>><<pass 5>><<alcohol 60>><<npcincr Avery love 1>><</link>><<galcohol>><<glove>>
		<</if>>
		<br>
		<<link [[Refuse|Mansion Housework Drink Refuse]]>><<npcincr Avery love -1>><</link>><<llove>>
	<</if>>
	<br>
<</widget>>

<<widget "avery_mansion_clean_kitchen">>
	<<if $avery_mansion.kitchen gte 4>>
		You clean the kitchen sink with heavy duty chemicals.
	<<elseif $avery_mansion.kitchen is 3>>
		You mop up the spillage on the kitchen floor.
	<<elseif $avery_mansion.kitchen is 2>>
		You wash the dishes in the kitchen.
	<<elseif $avery_mansion.kitchen is 1>>
		You clean the kitchen counters of crumbs, until they're spotless.
	<</if>>
	<<avery_housework_change "kitchen" -1>>
	<<pass _housekeeping_time>>
	<br>
<</widget>>

<<widget "avery_mansion_clean_dining">>
	<<if $avery_mansion.dining gte 4>>
		The dining room is a mess, but you don a pair of gloves and clean the worst of it.
	<<elseif $avery_mansion.dining gte 3>>
		You fill a bucket with hot water, and scrub out the red stain in the dining room.
	<<elseif $avery_mansion.dining gte 2>>
		You sweep the mess on the dining room table into a bin bag, and wipe up the stains left behind.
	<<elseif $avery_mansion.dining gte 1>>
		You arrange the cutlery in the dining room, until it's fit for royalty.
	<</if>>
	<<avery_housework_change "dining" -1>>
	<<pass _housekeeping_time>>

	<<if $avery_mansion.schedule is "breakfast" and !$daily.avery.housekeeping_events.breakfast>>
		<<set _event_triggered to true>>
		<<set $daily.avery.housekeeping_events.breakfast to true>>
		<<npc "Avery">><<person1>>
		<br><br>

		Avery eats breakfast as if you're not there, but you catch <<him>> watching you now and then, <<his>> gaze returning to <<his>> food so fast you might have imagined it.
		<br><br>
		"Fetch me cream from the kitchen," <<he>> says. "I fancy some with my dessert."
		<br><br>

		<<link [[Fetch cream (0:03)|Mansion Housework Cream]]>><<pass 3>><</link>>
		<br>
		<<link [[Refuse|Mansion Housework Cream Refuse]]>><<npcincr Avery love -1>><<npcincr Avery rage 1>><</link>><<llove>><<garage>>
	<</if>>
	<br>
<</widget>>

<<widget "avery_mansion_clean_display">>
	<<if $avery_mansion.display gte 4>>
		You clear the cobwebs filling the display room, making it look less antique than the possessions kept within.
	<<elseif $avery_mansion.display is 3>>
		You polish the antiques in the display room.
	<<elseif $avery_mansion.display is 2>>
		You rub down the antiques in the display room.
	<<elseif $avery_mansion.display is 1>>
		You dust the antiques in the display room.
	<</if>>
	<<avery_housework_change "display" -1>>
	<<pass _housekeeping_time>>

	<<if $avery_antiques.progress is 0 and $avery_antiques.bolts gte 1>>
		<<set _event_triggered to true>>
		<<set $avery_antiques.progress to 1>>
		<br><br>

		Three objects in particular catch your eye in the display room, glittering in the light. A dagger, amulet, and mask, all made of gold. They look much more valuable than the other objects on display, and more worthy of a museum than here. They're kept behind thick glass. There's no lock, and the glass is sealed by metal bolts. Getting to them would be difficult.
		<br><br>

		<<link [[Work the bolts free|Mansion Housework Antiques]]>><<set $avery_antiques.bolt_progress += 1>><</link>>
		<br>
		<<link [[Ignore them|Mansion Housework Antiques Ignore]]>><</link>>
	<<elseif $avery_mansion.schedule isnot "away" and $avery_mansion.schedule isnot "work" and $avery_antiques.stolen.length gte 1>>
		<<npc "Avery">><<person1>>
		<<set _event_triggered to true>>
		<br><br>

		Avery enters the display room, and inspects the antiques for dust.
		<<set _items to ["dagger", "amulet", "mask"].filter(item => $avery_antiques.stolen.includes(item))>>
		<<set $_pronoun to pluralise(_items.length, "it", "them")>>

		<<run _items.forEach(item => {
			$avery_antiques.noticed.pushUnique(item);
			$avery_antiques.stolen.delete(item);
		})>>

		<<He>> arrives at the display that once housed the <<print formatList(_items, "and")>>. <<He>> stares at it a moment.
		<br><br>

		"My <<pluralise _items.length "antique">>," <<he>> says, turning to you. "Where did you put $_pronoun?"
		<br><br>

		<<link [[Say you didn't take $_pronoun (lie)|Mansion Housework Antiques Lie]]>><</link>>
		<br>
		<<link [[Remain silent|Mansion Housework Antiques Silent]]>><</link>>
		<br>
		<<link [[Say you took $_pronoun to sell|Mansion Housework Antiques Sell]]>><</link>>
		<br>
		<<link [[Say you took $_pronoun to the museum|Mansion Housework Antiques Museum]]>><</link>>
		<<if $avery_mansion.baileyStealLie>>
			<br>
			<<link [[Say Bailey stole them during the party (lie)|Mansion Housework Antiques Bailey]]>><</link>>
		<</if>>
	<</if>>
	<br>
<</widget>>

<<widget "avery_mansion_clean_bedroom">>
	<<if $avery_mansion.bedroom_state is "off-limits">>
		<<if _avery_housework_bedroom>>
			Avery went to bed while you were cleaning. <span class="blue">You decide to skip the bedroom for now.</span>
			<br>
		<</if>>

		<<exit>>
	<<elseif $avery_mansion.bedroom_state is "locked">>
		<<exit>>
	<</if>>

	<<if $avery_mansion.schedule is "sleep" and not _args[0] is true and $avery_mansion.bedroom_state isnot "ignored insisted" and $avery_mansion.bedroom_state isnot "insisted">>
		<<set _event_triggered to true>>
		<<npc "Avery">><<person1>>
		You enter the bedroom and start your chore. Avery tosses and turns while you work. <<His>> eyes snap open, and <<he>> observes you with a frown.
		<br><br>

		<<if $avery_mansion.bedroom_state is "ignored">>
			<<if C.npc.Avery.rage gte 20 and $averyragerevealed is 1>>
				"What the fuck did I tell you?" <<he>> says, turning on the bedside lamp and rising to <<his>> feet. "If you need a lesson so badly, so be it."<<garage>><<npcincr Avery rage 1>>
				<br><br>

				<<link [[Next|Mansion Housework Bedroom Rape]]>><<set $molestationstart to 1>><</link>>
			<<else>>
				"I told you not to bother me while I slept," <<he>> growls. "Get the fuck out. Now."
				<br><br>

				<<link [[Comply|Mansion Housework Bedroom Comply]]>><</link>>
				<br>
				<<link [[Refuse|Mansion Housework Bedroom Refuse]]>><<npcincr Avery love -1>><<npcincr Avery rage 1>><</link>><<garage>><<llove>>
			<</if>>
		<<else>>
			"Can't you do that in the morning?"
			<br><br>

			<<link [[Insist on cleaning now|Mansion Housework Bedroom Insist]]>><<npcincr Avery rage 1>><<npcincr Avery love -1>><</link>><<garage>><<llove>>
			<br>
			<<link [[Agree to clean later|Mansion Housework Bedroom Agree]]>><<set $avery_mansion.bedroom_state to "off-limits">><</link>>
		<</if>>
	<<else>>
		<<if _args[0] is true>>
			<<if $avery_mansion.bedroom_state is "ignored">>
				<<set $avery_mansion.bedroom_state to "ignored insisted">>
			<<else>>
				<<set $avery_mansion.bedroom_state to "insisted">>
			<</if>>
		<</if>>

		<<if $avery_mansion.bedroom gte 4>>
			You move the bed back to its proper place, and clean up the mess it was concealing.
		<<elseif $avery_mansion.bedroom gte 3>>
			You clean the suspicious smears in the bedroom.
		<<elseif $avery_mansion.bedroom gte 2>>
			You return the clothes in the bedroom to their homes.
		<<elseif $avery_mansion.bedroom gte 1>>
			You stretch out the sheets, and make the bed.
		<</if>>
		<<avery_housework_change "bedroom" -1>>
		<<pass _housekeeping_time>>
	<</if>>
	<br>
<</widget>>

<<widget "avery_mansion_clean_bathroom">>
	<<if $avery_mansion.bathroom gte 4>>
		You clean the taps in the bathroom with a cloth.
	<<elseif $avery_mansion.bathroom gte 3>>
		You soak the bath and sink in water and a chemical cleaner, restoring their pearly whiteness.
	<<elseif $avery_mansion.bathroom gte 2>>
		You take the spiders in the bathroom outside.
	<<elseif $avery_mansion.bathroom gte 1>>
		You dry the bathroom with a cloth.
	<</if>>
	<<avery_housework_change "bathroom" -1>>
	<<pass _housekeeping_time>>
	<br>
<</widget>>

<<widget "avery_mansion_clean_garden">>
	<<if $avery_mansion.garden gte 4>>
		You use a pair of shears to fight back the tangled weeds overrunning the garden.
	<<elseif $avery_mansion.garden is 3>>
		Careful not to harm other flowers, you remove weeds from the garden.
	<<elseif $avery_mansion.garden is 2>>
		You pull up the weeds in the garden by the root.
	<<elseif $avery_mansion.garden is 1>>
		You prune the topiary to Avery's taste.
	<</if>>
	<<avery_housework_change "garden" -1>>
	<<pass _tending_time>>

	<<if $avery_mansion.schedule is "garden" and !$daily.avery.housekeeping_events.garden>>
		<<set _event_triggered to true>>
		<<set $daily.avery.housekeeping_events.garden to true>>
		<<npc "Avery">><<person1>>
		<br><br>

		Avery potters in the garden, taking <<his>> time pruning individual leaves while you do the grunt work. "This one's exquisite," <<he>> says, gesturing at a holly bush.
		<br><br>
		Avery makes delicate adjustments with <<his>> shears, stepping back to admire <<his>> handiwork often.
		<<if currentSkillValue('tending') gte 600>>
			<span class="green">You think you could do a better job.</span> It might be wise to keep it to yourself, however.
			<br><br>
			<<link [[Teach Avery|Mansion Housework Garden Teach]]>><</link>>
			<br>
		<<else>>
			<span class="red">Avery seems to know what <<hes>> doing.</span>
			<br><br>
		<</if>>
		<<link [[Compliment|Mansion Housework Garden Compliment]]>><</link>>
		<br>
		<<link [[Ignore|Mansion Housework Garden Ignore]]>><</link>>
	<</if>>
	<br>
<</widget>>

<<widget "avery_mansion_clean_pool">>
	<<if $avery_mansion.schedule is "pool" and $daily.avery.housekeeping_events.pool>>
		Avery is still using the pool. You decide to leave <<nnpc_him "Avery">> to it.
	<<elseif $avery_mansion.schedule is "pool" and !$daily.avery.housekeeping_events.pool>>
		<<set _event_triggered to true>>
		<<set $daily.avery.housekeeping_events.pool to true>>
		<<npc "Avery">><<person1>>
		<br>
		You head to the pool and start your chore. Avery strides outside, <span class="lewd">wearing nothing.</span>
		<<if Weather.temperature <= 10>>
			The cold doesn't seem to bother <<him>>.
		<</if>>
		<<He>> pulls a pair of goggles over <<his>> eyes, and dives in, sending a rippling wave your way.
		<br><br>

		<<He>> emerges, and starts swimming lengths.
		<br><br>

		<<link [[Work around Avery without complaint|Mansion Housework Pool Work]]>><<stress 6>><</link>><<gstress>>
		<br>
		<<link [[Tell Avery to wait until you've finished|Mansion Housework Pool Tell]]>><<npcincr Avery rage 1>><</link>><<garage>>
		<br>
		<<link [[Stop cleaning for now|Mansion Pool]]>><<avery_housework_change "pool" 1>><</link>>
	<<else>>
		<<if $avery_mansion.pool gte 4>>
			You unfurl a hose, and vacuum the pool clear of algae.
		<<elseif $avery_mansion.pool is 3>>
			You retrieve chlorine from a nearby shed, and add a healthy dose to the pool.
		<<elseif $avery_mansion.pool is 2>>
			You remove the bugs floating on the pool with a net.
		<<elseif $avery_mansion.pool is 1>>
			You clear the bugs floating on the pool with a net, leaving it pristine.
		<</if>>
		<<avery_housework_change "pool" -1>>
		<<pass _housekeeping_time>>
	<</if>>
	<br>
<</widget>>

<<widget "summon_brown_fox">>
	<<set $_slot to _args[0] || 1>>
	<<set $_npc to clone(C.npc[$NPCNameList[7]])>>
	<<generateNPC $_slot t $_npc.pronoun $_npc.gender 10>>
<</widget>>

<<widget "avery_mansion_rage_party">>
	<<if $avery_mansion.party_state is "missed">>
		<<set $avery_mansion.party_state to "waiting">>
		<<set $_dialog_type to _args[0]>>
		<<switch $_dialog_type>>
			<<case "normal">>
				"I missed you on Sunday. I mean the party.
			<<case "chase">>
				"You missed the fucking party.
			<<case "revealed">>
				"You missed the party," <<he>> says.
			<<case "revealed chase">>
				"You missed the party.
		<</switch>>
		/* Reaction on the guest you missed (and scheduling Bailey again if the missed guest was Bailey) */
		<<switch $avery_mansion.party_missed_guest>>
			<<case "Bailey">>
				<<switch $_dialog_type>>
					<<case "normal">>
						We all did. Especially Bailey. <<nnpc_He "Bailey">> walked out when you didn't show, <span class="gold">but has agreed to return <<this_sunday>>.</span> Don't miss it again. You made me feel a fool."
					<<case "chase">>
						All the guests arrived, and you were nowhere to be seen. Bailey walked out when <<he>> learned you weren't here. <<nnpc_He "Bailey">>'s agreed to return <span class="gold"><<this_sunday>>.</span> Don't show me up again."
					<<case "revealed">>
						"Bailey was there. <<nnpc_He Bailey>> left when you didn't show, but agreed to return <span class="gold"><<this_sunday>>.</span> Don't humiliate me again."
					<<case "revealed chase">>
						Imagine how humiliated I felt when the guests showed up, and you weren't here. Bailey walked out, didn't even fucking say anything. <<nnpc_He "Bailey">> agreed to return <span class="gold"><<this_sunday>>.</span> You better fucking be there."
				<</switch>>
			<<case "Quinn">>
				<<switch $_dialog_type>>
					<<case "normal">>
						The mayor asked about you. It would have been nice to show you off.
					<<case "chase">>
						The mayor spent the whole evening cracking jokes about you fucking people behind my back. I've never felt so humiliated.
					<<case "revealed">>
						"The mayor was a handful. Kept making jokes, insinuating that you were being unfaithful.
					<<case "revealed chase">>
						That oaf of a mayor spent the whole evening cracking jokes, insinuating that you were out fucking someone.
				<</switch>>
			<<case "Remy">>
				<<switch $_dialog_type>>
					<<case "normal">>
						As much as I enjoy Remy's company, your absence put a damper on things.
					<<case "chase">>
						Remy was expecting you. I had to make excuses. Everyone knew I was lying.
					<<case "revealed">>
						"I had to explain to Remy that you weren't attending. It wasn't pleasant.
					<<case "revealed chase">>
						I had to make humiliating excuses for you in front of some of the only people around worth knowing.
				<</switch>>
			<<case "Briar">>
				<<switch $_dialog_type>>
					<<case "normal">>
						Briar is a bit uncouth for my tastes. <<nnpc_Hes "Briar">> a rough history, like you, and it would have been nice to have you around.
					<<case "chase">>
						I had to deal with low-class vermin like Briar on my own. I needed you so I could pretend to relate to them.
					<<case "revealed">>
						"Briar asked about you personally. I made excuses, but I dislike being questioned by one so low.
					<<case "revealed chase">>
						I had to handle that rodent Briar alone. <<nnpc_He Briar>> had the gall to try flirting with me.
				<</switch>>
			<<case "Harper">>
				<<switch $_dialog_type>>
					<<case "normal">>
						Doctor Harper asked after you. It was a shame you weren't there.
					<<case "chase">>
						The Doctor was expecting you. I had to make excuses, and do you know what I saw when Harper looked at me? Pity.
					<<case "revealed">>
						"The Doctor asked about you, and I had to give <<nnpc_him Harper>> an unconvincing answer.
					<<case "revealed chase">>
						The Doctor was expecting you, and was disappointed when you didn't show.
				<</switch>>
			<<case "Jordan">>
				<<switch $_dialog_type>>
					<<case "normal">>
						Jordan wasn't alone, and they were a handful.
					<<case "chase">>
						Do you know how it felt to be left alone with those nutters? Jordan and company.
					<<case "revealed">>
						"Jordan brought the usual entourage, and they were the usual headache.
					<<case "revealed chase">>
						I had to deal with those religious crazies alone.
				<</switch>>
		<</switch>>
		/* Announcing next guest (if not bailey) */
		<<switch $avery_mansion.guest>>
			<<case "Quinn">>
				<<switch $_dialog_type>>
					<<case "normal">>
						<<if random(0,1)>>
							<span class="gold">The mayor's coming <<this_sunday>>.</span> Try to be there. <<nnpc_He "Quinn">> can be a handful too."
						<<else>>
							<span class="gold">The mayor will be attending next week.</span> I know <<nnpc_he Quinn>>'ll likely ask after you too. Try to be there."
						<</if>>
					<<case "chase">>
						<span class="gold">The mayor's coming <<this_sunday>>.</span>
						<<if random(0,1)>>
							You'd better fucking show up."
						<<else>>
							Don't humiliate me again."
						<</if>>
					<<case "revealed">>
						<span class="gold">The mayor will be attending <<this_sunday>>.</span> Don't show me up again. Be there."
					<<case "revealed chase">>
						<<if random(0,1)>>
							<span class="gold">The mayor will be here <<this_sunday>>.</span> Don't you dare leave me alone with <<nnpc_him Quinn>>."
						<<else>>
							<span class="gold">The mayor will be attending <<this_sunday>>. Don't you dare leave me alone with <<nnpc_him Quinn>>."</span>
						<</if>>
				<</switch>>
			<<case "Remy">>
				<<switch $_dialog_type>>
					<<case "normal">>
						<span class="gold">Remy the farmer will be attending <<this_sunday>>.</span> A friend of mine. I hope you can make it."
					<<case "chase">>
						<span class="gold">Remy the farmer's coming <<this_sunday>>.</span> If you show me up again, you'll regret it."
					<<case "revealed">>
						<span class="gold">Remy the farmer will be attending <<this_sunday>>.</span> Don't put me in this position again."
					<<case "revealed chase">>
						<span class="gold">Remy the farmer will be attending <<this_sunday>>.</span> Be there. Don't insult me again, or else."
				<</switch>>
			<<case "Briar">>
				<<switch $_dialog_type>>
					<<case "normal">>
						<span class="gold">A local businessperson, Briar, will be attending <<this_sunday>>.</span> Try to be there."
					<<case "chase">>
		 				<span class="gold">If you don't show up for that whoremonger, Briar, <<this_sunday>>,</span> you'll be sorry."
					<<case "revealed">>
						<span class="gold">The local business owner, Briar, will be attending <<this_sunday>>.</span> Don't make me look a fool. Be there."
					<<case "revealed chase">>
						<span class="gold">That local whoremonger, Briar, will be attending <<this_sunday>>.</span> More on your vulgar level, so be sure to show up."
				<</switch>>
			<<case "Harper">>
				<<switch $_dialog_type>>
					<<case "normal">>
						<span class="gold">A local Doctor, Harper, will be attending next week.</span> <<nnpc_Hes "Harper">> very young for such a pillar of the community. Try to be there."
					<<case "chase">>
						<span class="gold">Harper, the Doctor, is coming <<this_sunday>>.</span> If you don't show, you'll be sorry."
					<<case "revealed">>
						<span class="gold">The Doctor, Harper, will be attending <<this_sunday>>.</span> An important person, and I'd like to avoid being questioned about you yet again. Make sure you're here."
					<<case "revealed chase">>
					<span class="gold">Harper the Doctor will be attending <<this_sunday>>.</span> Make sure you fucking show up."
				<</switch>>
			<<case "Jordan">>
				<<switch $_dialog_type>>
					<<case "normal">>
						<span class="gold">Jordan will be attending next week.</span> There'll likely be a whole entourage. I'd prefer if I didn't have to deal with them alone."
					<<case "chase">>
						<span class="gold">Jordan's coming <<this_sunday>>.</span> Probably won't be alone. I'll need you there, and you'll show if you know what's good for you."
					<<case "revealed">>
						<span class="gold">Jordan will be attending <<this_sunday>>.</span> Don't leave me alone with <<nnpc_his "Jordan">> ilk."
					<<case "revealed chase">>
						<span class="gold">Jordan will be attending <<this_sunday>>.</span> You better be there."
				<</switch>>
		<</switch>>
		<<avery_mansion_tower_negative_effects $avery_mansion.party_missed_guest>><<ggarage>><<lllove>><<npcincr Avery love -3>><<npcincr Avery rage 3>>
		<br><br>
	<</if>>
<</widget>>
