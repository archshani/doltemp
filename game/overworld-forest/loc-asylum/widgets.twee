:: Asylum Widgets [widget]

<<widget "asylumeffects">>
	<<if Time.hour lte 5>>
		<<set $asylumstate to "sleep">>
	<<elseif Time.hour lte 8>>
		<<set $asylumstate to "free">>
	<<elseif Time.hour is 9>>
		<<set $asylumstate to "exercise">>
	<<elseif Time.hour is 10>>
		<<set $asylumstate to "firsttreatment">>
	<<elseif Time.hour lte 14>>
		<<set $asylumstate to "free">>
	<<elseif Time.hour is 15>>
		<<set $asylumstate to "secondtreatment">>
	<<elseif Time.hour lte 19>>
		<<set $asylumstate to "free">>
	<<elseif Time.hour is 20>>
		<<set $asylumstate to "assessment">>
	<<elseif Time.hour is 21>>
		<<set $asylumstate to "free">>
	<<else>>
		<<set $asylumstate to "sleep">>
	<</if>>
	<<set $suspicion = Math.clamp($suspicion, 0, 100)>>
	<<set $asylumstatus = Math.clamp($asylumstatus, 0, 100)>>
<</widget>>

<<widget "asylumstats">>
	<<if $suspicion gte 80>>
		<span class="red">Security actively watches you. Even the nurses glance your way warily.</span>
	<<elseif $suspicion gte 20>>
		<span class="blue">You catch the occasional member of security watching you.</span>
	<<else>>
		<span class="green">The staff ignore you.</span>
	<</if>>
	<br>
	<<if $asylumstatus gte 80>>
		<span class="green">The other patients smile when they see you.</span>
	<<elseif $asylumstatus gte 20>>
		<span class="blue">The other patients ignore you.</span>
	<<else>>
		<span class="red">The other patients shun you.</span>
	<</if>>
	<br><br>
<</widget>>

<<widget "asylumtreatments">>
<<if isPregnancyEnding()>>
	<<pregnancyPassout "asylumHarper">>
<<else>>
	<<cleareventpool>>

	<<addinlineevent "asylum_treatment_1" 1>>
		<<asylumUnbindGown>>

		<<if $o_long_and_beautiful gte 1 and $o_long_and_beautiful lte 7 and $rng % 2 and maleChance() lt 100>>
			<<set $phase to 0>><<set $o_long_and_beautiful += 1>>
			<<npc Harper>><<person1>>

			You enter a thin room. Curtains line one side.
			<br><br>

			"Hello," Doctor Harper says. "I'm glad you could make it. Please stand just there." <<He>> pushes a button on the wall by the door and the curtain pulls back, revealing the other half of the room. A patient lies on the floor. The long, matted hair covering most of her face hides any visible reaction.
			<br><br>

			<<person1>>"This treatment isn't for you," the doctor says. "It's for your fellow patient. I just need an assistant." <<He>> gestures at a button on a table beside you. "You'll need to press that button when I say. I'll be busy helping this patient. Press it now."
			<br><br>

			<<link [[Press|Asylum Button Long Hair Press]]>><</link>>
			<br>
			<<link [[Refuse|Asylum Button Long Hair Refuse]]>><<suspicion 1>><<def 1>><</link>><<gsuspicion>>
		<<else>>
			<<set $phase to 0>>
			<<npc Harper>><<person1>><<generate2>>

			You enter a thin room. Shutters line one side.
			<br><br>

			"Hello," Doctor Harper says. "I'm glad you could make it. Please take a seat." <<He>> pushes a button on the counter beside <<him>>. The shutters open, revealing a glass window. Another patient sits in the room beyond. <<person2>><<He>> looks nervous, but doesn't react to the reveal.
			<br><br>

			<<person1>>"This treatment isn't for you," the doctor says. "It's for your fellow patient. I just need an assistant." <<He>> gestures at a button in front of you. "You'll need to press this button when I say. I'll be busy taking notes. Press it now."
			<br><br>

			<<link [[Press|Asylum Button Press]]>><</link>>
			<br>
			<<link [[Refuse|Asylum Button Refuse]]>><<suspicion 1>><<def 1>><</link>><<gsuspicion>>
		<</if>>
	<</addinlineevent>>

	<<addinlineevent "asylum_treatment_2" 1>>
		<<npc Harper>><<person1>>

		You enter Doctor Harper's office. <<He>> waits for you behind <<his>> desk.
		<br><br>

		"Please take a seat," <<he>> says. There are no other chairs.
		<br><br>

		<<link [[Sit on desk|Asylum Sit Desk]]>><</link>>
		<br>
		<<link [[Sit on lap|Asylum Sit Lap]]>><</link>><<promiscuous1>><<lsuspicion>><<lawareness -1>>
		<br>
		<<link [[Stay stood|Asylum Sit Stand]]>><<suspicion 1>><</link>><<gsuspicion>>
	<</addinlineevent>>

	<<addinlineevent "asylum_treatment_3" 1>>
		<<asylumUnbindGown>>
		<<npc Harper>><<person1>><<generate2>>

		You enter a room with a large window facing the grounds, and the forest beyond. Doctor Harper waits for you, stood beside a <<person2>><<person>>. Another patient. Several orderlies wait by the wall.
		<br><br>

		"Thank you both for coming," the doctor says. "Today I want to talk about modesty. It shouldn't feel bad to be exposed. It should feel good. I want one of you to strip." The <<person>> looks horrified at the thought. "And stand in front of the window there."
		<br><br>

		You can see many patients exercising outside, as well as staff watching over them. The <<persons>> horror becomes panic. "P-please," <<he>> says. "Don't make me."
		<br><br>

		<<person1>>Harper looks at you. "You get to decide which of you strips," <<he>> says. The <<person2>><<person>> looks at you, near tears.
		<br><br>

		<<if hasSexStat("exhibitionism", 5)>>
			<<link [[Strip and flaunt|Asylum You Flaunt]]>><<suspicion -5>><<asylumstatus 5>><<awareness -10>><<fameexhibitionism 10>><</link>><<exhibitionist5>><<llawareness>><<llsuspicion>><<ggcool>>
		<<else>>
			<<link [[Strip reluctantly|Asylum You Strip]]>><<suspicion -5>><<asylumstatus 5>><<awareness -10>><<stress 3>><<fameexhibitionism 10>><</link>><<llawareness>><<llsuspicion>><<ggcool>><<gstress>>
		<</if>>
		<br>
		<<link [[Make <<him>> strip|Asylum They Strip]]>><<suspicion 5>><<asylumstatus -5>><</link>><<ggsuspicion>><<llcool>>
	<</addinlineevent>>

	<<if $hypnosisdisable is "f">>
		<<addinlineevent "asylum_treatment_4" 1>>
			<<AsylumHypnosisCommon "Oral" $hypnosis_traits.suggestion>>
		<</addinlineevent>>

		<<addinlineevent "asylum_treatment_5" 2>>
			<<asylumUnbindGown>>
			<<AsylumHypnosisCommon "Exhibitionism" $hypnosis_traits.cover>>
		<</addinlineevent>>

		<<if isBeastSceneAllowed()>>
			<<addinlineevent "asylum_treatment_6" 1.5>>
				<<AsylumHypnosisCommon "Dog" $hypnosis_traits.deviancy>>
			<</addinlineevent>>
		<</if>>
	<</if>>

	<<addinlineevent "asylum_treatment_7" 1.5>>
		<<npc Harper>><<person1>>
		You enter a windowless room. Doctor Harper waits beside a large machine. "Thank you for coming," <<he>> says. <<He>> presses a button. A compartment opens, large enough for you to fit. "Please lie down inside."
		<br><br>

		<<getinicon>><<link [[Get in|Asylum Machine]]>><<awareness -10>><<suspicion -5>><</link>><<llsuspicion>><<llawareness>>
		<br>
		<<refuseicon>><<link [[Refuse|Asylum Machine Refuse]]>><<suspicion 5>><</link>><<athleticsdifficulty 1 1000>><<ggsuspicion>><<ggstress>>
	<</addinlineevent>>

	<<addinlineevent "asylum_treatment_8" 1>>
		<<npc Harper>><<generate2>><<generate3>>

		You enter Harper's office. <<person1>><<He>> sits behind <<his>> desk. A <<person2>><<person>> and <<person3>><<person>> sit in front of <<him>>, both in white coats. They turn to regard you.
		<br><br>

		"Thank you for coming," Harper says. "I have something special for you today. A new drug. My colleagues here would like to observe its effects. Here." <<person1>><<He>> stands and removes a sheet from a nearby chair. There are straps on the arms and legs. "Please sit."
		<<person3>>
		<br><br>

		<<link [[Sit|Asylum Pill Sit]]>><<awareness -10>><<suspicion -5>><<hallucinogen 80>><</link>><<llsuspicion>><<llawareness>>
		<br>
		<<link [[Refuse|Asylum Pill Refuse]]>><<suspicion 5>><</link>><<ggsuspicion>><<ggstress>>
	<</addinlineevent>>

	<<addinlineevent "asylum_treatment_9" 1>>
		<<npc Harper>><<person1>>

		You enter Harper's office. <<He>> waits for you inside, sat at <<his>> desk. "Thank you for coming," <<he>> says. "Please, take a seat."
		<br><br>

		You sit down in a chair in front of <<his>> desk. Harper pulls something out from a drawer. It's a folded piece of paper. Dark splotches bleed through it from within.
		<br><br>

		"This is something called an inkblot test," <<he>> explains. "I want you to tell me what this shape reminds you of."
		<br><br>

		<<He>> unfolds the paper. The two sides stick together, but come undone with a crackle. A symmetrical black blob is painted on the inside.

		<<if $awareness gte 400>>
			The strokes twist together across the page, tangling over one another. They converge into total darkness, like a hole punched through the paper, or the mouth of a terrible creature. You stare at it, unable to tear your eyes away. <<gstress>><<stress 6>><<gtrauma>><<trauma 6>>
		<<elseif $awareness gte 200>>
			You stare at the paper, trying to discern the shape. The blob looks suspiciously <<if $NPCList[0].penis isnot "none">>phallic.<<else>>yonic.<</if>>
			<<if $purity gte 1000 or $angel gte 6>>
				You wonder if you're just being dirty-minded.<<gstress>><<stress 1>>
			<<else>>
				The longer you stare at it, the more certain you are that it looks like a <<if $NPCList[0].penis isnot "none">>penis.<<else>>pussy.<</if>>
			<</if>>
		<<else>>
			You tilt your head, looking at the paper. The shape looks like a <<if $NPCList[0].penis isnot "none">>rocket taking off.<<else>>beautiful butterfly.<</if>>
		<</if>>
		<br><br>

		<<link [[Answer honestly|Asylum Inkblot Answer Honestly]]>><<trauma -6>><<suspicion -5>><</link>><<llsuspicion>><<llawareness>><<lltrauma>>
		<br>
		<<link [[Refuse to answer|Asylum Inkblot Answer Evasively]]>><<stress 3>><</link>><<lawareness>><<gstress>>
	<</addinlineevent>>

	<<addinlineevent "asylum_treatment_10" 1.5>>
		<<asylumUnbindGown>>
		<<npc Harper>><<person1>>

		You enter a room with pastel-coloured wallpaper and warm lighting. You immediately feel at ease. Doctor Harper sits on a chair opposite a cushioned lounge chair.
		<br><br>
		
		"Thank you for coming," <<he>> says. "Please, take a seat."
		<br><br>

		Once you're situated on the lounge chair, <<he>> looks up from <<his>> clipboard. "You've been seducing innocent people and calling it rape out of shame. This comes from your poor inhibitions," <<he>> says. "We're going to work on controlling that indecent behaviour. Please, take off your clothes."
		<br><br>

		<<if hasSexStat("exhibitionism", 4)>>
			<<link [[Strip and flaunt|Asylum Masturbation]]>><<suspicion -2>><<set $phase to "flaunt">><</link>><<exhibitionist4>><<lsuspicion>>
			<br>
		<</if>>
		<<link [[Strip reluctantly|Asylum Masturbation]]>><<suspicion -2>><<stress 2>><<set $phase to "strip">><</link>><<lsuspicion>><<gstress>>
		<br>
		<<link [[Refuse|Asylum Masturbation]]>><<suspicion 5>><<set $phase to "refuse">><</link>><<ggsuspicion>>
	<</addinlineevent>>

	<<runeventpool>>
<</if>>
<</widget>>

<<widget "asylumassessment">>
	<<npc Harper>><<person1>>

	You enter Harper's office.
	<<if isPregnancyEnding()>>
		<<pregnancyPassout "asylumHarper">>
	<<elseif $innocencestate is 1 and $asylumbound lte 0>>
		<<npcincr Harper love 5>><<npcincr Harper dom 5>><<set $asyluminnocence to 1>>

		<<He>> puts down <<his>> clipboard and smiles. "Your treatment is finished," <<he>> says. "You're ready to be a functioning member of society. I'll have special pills sent to your home."
		<<set $sexStats.pills["pills"]["asylum\'s prescription"].owned to 14>><<set $asylummedicated to 0>>
		<<He>> rises to <<his>> feet and pulls the curtains at the window closed. "Stand up."
		<br><br>

		Once stood, <<he>> pushes you back over the desk.
		<<if $NPCList[0].penis isnot "none">>
			<<He>> steps between your legs and leans forward,
		<<else>>
			<<He>> climbs atop and straddles you,
		<</if>>

		groping at your clothes with shaking fingers, trying to take them off. The professional air <<he>> carried is gone. <<He>> laughs, giggles really. "I-I should be the first to experience my handiwork. It's only fair."
		<br><br>

		<<link [[Next|Asylum Harper Sex]]>><<set $molestationstart to 1>><</link>>
		<br>

	<<elseif $trauma lte $traumamax / 10 and $asylumbound lte 0>>
		<<set $asylumtrauma to 1>> /* unused */

		<<He>> puts down <<his>> clipboard and frowns. "Your treatment isn't finished," <<he>> says. "But you seem to have recovered regardless. I can't justify keeping you here." <<He>> rises to <<his>> feet and pulls the curtains at the window closed.
		<br><br>

		"Now that you're better..." <<He>> steps around the desk. "This might be the last time we see each other." <<He>> gropes your clothing. The professional air <<he>> carried is gone. <<He>> laughs as <<he>> tries to kiss you.
		<br><br>

		<<link [[Let it happen|Asylum Harper Sex]]>><<npcincr Harper love 5>><<set $sexstart to 1>><</link>><<promiscuous1>>
		<br>
		<<link [[Shove away|Asylum Harper Shove]]>><<npcincr Harper love -1>><</link>>
		<br>

	<<elseif $asylumassessmentprogress lte 0>>
		<<set $asylumassessmentprogress += 1>>
		Harper stares at you across the desk. "Let's talk about your exposure fetish," <<he>> says. "You've been displaying your body in inappropriate ways, then claiming others stripped you. You're ashamed of your feelings."
		<br><br>

		<<if $asylumdistracted is 1 and !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Fight]]>><<suspicion 15>><<trauma -6>><<stress -6>><<set $fightstart to 1>><</link>><<gggsuspicion>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<<elseif !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Punish]]>><<suspicion 15>><<trauma -6>><<stress -6>><</link>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<</if>>
		<<if $asylumkeycard isnot 1 and !pcAreArmsBound("any")>>
			<<set $skulduggerydifficulty to 900 + (20 * $suspicion)>>
			<<link [[Steal keycard|Asylum Keycard]]>><</link>><<skulduggerydifficulty>> <<note "This will be easier with low suspicion" "italic">>
			<br>
		<</if>>
		<<link [[Insist that isn't true|Asylum Exhibit Meek]]>><<awareness -1>><<stress 3>><</link>><<lawareness>><<gstress>>
		<br>
		<<link [[Say you aren't sure|Asylum Exhibit Sub]]>><<trauma -6>><<suspicion -5>><<awareness -10>><</link>><<llsuspicion>><<llawareness>><<ltrauma>>
		<br>

	<<elseif $asylumassessmentprogress lte 1 and $tentaclerapestat gte 1>>
		<<set $asylumassessmentprogress += 1>>
		Harper stares at you across the desk. "In your sleep you talk about being attacked by monsters with tentacles," <<he>> says. "Creatures like that don't exist. If someone claimed to have been molested by a creature no one else can see, would you believe them?"
		<br><br>

		<<if $asylumdistracted is 1 and !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Fight]]>><<suspicion 15>><<trauma -6>><<stress -6>><<set $fightstart to 1>><</link>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<<elseif !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Punish]]>><<suspicion 15>><<trauma -6>><<stress -6>><</link>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<</if>>
		<<if $asylumkeycard isnot 1 and !pcAreArmsBound("any")>>
			<<set $skulduggerydifficulty to 900 + (20 * $suspicion)>>
			<<link [[Steal keycard|Asylum Keycard]]>><</link>><<skulduggerydifficulty>> <<note "This will be easier with low suspicion" "italic">>
			<br>
		<</if>>
		<<link [[Insist they are real|Asylum Tentacles Meek]]>><<awareness 1>><<stress 3>><</link>><<gawareness>><<gstress>>
		<br>
		<<link [[Say you aren't sure|Asylum Tentacles Sub]]>><<trauma -6>><<suspicion -5>><<awareness -10>><</link>><<llsuspicion>><<llawareness>><<ltrauma>>
		<br>

	<<elseif $asylumassessmentprogress lte 2 and $beastrapestat gte 1>>
		<<set $asylumassessmentprogress += 1>>
		<!-- Modified for monster people -->
		Harper stares at you across the desk.
		<<if $bestialitydisable is "f">>
			"In your sleep you talk about being attacked by animals," <<he>> says. "Sexually attacked. Animals don't behave like that. You've been abusing innocent creatures, haven't you?"
		<<else>>
			"In your sleep you talk about being attacked by monster-people," <<he>> says. "Sexually attacked. These types of beings do not exist. You made yourself believe they possess human-like features. In reality, you've been abusing innocent animals for your own pleasure. Am I wrong?"
		<</if>>
		<br><br>

		<<if $asylumdistracted is 1 and !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Fight]]>><<suspicion 15>><<trauma -6>><<stress -6>><<set $fightstart to 1>><</link>><<gggsuspicion>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<<elseif !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Punish]]>><<suspicion 15>><<trauma -6>><<stress -6>><</link>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<</if>>
		<<if $asylumkeycard isnot 1 and !pcAreArmsBound("any")>>
			<<set $skulduggerydifficulty to 900 + (20 * $suspicion)>>
			<<link [[Steal keycard|Asylum Keycard]]>><</link>><<skulduggerydifficulty>> <<note "This will be easier with low suspicion" "italic">>
			<br>
		<</if>>
		<<link [[Insist that isn't true|Asylum Beast Meek]]>><<awareness -1>><<stress 3>><</link>><<lawareness>><<gstress>>
		<br>
		<<link [[Say you aren't sure|Asylum Beast Sub]]>><<trauma -6>><<suspicion -5>><<awareness -10>><</link>><<llsuspicion>><<llawareness>><<ltrauma>>
		<br>

	<<elseif $asylumassessmentprogress lte 3>>
		<<set $asylumassessmentprogress += 1>>
		Harper stares at you across the desk. "There are marks on your body," <<he>> says. "You did this to yourself, didn't you."
		<br><br>

		<<if $asylumdistracted is 1 and !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Fight]]>><<suspicion 15>><<trauma -6>><<stress -6>><<set $fightstart to 1>><</link>><<gggsuspicion>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<<elseif !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Punish]]>><<suspicion 15>><<trauma -6>><<stress -6>><</link>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<</if>>
		<<if $asylumkeycard isnot 1 and !pcAreArmsBound("any")>>
			<<set $skulduggerydifficulty to 900 + (20 * $suspicion)>>
			<<link [[Steal keycard|Asylum Keycard]]>><</link>><<skulduggerydifficulty>> <<note "This will be easier with low suspicion" "italic">>
			<br>
		<</if>>
		<<link [[Insist that isn't true|Asylum Hurt Meek]]>><<awareness -1>><<stress 3>><</link>><<lawareness>><<gstress>>
		<br>
		<<link [[Say you aren't sure|Asylum Hurt Sub]]>><<trauma -6>><<suspicion -5>><<awareness -10>><</link>><<llsuspicion>><<llawareness>><<ltrauma>>
		<br>

	<<else>>
		<<set $asylumassessmentprogress to 0>>
		Harper stares at you across the desk. "In your sleep you talk about being raped and molested. But that isn't what happens, is it?" <<he>> says. "You approach and seduce people willingly. You call it rape because you're ashamed."
		<br><br>

		<<if $asylumdistracted is 1 and !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Fight]]>><<suspicion 15>><<trauma -6>><<stress -6>><<set $fightstart to 1>><</link>><<gggsuspicion>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<<elseif !pcAreArmsBound("any")>>
			<<link [[Attack|Asylum Punish]]>><<suspicion 15>><<trauma -6>><<stress -6>><</link>><<gggsuspicion>><<ltrauma>><<lstress>>
			<br>
		<</if>>
		<<if $asylumkeycard isnot 1 and !pcAreArmsBound("any")>>
			<<set $skulduggerydifficulty to 900 + (20 * $suspicion)>>
			<<link [[Steal keycard|Asylum Keycard]]>><</link>><<skulduggerydifficulty>><<note "This will be easier with low suspicion" "italic">>
			<br>
		<</if>>
		<<link [[Insist that isn't true|Asylum Rape Meek]]>><<awareness -1>><<stress 3>><</link>><<lawareness>><<gstress>>
		<br>
		<<link [[Say you aren't sure|Asylum Rape Sub]]>><<trauma -6>><<suspicion -5>><<awareness -10>><</link>><<llsuspicion>><<llawareness>><<ltrauma>>
		<br>

	<</if>>
<</widget>>

<<widget "AsylumHypnosisCommon">>
	<<set $phase to _args[0]>>
	<<set _traitValue to _args[1]>>
	<<set $outside to 0>><<set $location to "asylum">><<asylumeffects>><<effects>>
	<<npc Harper>><<person1>>

	You enter Harper's office. <<He>> waits for you inside, sat at <<his>> desk.
	<<if $phase is "Oral">>
		<<generate2>> There's a <<person2>><<person>> sat opposite. Another patient. "Thank you for joining us," the doctor
	<<else>>
		"Thank you for coming," <<person1>><<he>>
	<</if>>
	says. "Please, take a seat."
	<br><br>

	<<if $phase is "Oral">>
		You sit beside the <<person2>><<person>>.
	<<else>>
		Once sat,
	<</if>>
	Harper picks up a pen on <<person1>><<his>> desk. "I want <<if $phase is "Oral">>both of <</if>>you to focus on this pen, and breathe deeply. There's nothing in the universe except this pen, my voice, and your own breath."
	<br><br>

	<<pass 5>>
	This continues for several minutes. Harper somehow picks up on whenever your mind starts to wander and brings you back to focus. You start to feel something shift in your consciousness, as if you're entering a trance.
	<br><br>

	<<link [[This feels nice (0:10)|Asylum Hypnosis Trance]]>><<npcincr Harper dom 5>><<control 25>><<trauma -6>><<stress -12>><<awareness -10>><</link>><<ggcontrol>><<llawareness>><<ltrauma>><<lstress>>
	<br>
	<<link [[Resist|Asylum Hypnosis Trance Resist]]>><</link>><<willpowerdifficulty 1 `300 * (_traitValue || 3)`>>
<</widget>>

<<widget "asylumend">>
	<<set $asylum to 0>>
<</widget>>

<<widget "asylumpunish">>
	<<endevent>><<npc Harper>><<person1>><<set $asylumbound to 2>>
	"Take <<phim>> to the room," Harper says. "Make sure <<pher>> arms are bound tight."
	<br><br>

	<<if !pcAreArmsBound("both")>>
		<<asylumBind "punish">>
		They tear off your clothes and wrestle you into a straightjacket.
	<</if>>
	They push you to an empty wing of the asylum, through one of the doors marked "Staff Only." Most of the lights here don't work, and those that do flicker to a strange rhythm.
	<br><br>

	You come to a tall metal door. They open it, revealing a pitch black room beyond. They shove you in, and slam the door behind you.
	<br><br>

	The room is tiny. There's just enough space to sit. You wait in total silence.
	<br><br>

	<<link [[Wait (1:00)|Asylum Room]]>><<pass 60>><</link>>
	<br>
<</widget>>

<<widget "asylumoptions">>
	<<if pcAreArmsBound("any") and $asylumbound lte 0>>
		<<He>> looks at your bindings. "I think you've earned a release," <<he>> says as <<he>> crouches and unties them, before removing it completely.<<unbind>><<exposure>> <<He>> covers you with a gown.
		<<unbind>><<upperwear 87>><<exposure>>
		<br><br>
	<<elseif $asylumbound gt 0 and ($worn.upper.name isnot "straightjacket" or $worn.lower.name isnot "straightjacket bottom")>>
		<<if $worn.upper.name is "straightjacket">>
			<<set _nurseJacket to "broken">>
			<<He>> regards your ruined jacket with a frown. "Let's get you into something proper," <<he>> says.
		<<else>>
			<<set _anyclothing to getVisibleClothesList().some(item => item.name !== "naked")>>
			"You're not supposed to be out of the jacket yet," <<he>> remarks flatly.
		<</if>>
		
		<<if _nurseJacket is "broken">>
			<<He>> removes the remains of your straightjacket<<if pcAreArmsBound("both")>>, letting your arms fall at your sides<</if>>.
		<</if>>

		<<asylumBind>>
		<<if _anyclothing and (!_asylumBindUnderwear or _asylumBindUnderwear is "given")>>
			<<He>> makes you hand over all your personal items.
		<<elseif _asylumBindUnderwear and _asylumBindUnderwear isnot "given">>
			<<He>> makes you strip down to your underwear.
			<<if _nurseJacket is "broken">>
				Then <<he>>
			<<else>>
				<<He>>
			<</if>>

			slides down your _asylumBindUnderwear and makes you step out of them.
		<</if>>
		<<if _asylumBindUnderwear>> <<He>> makes you step into a fresh pair of $worn.under_lower.name_simple and pulls them up.
		<</if>>
		Your brief moment of freedom ends as <<he>> secures you into a new straightjacket.
		<<fameexhibitionism 1>>
		<br><br>
	<<elseif $exposed gte 1>>
		<<He>> steps back to regard you. <<covered>> "You can't see the doctor dressed like that," <<he>> says. <<He>> covers you with a gown. <<unbind>><<upperwear 87>><<exposure>>
		<br><br>
	<</if>>
<</widget>>

/* _args[0] should be punish, fake, or session */
<<widget "asylumBind">>
	<<unbind>><<exposure>><<strip>>

	<<if _args[0] is "punish">>
		<<ruined false true "carried">>
	<<elseif _args[0] is "fake">>
	<<else>>
		<<if $player.gender_appearance is "f">>
			<<set _underwearIndex to 1>>
		<<else>>
			<<set _underwearIndex to 4>>
		<</if>>

		<<if $carried.under_lower.index isnot _underwearIndex or $carried.under_lower.colour isnot "pale white">>
			<<if $carried.under_lower.name is "naked">>
				<<set _asylumBindUnderwear to "given">>
			<<else>>
				<<set _asylumBindUnderwear to $carried.under_lower.name>>
			<</if>>

			<<underlowerwear _underwearIndex "pale white">>
		<<else>>
			<<underloweron>>
		<</if>>
	<</if>>

	<<if _args[0] is "session">>
		<<generalRuined "upper" true "carried">>
	<<else>>
		<<returnCarried>>
	<</if>>

	<<bind>><<upperwear 35>><<exposure>>
<</widget>>

<<widget "asylumUnbind">>
	<<if pcAreArmsBound("any")>>
		<<endevent>>
		<<generate1>><<person1>>
		Just before a doorway, another nurse stops you. "Doctor says you need your hands free for this session," <<he>> says. <<He>> undoes your bindings.
		<<if $worn.upper.name is "straightjacket" or $worn.lower.name is "straightjacket bottom">>
			<<He>> then helps you out of<<if $worn.lower.name isnot "straightjacket bottom" or $worn.upper.name isnot "straightjacket">> the remains of<</if>> your straightjacket<<if _args[0]>>, and covers you with a gown.<<unbind>><<exposure>><<upperwear 87>><<else>>.<</if>>
		<<else>>
			<<unbind>><<exposure>>
		<</if>>

		<<He>> opens the nearby door and leads you inside.
		<br><br>

		<<endevent>>
	<</if>>
<</widget>>

<<widget "asylumUnbindGown">>
	<<asylumUnbind true>>
<</widget>>

<<widget "asylumRebind">>
	<<if $asylumbound gt 0 and ($worn.upper.name isnot "straightjacket" or $worn.lower.name isnot "straightjacket bottom")>>
		<<generate1>><<person1>>
		<<if V.carried.upper.name is "patient gown" or V.worn.upper.name is "patient gown">>
			<<set _gown to true>>
		<</if>>

		<<if $worn.upper.name is "straightjacket" and $worn.lower.name isnot "straightjacket bottom">>
			<<set _ruined to true>>
		<</if>>

		<<asylumBind "session">>

		A nurse is waiting for you outside the room.
		<<if _gown>>
			<<He>> makes you return the gown you're wearing. Then <<he>>
		<<elseif _ruined>>
			<<He>> helps you out of the ruined straightjacket. Then <<he>>
		<<else>>
			<<He>>
		<</if>>

		<<if _asylumBindUnderwear>>
			helps you into a pair of $worn.under_lower.name_simple before restraining
		<<else>>
			restrains
		<</if>>

		you with a <<if _ruined>>new <</if>>straightjacket once more.
		<br><br>
	<</if>>
<</widget>>

<<widget "asylumClothesOn">>
	<<clotheson>>
	<<if $asylumbound gt 0>>
		<<asylumBind>>
	<</if>>
<</widget>>

<<widget "asylumevents">>
	<<if dangerEvent()>>
		<<cleareventpool>>

		<<addinlineevent "asylum_exposure" 1>>
			<<generate1>><<person1>>
			"Excuse me," says a voice to your side. It's a <<person>> wearing a patient's gown. "Doctor Harper gave me a task. I need to—" <<He>> looks away. "I need to expose myself to a dozen people before my next assessment. My b-body, I mean. C-can I show you?" <<He>> doesn't look happy.
			<br><br>

			<<link [[Accept|Asylum Exposure Accept]]>><<handheldon>><<arousal 600>><</link>><<garousal>>
			<br>
			<<link [[Accept but keep your eyes shut|Asylum Exposure Shut]]>><<famegood 1>><<handheldon>><</link>>
			<br>
			<<link [[Accept and pretend to keep your eyes shut|Asylum Exposure Peek]]>><<arousal 600>><<famegood 1>><<handheldon>><</link>><<garousal>>
			<br>
			<<link [[Refuse|Asylum Exposure Refuse]]>><<handheldon>><</link>>
			<br>
		<</addinlineevent>>

		<<if random(1,100) lte $suspicion>>
			<<addinlineevent "asylum_fake_treatment" 1>>
				<<generateDoctor 1>><<generate2>><<person1>>
				A <<person>> dressed as an orderly approaches you. "Hello. The doctor has extra time today and wants you in for an extra treatment," <<he>> says. "Come with me please."
				<br><br>

				A <<person2>><<person>> stands behind you.
				<br><br>

				<<link [[Go with them|Asylum Fake Treatment Accept]]>><<handheldon>><</link>>
				<br>
				<<link [[Refuse to go|Asylum Fake Treatment Refuse]]>><<handheldon>><</link>><<physiquedifficulty 1 $physiquemax>>
				<br>
			<</addinlineevent>>
		<</if>>

		<<addinlineevent "asylum_flirt" 2>>
			<<generate1>><<person1>><<npcClothesType $NPCList[0] "patient">>You catch one of the other patients, a <<person>>, looking at you. <<He>> smiles.
			<br><br>

			<<link [[Flirt (0:02)|Asylum Flirt]]>><<handheldon>><<asylumstatus 1>><<pass 2>><</link>><<promiscuous1>><<gcool>>
			<br>
			<<link [[Ignore|Asylum]]>><<endevent>><</link>>
			<br>
		<</addinlineevent>>

		<<addinlineevent "asylum_nurse_grope" 4>>
			<<generate1>><<generatev2>><<person1>>One of the patients, a <<person>>, gropes one of the nurses, a <<person2>><<person>>. The nurse doesn't resist. <<He>> looks resigned.
			<br><br>

			<<link [[Intervene (0:02)|Asylum Intervene]]>><<handheldon>><<pass 2>><<suspicion -5>><<asylumstatus -5>><</link>><<llsuspicion>><<llcool>>
			<br>
			<<link [[Ignore|Asylum]]>><<endevent>><</link>>
			<br>
		<</addinlineevent>>

		<<addinlineevent "asylum_answer" 2>>
			<<generate1>><<person1>><<generate2>>A <<person>>, a patient, runs past you and hides from view, just as a <<person2>><<person>> rounds the corner. <<Hes>> a nurse. <<He>> looks around, then at you. "Have you seen a <<person1>><<person>> by chance?"
			<br><br>

			<<link [[Truth|Asylum Truth]]>><<handheldon>><<suspicion -5>><<asylumstatus -5>><</link>><<llsuspicion>><<llcool>>
			<br>
			<<link [[Lie|Asylum Lie]]>><<handheldon>><<suspicion 5>><<asylumstatus 5>><</link>><<ggsuspicion>><<ggcool>>
			<br>
		<</addinlineevent>>

		<<addinlineevent "asylum_flower_patch" 1>>
			Eventually, you grow tired of the other patients, and wander out to the asylum yard for some fresh air. You take a walk, strolling through the grounds and finding what enjoyment you can.
			<br><br>
			While on your walk, you stumble across a patch of wildflowers.
			<br><br>
			<<if !pcAreArmsBound("any")>>
				<<link [[Make a flower crown|Asylum Flower Patch Crown]]>><</link>><<tendingdifficulty 1 200>>
				<br>
			<<else>>
				<span class="blue">You cannot do anything with the flowers while your arms are bound.</span>
				<br>
			<</if>>
			<<link [[Sit and observe|Asylum Flower Patch Observe]]>><<stress -6>><</link>><<lstress>>
			<br>
			<<link [[Ignore|Asylum]]>><<endevent>><</link>>
			<br>
		<</addinlineevent>>


		<<if $daily.asylumPuzzle isnot 1>>
			<<addinlineevent "asylum_puzzle" 1>>

				<<set $daily.asylumPuzzle to 1>>
				You notice a group of patients sitting around a table, off to the side.
				<<if $asylumPuzzleProgress gte 1>>
					<<loadNPC 0 "asylum_puzzle_group">>
					<span class="blue"> It's the same group you helped last time,</span> back to poring over their puzzle.
				<<else>>
					<<generate1>>
					They're working on what appears to be a large puzzle laid out in front of them.
				<</if>>
				<br><br>

				<<= $asylumPuzzleProgress >= 1 ? "The" : "A">> <<person1>><<person>> looks over and makes eye contact,
				<<if pcAreArmsBound("both")>>
					then laughs and turns away.<<asylumstatus -1>><<lcool>>
					<br><br>

					<span class="blue"> You can't participate with your arms bound.</span>
					<br><br>

					<<link [[Next|Asylum]]>><<handheldon>><<endevent>><</link>>
					<br>
				<<elseif $asylumstatus gte 60>>
					then waves you over.
					<br><br>

					<<link [[Join them|Asylum Puzzle]]>><<asylumstatus 1>><</link>><<gcool>>
					<br>
					<<link [[Turn away|Asylum]]>><<handheldon>><<endevent>><</link>>
					<br>
				<<else>>
					then glares at you in contempt. You hasten to turn away and find something else to do.
					<br><br>

					<<link [[Next|Asylum]]>><<handheldon>><<endevent>><</link>>
					<br>
				<</if>>
			<</addinlineevent>>
		<</if>>

		<<runeventpool>>
	<<else>>
		<<link [[Next|Asylum]]>><<handheldon>><</link>>
		<br>
	<</if>>
<</widget>>

<<widget "passoutasylum">>
	<<if isPregnancyEnding()>>
		<<pregnancyPassout "asylum">>
	<<else>>
		<<passout>>
		<<link [[Everything fades to black...|Passout Asylum]]>><</link>>
	<</if>>
<</widget>>

<<widget "asylumescape">>
	<<set $asylumescaped to 1>>
	<<if $location is "tentworld">>
		<<set $asylumtentacleescape to 1>> /* unused */
	<</if>>

	<<if C.npc.Robin.init is 1>>
		<<set $robinReunionScene to "asylum">>
	<</if>>
<</widget>>
